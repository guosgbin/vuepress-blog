<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://blog.guosgbin.cn/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html"><meta property="og:title" content="06-解析SQL语句"><meta property="og:description" content="版本 内容 时间 ---- ---- -------------------- V1 新建 2021年6月9日23:50:39 摘要：解析我们写的SQL脚本，构建一个节点树，获得SqlSource对象。 在看解析SQL语句的源码的时候，需要知道一些类。 准备知识 MappedStatement 首先有一个很重要的MappedStatement类，它其实..."><meta property="og:type" content="article"><meta property="og:image" content="https://blog.guosgbin.cn/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-06-04T10:30:00.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="06-解析SQL语句"><meta property="article:author" content="超威蓝猫 Dylan Kwok"><meta property="article:modified_time" content="2023-06-04T10:30:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"06-解析SQL语句","image":["https://blog.guosgbin.cn/"],"dateModified":"2023-06-04T10:30:00.000Z","author":[{"@type":"Person","name":"超威蓝猫 Dylan Kwok","url":"","email":"guosgbin@163.com"}]}</script><link rel="icon" href="/小熊猫.svg"><title>06-解析SQL语句</title><meta name="description" content="版本 内容 时间 ---- ---- -------------------- V1 新建 2021年6月9日23:50:39 摘要：解析我们写的SQL脚本，构建一个节点树，获得SqlSource对象。 在看解析SQL语句的源码的时候，需要知道一些类。 准备知识 MappedStatement 首先有一个很重要的MappedStatement类，它其实...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-e751b983.css" as="style"><link rel="stylesheet" href="/assets/style-e751b983.css">
    <link rel="modulepreload" href="/assets/app-50fc29a7.js"><link rel="modulepreload" href="/assets/深入浅出Mybatis06：解析SQL语句.html-e8357775.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/深入浅出Mybatis06：解析SQL语句.html-a9181b56.js"><link rel="prefetch" href="/assets/index.html-fc11f9b9.js" as="script"><link rel="prefetch" href="/assets/01-创建和销毁对象.html-98280ce1.js" as="script"><link rel="prefetch" href="/assets/index.html-c4f42206.js" as="script"><link rel="prefetch" href="/assets/01-CAS和Unsafe的API分析.html-612c4d6a.js" as="script"><link rel="prefetch" href="/assets/02-基本类型原子类AtomicLong.html-4083b8fd.js" as="script"><link rel="prefetch" href="/assets/03-引用类型原子类AtomicReference.html-8442553d.js" as="script"><link rel="prefetch" href="/assets/04-原子数组类AtomicLongArray.html-74e4c741.js" as="script"><link rel="prefetch" href="/assets/05-原子操作类AtomicReferenceFieldUpdater.html-d0310b2a.js" as="script"><link rel="prefetch" href="/assets/06-高性能原子类LongAdder.html-d6e3da8b.js" as="script"><link rel="prefetch" href="/assets/07-LockSupport分析.html-8117dd17.js" as="script"><link rel="prefetch" href="/assets/08-AQS简单介绍.html-30b6ef5b.js" as="script"><link rel="prefetch" href="/assets/09-基于ReentrantLock分析AQS的独占模式.html-2423c430.js" as="script"><link rel="prefetch" href="/assets/10-基于CountDownLatch分析AQS的共享模式.html-91ef4833.js" as="script"><link rel="prefetch" href="/assets/11-AQS的Condition机制.html-836364af.js" as="script"><link rel="prefetch" href="/assets/12-信号量Semaphore.html-3509682c.js" as="script"><link rel="prefetch" href="/assets/13-循环栏栅CyclicBarrier.html-812d137d.js" as="script"><link rel="prefetch" href="/assets/14-阶段Phaser.html-d684f4a1.js" as="script"><link rel="prefetch" href="/assets/15-交换Exchanger.html-b9bf24f3.js" as="script"><link rel="prefetch" href="/assets/16-读写锁ReentrantReadWriteLock.html-de44a1d3.js" as="script"><link rel="prefetch" href="/assets/17-Future模式-FutureTask.html-641c6250.js" as="script"><link rel="prefetch" href="/assets/18-线程池体系概述.html-dbcc52e5.js" as="script"><link rel="prefetch" href="/assets/19-线程池体系-AbstractExecutorService.html-fbd70afb.js" as="script"><link rel="prefetch" href="/assets/20-线程池体系-ThreadPoolExecutor.html-a274637a.js" as="script"><link rel="prefetch" href="/assets/21-线程池体系-ScheduledThreadPoolExecutor.html-707ffd40.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayList写时复制.html-914977b9.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySet写时复制.html-6c9c3cf6.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMap跳表.html-6cff54bf.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSet跳表.html-36cf4f7d.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMap源码分析.html-a3bba8a9.js" as="script"><link rel="prefetch" href="/assets/27-阻塞队列ArrayBlockingQueue.html-cd091357.js" as="script"><link rel="prefetch" href="/assets/28-阻塞队列LinkedBlockingQueue.html-d3579ee7.js" as="script"><link rel="prefetch" href="/assets/29-阻塞队列LinkedBlockingDeque.html-32c13680.js" as="script"><link rel="prefetch" href="/assets/30-阻塞队列PriorityBlockingQueue.html-b5455c77.js" as="script"><link rel="prefetch" href="/assets/31-阻塞队列DelayQueue.html-7759c195.js" as="script"><link rel="prefetch" href="/assets/32-阻塞队列SynchronousQueue.html-97ed879a.js" as="script"><link rel="prefetch" href="/assets/33-阻塞队列LinkedTransferQueue.html-3281c1b4.js" as="script"><link rel="prefetch" href="/assets/index.html-f5239cf3.js" as="script"><link rel="prefetch" href="/assets/SPI机制.html-a1ca3921.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis01：myabtis的整体架构.html-f25c0705.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis02：入门案例.html-30e68cd3.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis03：解析全局配置文件.html-2db85266.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis04：解析Mapper映射文件.html-60756a5b.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis05：解析Statement操作节点.html-31e11b60.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis07：Java方法和SQL语句绑定.html-9bfa3db6.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis08：获得SqlSession.html-e2a92940.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis09：Executor执行器.html-ad701715.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis10：缓存机制.html-f2daa10c.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis11：StatementHandler.html-95b30d9b.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis12：参数解析和赋值.html-5778c0ea.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis13：结果集处理.html-2ff72779.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis14：插件.html-76cc6bf8.js" as="script"><link rel="prefetch" href="/assets/01-服务端启动流程.html-d2fc1f19.js" as="script"><link rel="prefetch" href="/assets/02-服务端启动添加ChannelInitializer到管道.html-86cb5d6a.js" as="script"><link rel="prefetch" href="/assets/03-客户端启动流程.html-becc83be.js" as="script"><link rel="prefetch" href="/assets/04-线程体系-NioEventLoopGroup.html-700e797e.js" as="script"><link rel="prefetch" href="/assets/05-线程体系-NioEventLoop相关父接口分析.html-754320bc.js" as="script"><link rel="prefetch" href="/assets/06-线程体系-AbstractEventExecutor.html-5250cd42.js" as="script"><link rel="prefetch" href="/assets/07-线程体系-AbstractScheduledEventExecutor-优先队列.html-e7bbaf32.js" as="script"><link rel="prefetch" href="/assets/08-线程体系-NioEventLoop概述.html-fce3fb2c.js" as="script"><link rel="prefetch" href="/assets/09-线程体系-NioEventLoop开启Selector及优化.html-6d8230cf.js" as="script"><link rel="prefetch" href="/assets/10-线程体系-NioEventLoop绑定线程.html-db947821.js" as="script"><link rel="prefetch" href="/assets/11-线程体系-NioEventLoop的run方法.html-def4cc31.js" as="script"><link rel="prefetch" href="/assets/12-线程体系-NioEventLoop规避JDK的NIO空循环bug.html-16ecaf4e.js" as="script"><link rel="prefetch" href="/assets/13-线程体系-NioEventLoop的优雅关闭.html-912d668d.js" as="script"><link rel="prefetch" href="/assets/14-服务端处理客户端的连接(ACCEPT).html-63afdec1.js" as="script"><link rel="prefetch" href="/assets/15-客户端处理READ事件概述.html-b35daeb8.js" as="script"><link rel="prefetch" href="/assets/16-客户端处理READ事件详解及RecvByteBufAllocator.html-a9faccfa.js" as="script"><link rel="prefetch" href="/assets/17-Netty管道机制.html-ba70b238.js" as="script"><link rel="prefetch" href="/assets/18-Netty发送数据流程及出站缓冲区.html-223d04a7.js" as="script"><link rel="prefetch" href="/assets/index.html-b475d8b0.js" as="script"><link rel="prefetch" href="/assets/Redis_Benchmark基准测试.html-dbf21951.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群和槽管理命令.html-2b4a1244.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群基本特性和集群搭建.html-42be726b.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群管理工具redis-cli.html-fc4f1503.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipeline优化RTT.html-8a4aa041.js" as="script"><link rel="prefetch" href="/assets/Redis_Sentinel高可用.html-6bcdb34a.js" as="script"><link rel="prefetch" href="/assets/Redis_key设计规范.html-ab90a7dc.js" as="script"><link rel="prefetch" href="/assets/Redis事务.html-e43061e1.js" as="script"><link rel="prefetch" href="/assets/Redis内存淘汰策略.html-feabd314.js" as="script"><link rel="prefetch" href="/assets/Redis发布订阅.html-68771977.js" as="script"><link rel="prefetch" href="/assets/Redis复制.html-33b20d6f.js" as="script"><link rel="prefetch" href="/assets/Redis大key和热key问题.html-394d194e.js" as="script"><link rel="prefetch" href="/assets/Redis慢查询日志.html-7fb06db0.js" as="script"><link rel="prefetch" href="/assets/Redis持久化机制.html-53af3f7a.js" as="script"><link rel="prefetch" href="/assets/Redis键空间通知(keyspace notification).html-012bd277.js" as="script"><link rel="prefetch" href="/assets/redis-cli 使用.html-f7ab22db.js" as="script"><link rel="prefetch" href="/assets/01-RocketMQ概述.html-25463efe.js" as="script"><link rel="prefetch" href="/assets/02-NameServer启动流程.html-a514999f.js" as="script"><link rel="prefetch" href="/assets/03-Broker启动流程.html-43c84806.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQ网络通信原理.html-ac88de8d.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ 服务端和客户端的启动.html-ef7f1888.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQ网络通信源码.html-b8e0bf43.js" as="script"><link rel="prefetch" href="/assets/07-NameServer作用和路由元信息.html-82a23869.js" as="script"><link rel="prefetch" href="/assets/08-NameServer路由管理源码分析.html-8da2bd72.js" as="script"><link rel="prefetch" href="/assets/09-生产者相关类分析.html-08f6e840.js" as="script"><link rel="prefetch" href="/assets/10-生产者启动流程.html-d761cf07.js" as="script"><link rel="prefetch" href="/assets/11-生产者发送消息.html-743328bc.js" as="script"><link rel="prefetch" href="/assets/12-Broker存储机制概述.html-5e7ed491.js" as="script"><link rel="prefetch" href="/assets/13-MappedFile和MappedFileQueue分析.html-5b9afaf2.js" as="script"><link rel="prefetch" href="/assets/14-CommitLog原理分析.html-93362aa2.js" as="script"><link rel="prefetch" href="/assets/15-broker的刷盘机制.html-21e2029f.js" as="script"><link rel="prefetch" href="/assets/16-ConsumeQueue和Index原理分析.html-ff18bade.js" as="script"><link rel="prefetch" href="/assets/17-broker过期文件删除机制.html-89f05919.js" as="script"><link rel="prefetch" href="/assets/18-消费者启动流程(TODO).html-988c43b3.js" as="script"><link rel="prefetch" href="/assets/19-消息拉取入口和消息队列负载均衡.html-7e4e20d4.js" as="script"><link rel="prefetch" href="/assets/20-消费者发送消息拉取请求流程.html-19825069.js" as="script"><link rel="prefetch" href="/assets/21-broker处理消息拉取请求-1-主流程.html-d9ca6fa4.js" as="script"><link rel="prefetch" href="/assets/22-broker处理消息拉取请求-2-长轮询.html-0aba4f38.js" as="script"><link rel="prefetch" href="/assets/23-broker处理消息拉取请求-3-读取消息.html-729d741b.js" as="script"><link rel="prefetch" href="/assets/24-消费者处理从broker拉取的消息.html-dcfb7d07.js" as="script"><link rel="prefetch" href="/assets/25-并发消费原理.html-5ef206ec.js" as="script"><link rel="prefetch" href="/assets/HowToSayResume.html-11d8bbca.js" as="script"><link rel="prefetch" href="/assets/resume.html-3b3f8934.js" as="script"><link rel="prefetch" href="/assets/404.html-f3795607.js" as="script"><link rel="prefetch" href="/assets/index.html-1f3390c0.js" as="script"><link rel="prefetch" href="/assets/index.html-10b45510.js" as="script"><link rel="prefetch" href="/assets/index.html-dfd17ea5.js" as="script"><link rel="prefetch" href="/assets/index.html-2f392b9e.js" as="script"><link rel="prefetch" href="/assets/index.html-0efbdc5e.js" as="script"><link rel="prefetch" href="/assets/index.html-2676a535.js" as="script"><link rel="prefetch" href="/assets/01-创建和销毁对象.html-ecd409f8.js" as="script"><link rel="prefetch" href="/assets/index.html-fd08adae.js" as="script"><link rel="prefetch" href="/assets/01-CAS和Unsafe的API分析.html-8be73d9c.js" as="script"><link rel="prefetch" href="/assets/02-基本类型原子类AtomicLong.html-014b3ef3.js" as="script"><link rel="prefetch" href="/assets/03-引用类型原子类AtomicReference.html-fa3c0bbb.js" as="script"><link rel="prefetch" href="/assets/04-原子数组类AtomicLongArray.html-a79d699f.js" as="script"><link rel="prefetch" href="/assets/05-原子操作类AtomicReferenceFieldUpdater.html-67a037a8.js" as="script"><link rel="prefetch" href="/assets/06-高性能原子类LongAdder.html-1caa64d4.js" as="script"><link rel="prefetch" href="/assets/07-LockSupport分析.html-b480a72d.js" as="script"><link rel="prefetch" href="/assets/08-AQS简单介绍.html-9863f274.js" as="script"><link rel="prefetch" href="/assets/09-基于ReentrantLock分析AQS的独占模式.html-049eb43c.js" as="script"><link rel="prefetch" href="/assets/10-基于CountDownLatch分析AQS的共享模式.html-490eea8c.js" as="script"><link rel="prefetch" href="/assets/11-AQS的Condition机制.html-2efd3d2c.js" as="script"><link rel="prefetch" href="/assets/12-信号量Semaphore.html-0118329c.js" as="script"><link rel="prefetch" href="/assets/13-循环栏栅CyclicBarrier.html-cc830052.js" as="script"><link rel="prefetch" href="/assets/14-阶段Phaser.html-1ef8ace1.js" as="script"><link rel="prefetch" href="/assets/15-交换Exchanger.html-64839a48.js" as="script"><link rel="prefetch" href="/assets/16-读写锁ReentrantReadWriteLock.html-9afb582d.js" as="script"><link rel="prefetch" href="/assets/17-Future模式-FutureTask.html-3109c97e.js" as="script"><link rel="prefetch" href="/assets/18-线程池体系概述.html-d3e4f11d.js" as="script"><link rel="prefetch" href="/assets/19-线程池体系-AbstractExecutorService.html-097fcf36.js" as="script"><link rel="prefetch" href="/assets/20-线程池体系-ThreadPoolExecutor.html-9da96632.js" as="script"><link rel="prefetch" href="/assets/21-线程池体系-ScheduledThreadPoolExecutor.html-ad06f5a3.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayList写时复制.html-1f554844.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySet写时复制.html-64480e71.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMap跳表.html-b60c9282.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSet跳表.html-9b7642be.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMap源码分析.html-6461fc73.js" as="script"><link rel="prefetch" href="/assets/27-阻塞队列ArrayBlockingQueue.html-f4856af9.js" as="script"><link rel="prefetch" href="/assets/28-阻塞队列LinkedBlockingQueue.html-b5c8c7e2.js" as="script"><link rel="prefetch" href="/assets/29-阻塞队列LinkedBlockingDeque.html-85487bb5.js" as="script"><link rel="prefetch" href="/assets/30-阻塞队列PriorityBlockingQueue.html-1ab7c927.js" as="script"><link rel="prefetch" href="/assets/31-阻塞队列DelayQueue.html-9ec2ce17.js" as="script"><link rel="prefetch" href="/assets/32-阻塞队列SynchronousQueue.html-bda808fb.js" as="script"><link rel="prefetch" href="/assets/33-阻塞队列LinkedTransferQueue.html-1db2899f.js" as="script"><link rel="prefetch" href="/assets/index.html-d1c8c799.js" as="script"><link rel="prefetch" href="/assets/SPI机制.html-751a74a2.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis01：myabtis的整体架构.html-b490770d.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis02：入门案例.html-3de2000f.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis03：解析全局配置文件.html-e7afbffa.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis04：解析Mapper映射文件.html-bfab22ff.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis05：解析Statement操作节点.html-74234a3f.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis07：Java方法和SQL语句绑定.html-5303e81c.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis08：获得SqlSession.html-5b7968c7.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis09：Executor执行器.html-23b80ddb.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis10：缓存机制.html-84c2c4cb.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis11：StatementHandler.html-8f66a273.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis12：参数解析和赋值.html-ca08839a.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis13：结果集处理.html-08ee710a.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis14：插件.html-f29f4ebb.js" as="script"><link rel="prefetch" href="/assets/01-服务端启动流程.html-d3f74d2f.js" as="script"><link rel="prefetch" href="/assets/02-服务端启动添加ChannelInitializer到管道.html-b777bd0c.js" as="script"><link rel="prefetch" href="/assets/03-客户端启动流程.html-31d5b8b8.js" as="script"><link rel="prefetch" href="/assets/04-线程体系-NioEventLoopGroup.html-ece3dc3e.js" as="script"><link rel="prefetch" href="/assets/05-线程体系-NioEventLoop相关父接口分析.html-ec7eaa76.js" as="script"><link rel="prefetch" href="/assets/06-线程体系-AbstractEventExecutor.html-6c746b6b.js" as="script"><link rel="prefetch" href="/assets/07-线程体系-AbstractScheduledEventExecutor-优先队列.html-a3a386f8.js" as="script"><link rel="prefetch" href="/assets/08-线程体系-NioEventLoop概述.html-8dd378a3.js" as="script"><link rel="prefetch" href="/assets/09-线程体系-NioEventLoop开启Selector及优化.html-e2af172a.js" as="script"><link rel="prefetch" href="/assets/10-线程体系-NioEventLoop绑定线程.html-6f154f49.js" as="script"><link rel="prefetch" href="/assets/11-线程体系-NioEventLoop的run方法.html-ff61bf45.js" as="script"><link rel="prefetch" href="/assets/12-线程体系-NioEventLoop规避JDK的NIO空循环bug.html-ab9d77e3.js" as="script"><link rel="prefetch" href="/assets/13-线程体系-NioEventLoop的优雅关闭.html-f578d3db.js" as="script"><link rel="prefetch" href="/assets/14-服务端处理客户端的连接(ACCEPT).html-a86b9412.js" as="script"><link rel="prefetch" href="/assets/15-客户端处理READ事件概述.html-d79ce4ff.js" as="script"><link rel="prefetch" href="/assets/16-客户端处理READ事件详解及RecvByteBufAllocator.html-7422eac7.js" as="script"><link rel="prefetch" href="/assets/17-Netty管道机制.html-214e065d.js" as="script"><link rel="prefetch" href="/assets/18-Netty发送数据流程及出站缓冲区.html-f84d3723.js" as="script"><link rel="prefetch" href="/assets/index.html-c30e6045.js" as="script"><link rel="prefetch" href="/assets/Redis_Benchmark基准测试.html-d6b3764e.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群和槽管理命令.html-e0afd203.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群基本特性和集群搭建.html-f1881a76.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群管理工具redis-cli.html-fcba4932.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipeline优化RTT.html-c8513424.js" as="script"><link rel="prefetch" href="/assets/Redis_Sentinel高可用.html-123fe6cf.js" as="script"><link rel="prefetch" href="/assets/Redis_key设计规范.html-460d7819.js" as="script"><link rel="prefetch" href="/assets/Redis事务.html-6b88cb85.js" as="script"><link rel="prefetch" href="/assets/Redis内存淘汰策略.html-cabe5d75.js" as="script"><link rel="prefetch" href="/assets/Redis发布订阅.html-1a0b0a0d.js" as="script"><link rel="prefetch" href="/assets/Redis复制.html-431f5f46.js" as="script"><link rel="prefetch" href="/assets/Redis大key和热key问题.html-c5461835.js" as="script"><link rel="prefetch" href="/assets/Redis慢查询日志.html-2c7f24dd.js" as="script"><link rel="prefetch" href="/assets/Redis持久化机制.html-675c3d43.js" as="script"><link rel="prefetch" href="/assets/Redis键空间通知(keyspace notification).html-510297d3.js" as="script"><link rel="prefetch" href="/assets/redis-cli 使用.html-62381c38.js" as="script"><link rel="prefetch" href="/assets/01-RocketMQ概述.html-8cc3c3fc.js" as="script"><link rel="prefetch" href="/assets/02-NameServer启动流程.html-bd63e5bf.js" as="script"><link rel="prefetch" href="/assets/03-Broker启动流程.html-ac9e344c.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQ网络通信原理.html-5a56cfff.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ 服务端和客户端的启动.html-8d88bd01.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQ网络通信源码.html-44575306.js" as="script"><link rel="prefetch" href="/assets/07-NameServer作用和路由元信息.html-ce37e10a.js" as="script"><link rel="prefetch" href="/assets/08-NameServer路由管理源码分析.html-92b6b565.js" as="script"><link rel="prefetch" href="/assets/09-生产者相关类分析.html-1ceb6edd.js" as="script"><link rel="prefetch" href="/assets/10-生产者启动流程.html-1ad066b1.js" as="script"><link rel="prefetch" href="/assets/11-生产者发送消息.html-05d0eddf.js" as="script"><link rel="prefetch" href="/assets/12-Broker存储机制概述.html-9b0408be.js" as="script"><link rel="prefetch" href="/assets/13-MappedFile和MappedFileQueue分析.html-5d624dda.js" as="script"><link rel="prefetch" href="/assets/14-CommitLog原理分析.html-6ee8f4fe.js" as="script"><link rel="prefetch" href="/assets/15-broker的刷盘机制.html-4a881bad.js" as="script"><link rel="prefetch" href="/assets/16-ConsumeQueue和Index原理分析.html-d4b63e8a.js" as="script"><link rel="prefetch" href="/assets/17-broker过期文件删除机制.html-cb169024.js" as="script"><link rel="prefetch" href="/assets/18-消费者启动流程(TODO).html-27df17d4.js" as="script"><link rel="prefetch" href="/assets/19-消息拉取入口和消息队列负载均衡.html-93d03565.js" as="script"><link rel="prefetch" href="/assets/20-消费者发送消息拉取请求流程.html-bfaedef5.js" as="script"><link rel="prefetch" href="/assets/21-broker处理消息拉取请求-1-主流程.html-883e8a6b.js" as="script"><link rel="prefetch" href="/assets/22-broker处理消息拉取请求-2-长轮询.html-7d5d78bf.js" as="script"><link rel="prefetch" href="/assets/23-broker处理消息拉取请求-3-读取消息.html-5a9f6d42.js" as="script"><link rel="prefetch" href="/assets/24-消费者处理从broker拉取的消息.html-8299b760.js" as="script"><link rel="prefetch" href="/assets/25-并发消费原理.html-ebe59a5c.js" as="script"><link rel="prefetch" href="/assets/HowToSayResume.html-22d0264a.js" as="script"><link rel="prefetch" href="/assets/resume.html-9884b7a3.js" as="script"><link rel="prefetch" href="/assets/404.html-a8548397.js" as="script"><link rel="prefetch" href="/assets/index.html-b12741b5.js" as="script"><link rel="prefetch" href="/assets/index.html-d1dd7084.js" as="script"><link rel="prefetch" href="/assets/index.html-02bce3db.js" as="script"><link rel="prefetch" href="/assets/index.html-d01bf030.js" as="script"><link rel="prefetch" href="/assets/index.html-5d53a89a.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-2450701e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="vp-brand"><img class="vp-nav-logo" src="/小熊猫.png" alt><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis01%EF%BC%9Amyabtis%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="01-myabtis的整体架构"><!---->01-myabtis的整体架构<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis07%EF%BC%9AJava%E6%96%B9%E6%B3%95%E5%92%8CSQL%E8%AF%AD%E5%8F%A5%E7%BB%91%E5%AE%9A.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="02-Java方法和SQL语句绑定"><!---->02-Java方法和SQL语句绑定<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis02%EF%BC%9A%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="02-入门案例"><!---->02-入门案例<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis03%EF%BC%9A%E8%A7%A3%E6%9E%90%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="03-解析全局配置文件"><!---->03-解析全局配置文件<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis04%EF%BC%9A%E8%A7%A3%E6%9E%90Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="04-解析Mapper映射文件"><!---->04-解析Mapper映射文件<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis05%EF%BC%9A%E8%A7%A3%E6%9E%90Statement%E6%93%8D%E4%BD%9C%E8%8A%82%E7%82%B9.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="05-解析Statement操作节点"><!---->05-解析Statement操作节点<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html" class="router-link-active router-link-exact-active nav-link active vp-sidebar-link vp-sidebar-page active" aria-label="06-解析SQL语句"><!---->06-解析SQL语句<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#准备知识" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="准备知识"><!---->准备知识<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#mappedstatement" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="MappedStatement"><!---->MappedStatement<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#sqlsource" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="SqlSource"><!---->SqlSource<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#boundsql" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="BoundSql"><!---->BoundSql<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#动态标签sqlnode" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="动态标签SqlNode"><!---->动态标签SqlNode<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#xmlscriptbuilder" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="XMLScriptBuilder"><!---->XMLScriptBuilder<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#languagedriver" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="LanguageDriver"><!---->LanguageDriver<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#dynamiccontext" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="DynamicContext"><!---->DynamicContext<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#解析sql入口" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="解析SQL入口"><!---->解析SQL入口<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#解析流程分析" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="解析流程分析"><!---->解析流程分析<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#节点树结构" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="节点树结构"><!---->节点树结构<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#解析流程" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="解析流程"><!---->解析流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#源码阅读" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="源码阅读"><!---->源码阅读<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#创建xmlscriptbuilder" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="创建XMLScriptBuilder"><!---->创建XMLScriptBuilder<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#判断是否是动态sql" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="判断是否是动态SQL"><!---->判断是否是动态SQL<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#ifhandler" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="IfHandler"><!---->IfHandler<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#foreachhandler" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="ForEachHandler"><!---->ForEachHandler<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#创建sqlsource" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="创建SqlSource"><!---->创建SqlSource<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#小结" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="小结"><!---->小结<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis08%EF%BC%9A%E8%8E%B7%E5%BE%97SqlSession.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="08-获得SqlSession"><!---->08-获得SqlSession<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis09%EF%BC%9AExecutor%E6%89%A7%E8%A1%8C%E5%99%A8.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="09-Executor执行器"><!---->09-Executor执行器<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis10%EF%BC%9A%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="10-缓存机制"><!---->10-缓存机制<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis11%EF%BC%9AStatementHandler.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="11-StatementHandler"><!---->11-StatementHandler<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis12%EF%BC%9A%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%92%8C%E8%B5%8B%E5%80%BC.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="12-参数解析和赋值"><!---->12-参数解析和赋值<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis13%EF%BC%9A%E7%BB%93%E6%9E%9C%E9%9B%86%E5%A4%84%E7%90%86.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="13-结果集处理"><!---->13-结果集处理<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis14%EF%BC%9A%E6%8F%92%E4%BB%B6.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="14-插件"><!---->14-插件<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->06-解析SQL语句</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">超威蓝猫 Dylan Kwok</span></span><span property="author" content="超威蓝猫 Dylan Kwok"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-06-04T10:30:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 11 分钟</span><meta property="timeRequired" content="PT11M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#准备知识" class="router-link-active router-link-exact-active toc-link level2">准备知识</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#mappedstatement" class="router-link-active router-link-exact-active toc-link level3">MappedStatement</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#sqlsource" class="router-link-active router-link-exact-active toc-link level3">SqlSource</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#boundsql" class="router-link-active router-link-exact-active toc-link level3">BoundSql</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#动态标签sqlnode" class="router-link-active router-link-exact-active toc-link level3">动态标签SqlNode</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#xmlscriptbuilder" class="router-link-active router-link-exact-active toc-link level3">XMLScriptBuilder</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#languagedriver" class="router-link-active router-link-exact-active toc-link level3">LanguageDriver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#dynamiccontext" class="router-link-active router-link-exact-active toc-link level3">DynamicContext</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#解析sql入口" class="router-link-active router-link-exact-active toc-link level2">解析SQL入口</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#解析流程分析" class="router-link-active router-link-exact-active toc-link level2">解析流程分析</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#节点树结构" class="router-link-active router-link-exact-active toc-link level3">节点树结构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#解析流程" class="router-link-active router-link-exact-active toc-link level3">解析流程</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#源码阅读" class="router-link-active router-link-exact-active toc-link level2">源码阅读</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#创建xmlscriptbuilder" class="router-link-active router-link-exact-active toc-link level3">创建XMLScriptBuilder</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#判断是否是动态sql" class="router-link-active router-link-exact-active toc-link level3">判断是否是动态SQL</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#ifhandler" class="router-link-active router-link-exact-active toc-link level3">IfHandler</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#foreachhandler" class="router-link-active router-link-exact-active toc-link level3">ForEachHandler</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#创建sqlsource" class="router-link-active router-link-exact-active toc-link level2">创建SqlSource</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis06%EF%BC%9A%E8%A7%A3%E6%9E%90SQL%E8%AF%AD%E5%8F%A5.html#小结" class="router-link-active router-link-exact-active toc-link level2">小结</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><table><thead><tr><th>版本</th><th>内容</th><th>时间</th></tr></thead><tbody><tr><td>V1</td><td>新建</td><td>2021年6月9日23:50:39</td></tr></tbody></table><p>摘要：解析我们写的SQL脚本，构建一个节点树，获得SqlSource对象。</p><p>在看解析SQL语句的源码的时候，需要知道一些类。</p><h2 id="准备知识" tabindex="-1"><a class="header-anchor" href="#准备知识" aria-hidden="true">#</a> 准备知识</h2><h3 id="mappedstatement" tabindex="-1"><a class="header-anchor" href="#mappedstatement" aria-hidden="true">#</a> MappedStatement</h3><p>首先有一个很重要的MappedStatement类，它其实就是对应一个数据库操作节点，也就是SELECT、INSERT、UPDATE、DELETE这些。</p><p>例如有一个节点的操作如下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.guosgbin.mybatis.example.entity.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select * from tb_user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那么它解析出来的MappedStatement的对象就如下：</p><img src="/assets/MappedStatement对象属性-ff4351cd.png" alt="MappedStatement对象属性" style="zoom:80%;"><h3 id="sqlsource" tabindex="-1"><a class="header-anchor" href="#sqlsource" aria-hidden="true">#</a> SqlSource</h3><p>这个类其实就是对应的数据库操作节点中我们手写的原始SQL，例如</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>SELECT * FROM tb_user WHERE id = #{id}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>又或者：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>SELECT * FROM tb_user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.name != null and user.name !=&#39;&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        AND name = #{user.name}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.age != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        AND age = #{user.age}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意的是第一个算是普通的SQL，第二个因为它带了<code>&lt;if&gt;</code>这种标签，所以它算是动态SQL，还有一个特别的情况是<code>${}</code>符号，它也算是动态SQL。</p><p>SqlSource是一个接口，就只有一个<code>getBoundSql()</code>抽象方法，下面是SqlSource的继承关系。</p><img src="/assets/SqlSource类图-2f055f51.png" alt="SqlSource类图" style="zoom:80%;"><p>四种实现类作用和区别如下：</p><ul><li><strong>DynamicSqlSource</strong>：动态的SQL语句，就是我们写的SQL中代用<code>&lt;if&gt;</code>这种标签或者含有<code>${}</code>符的SQl语句。</li><li><strong>RawSqlSource</strong>：原生的SQL语句，没有任何标签或者仅仅是<code>#{}</code>占位符的。</li><li><strong>StaticSqlSource</strong>：静态的SQL语句，也就是数据库能直接执行的语句，或者是有<code>?</code>占位符的SQL。</li><li>ProviderSqlSource：注解得到的SQL语句。</li></ul><p>因为DynamicSqlSource和RawSqlSource这两种SQL是不能直接交给数据库去执行的，最终是要<strong>转换为StaticSqlSource</strong>才能交给数据库去执行。</p><h3 id="boundsql" tabindex="-1"><a class="header-anchor" href="#boundsql" aria-hidden="true">#</a> BoundSql</h3><p>这个类是由SqlSource对象得到的，具体包含数据库能够直接执行的SQL，和一些参数映射列表等。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 可能含有“?”占位符的sql语句</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> sql<span class="token punctuation">;</span>
<span class="token comment">// 参数映射列表</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ParameterMapping</span><span class="token punctuation">&gt;</span></span> parameterMappings<span class="token punctuation">;</span>
<span class="token comment">// 入参</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> parameterObject<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> additionalParameters<span class="token punctuation">;</span>
<span class="token comment">// additionalParameters的包装对象</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MetaObject</span> metaParameters<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="动态标签sqlnode" tabindex="-1"><a class="header-anchor" href="#动态标签sqlnode" aria-hidden="true">#</a> 动态标签SqlNode</h3><p>我们知道，在Mybatis中支持很多动态标签，如下：</p><ol><li>if</li><li>choose</li><li>when</li><li>otherwise</li><li>trim</li><li>where</li><li>set</li><li>foreach</li></ol><p>Myabtis中有一个SqlNode接口代表动态标签，它有很多的子类，上面的那些动态标签都对应一个SqlNode的实现类。</p><img src="/assets/SqlNode类图-a79e6a85.png" alt="SqlNode类图" style="zoom:80%;"><h3 id="xmlscriptbuilder" tabindex="-1"><a class="header-anchor" href="#xmlscriptbuilder" aria-hidden="true">#</a> XMLScriptBuilder</h3><p>XMLScriptBuilder是继承自BaseBuilder，很明显它是用来解析SQL脚本的。成员属性如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 当前要处理的XML节点</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">XNode</span> context<span class="token punctuation">;</span>
<span class="token comment">// 当前节点是否为动态节点</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span> isDynamic<span class="token punctuation">;</span>
<span class="token comment">// 输入参数的类型</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">;</span>
<span class="token comment">// 节点类型和对应的处理器组成的Map</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">NodeHandler</span><span class="token punctuation">&gt;</span></span> nodeHandlerMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为SQL脚本有很多动态的标签，最后有一个Map存放解析每种动态标签的处理器。</p><p>在XMLScriptBuilder中有一个NodeHandler接口，根据不同的标签有不同的实现，</p><img src="/assets/NodeHandler类图-79e995f5.png" alt="NodeHandler类图" style="zoom:80%;"><p>每个NodeHandler都有自己的<code>handleNode()</code>方法，用于解析不同的动态节点。</p><p>在XMLScriptBuilder中会有一个Map来存储各个节点的NodeHandler实现。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 初始化 动态sql的节点的名称和对应的处理器
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initNodeHandlerMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;trim&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TrimHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;where&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">WhereHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;set&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SetHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foreach&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ForEachHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;if&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IfHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;choose&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ChooseHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;when&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IfHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;otherwise&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OtherwiseHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bind&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BindHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="languagedriver" tabindex="-1"><a class="header-anchor" href="#languagedriver" aria-hidden="true">#</a> LanguageDriver</h3><p>用于创建SqlSource对象和ParameterHandler对象。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LanguageDriver</span> <span class="token punctuation">{</span>

  <span class="token doc-comment comment">/**
   * 创建参数处理器。参数处理器能将实参传递给JDBC statement。
   *
   * <span class="token keyword">@author</span> Frank D. Martinez [mnesarco]
   * <span class="token keyword">@param</span> <span class="token parameter">mappedStatement</span> The mapped statement that is being executed 完整的数据库操作节点
   * <span class="token keyword">@param</span> <span class="token parameter">parameterObject</span> The input parameter object (can be null) 参数对象
   * <span class="token keyword">@param</span> <span class="token parameter">boundSql</span> The resulting SQL once the dynamic language has been executed.数据库操作语句转化的BoundSql对象
   * <span class="token keyword">@return</span> the parameter handler 参数处理器
   * <span class="token keyword">@see</span> <span class="token reference"><span class="token class-name">DefaultParameterHandler</span></span>
   */</span>
  <span class="token class-name">ParameterHandler</span> <span class="token function">createParameterHandler</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> mappedStatement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameterObject<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token doc-comment comment">/**
   * 创建SqlSource对象（基于映射文件的方式）。该方法在MyBatis启动阶段，读取映射接口或映射文件时被调用
   *
   * <span class="token keyword">@param</span> <span class="token parameter">configuration</span> The MyBatis configuration 配置信息
   * <span class="token keyword">@param</span> <span class="token parameter">script</span> XNode parsed from a XML file 映射文件中的数据库操作节点
   * <span class="token keyword">@param</span> <span class="token parameter">parameterType</span> input parameter type got from a mapper method or specified in the parameterType xml attribute. Can be null. 参数类型
   * <span class="token keyword">@return</span> the sql source SqlSource对象
   */</span>
  <span class="token class-name">SqlSource</span> <span class="token function">createSqlSource</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">XNode</span> script<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token doc-comment comment">/**
   * 创建SqlSource对象（基于注解的方式）。该方法在MyBatis启动阶段，读取映射接口或映射文件时被调用
   *
   * <span class="token keyword">@param</span> <span class="token parameter">configuration</span> The MyBatis configuration 配置信息
   * <span class="token keyword">@param</span> <span class="token parameter">script</span> The content of the annotation 注解中的SQL字符串
   * <span class="token keyword">@param</span> <span class="token parameter">parameterType</span> input parameter type got from a mapper method or specified in the parameterType xml attribute. Can be null. 参数类型
   * <span class="token keyword">@return</span> the sql source  SqlSource对象，具体来说是DynamicSqlSource和RawSqlSource中的一种
   */</span>
  <span class="token class-name">SqlSource</span> <span class="token function">createSqlSource</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">String</span> script<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dynamiccontext" tabindex="-1"><a class="header-anchor" href="#dynamiccontext" aria-hidden="true">#</a> DynamicContext</h3><p>在解析SQL节点树的时候，我们需要不断的去保存已经解析出来的SQL段，DynamicContext类就是用来保存解析出得SQL片段的。另外解析SQL树的时候需要的一些环境的信息，也是由它来提供的。</p><p>字段如下：很明显<strong>sqlBuilder就是用来保存解析出来的SQL段的。</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 上下文环境</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ContextMap</span> bindings<span class="token punctuation">;</span>
<span class="token comment">// 用于拼装SQL语句片段</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StringJoiner</span> sqlBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 解析时的唯一编号，防止解析混乱</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> uniqueNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="解析sql入口" tabindex="-1"><a class="header-anchor" href="#解析sql入口" aria-hidden="true">#</a> 解析SQL入口</h2><p>在解析阶段，其实就是需要把SQL解析成SqlSource对象，作为属性添加到MappedStatement类中，最终设置到了Configuration类中去了。</p><p><strong>基于XML的解析SQL的入口是</strong>：XMLStatementBuilder中有个<code>parseStatementNode()</code>方法，其中有下面这一句，这就是解析SQL的入口。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SqlSource</span> sqlSource <span class="token operator">=</span> langDriver<span class="token punctuation">.</span><span class="token function">createSqlSource</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> context<span class="token punctuation">,</span> parameterTypeClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>基于注解的解析SQL的入口是</strong>：MapperAnnotationBuilder中有个<code>parseStatement(Method)</code>方法，其中有下面这一句，就是解析SQL语句的入口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">SqlSource</span> sqlSource <span class="token operator">=</span> <span class="token function">buildSqlSource</span><span class="token punctuation">(</span>statementAnnotation<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parameterTypeClass<span class="token punctuation">,</span> languageDriver<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在解析阶段，其实就是将原生写的SQL变成一个SqlSource对象。</p><h2 id="解析流程分析" tabindex="-1"><a class="header-anchor" href="#解析流程分析" aria-hidden="true">#</a> 解析流程分析</h2><h3 id="节点树结构" tabindex="-1"><a class="header-anchor" href="#节点树结构" aria-hidden="true">#</a> 节点树结构</h3><p>关于动态节点，给个例子如下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectByCondition01<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.guosgbin.mybatis.example.entity.User<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.guosgbin.mybatis.example.entity.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT * FROM tb_user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.name != null and user.name !=&#39;&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            AND name = #{user.name}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.age != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            AND age = #{user.age}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种结构可以看成是一个节点树，Mybatis是使用XMLScriptBuilder来构建这个节点树的。</p><p>上面的<code>SELECT * FROM tb_user</code>是不带<code>${}</code>和动态标签的，所以这行是StaticTextSqlNode。</p><p><code> &lt;where&gt;</code>标签下面还有<code>&lt;if&gt;</code>标签，它算是混合的Node，也就是MixedSqlNode。</p><p><code>&lt;if&gt;</code>标签下没有别的标签了，它是IfSqlNode。</p><p>上面SQL的整体构造可以如下图所示</p><p><img src="/assets/SQL节点树-aa409bd3.png" alt="SQL节点树"></p><p>当然IfSqlNode下面也还可以再嵌套子标签。</p><p>实际debug出来的where标签里面有5个，但是我们只有两个if标签，其实里面是换行符号，所以被转换成了StaticTextSqlNode加到SQL节点树里去了。</p><h3 id="解析流程" tabindex="-1"><a class="header-anchor" href="#解析流程" aria-hidden="true">#</a> 解析流程</h3><img src="/assets/解析SQL节点树-f7dd7ecc.png" alt="解析SQL节点树" style="zoom:60%;"><h2 id="源码阅读" tabindex="-1"><a class="header-anchor" href="#源码阅读" aria-hidden="true">#</a> 源码阅读</h2><p>在XMLLanguageDriver的针对XML的createSqlSource方法如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SqlSource</span> <span class="token function">createSqlSource</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">XNode</span> script<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">XMLScriptBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLScriptBuilder</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> script<span class="token punctuation">,</span> parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">parseScriptNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建xmlscriptbuilder" tabindex="-1"><a class="header-anchor" href="#创建xmlscriptbuilder" aria-hidden="true">#</a> 创建XMLScriptBuilder</h3><p>创建一个XMLScriptBuilder对象，调用其<code>parseScriptNode()</code>方法去解析我们写的SQL。源码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 解析节点生成SqlSource对象
 *
 * <span class="token keyword">@return</span> SqlSource对象
 */</span>
<span class="token keyword">public</span> <span class="token class-name">SqlSource</span> <span class="token function">parseScriptNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 解析XML节点节点，得到节点树MixedSqlNode</span>
    <span class="token class-name">MixedSqlNode</span> rootSqlNode <span class="token operator">=</span> <span class="token function">parseDynamicTags</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlSource</span> sqlSource<span class="token punctuation">;</span>
    <span class="token comment">// 根据节点树是否为动态，创建对应的SqlSource对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isDynamic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sqlSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicSqlSource</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> rootSqlNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        sqlSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RawSqlSource</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> rootSqlNode<span class="token punctuation">,</span> parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sqlSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前面说过我们写的SQL分为动态和非动态的，</p><ul><li><strong>DynamicSqlSource</strong>：动态的SQL语句，就是我们写的SQL中代用<code>&lt;if&gt;</code>这种标签或者含有<code>${}</code>符的SQl语句。</li><li><strong>RawSqlSource</strong>：原生的SQL语句，没有任何标签或者仅仅是<code>#{}</code>占位符的。</li></ul><p>具体判断是否是动态的SQL，是<code>parseScriptNode()</code>的<code>parseDynamicTags(context)</code>去判断的。</p><h3 id="判断是否是动态sql" tabindex="-1"><a class="header-anchor" href="#判断是否是动态sql" aria-hidden="true">#</a> 判断是否是动态SQL</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 将XNode对象解析为节点树
 *
 * <span class="token keyword">@param</span> <span class="token parameter">node</span> XNode对象，即数据库操作节点
 * <span class="token keyword">@return</span> 解析后得到的节点树
 */</span>
<span class="token keyword">protected</span> <span class="token class-name">MixedSqlNode</span> <span class="token function">parseDynamicTags</span><span class="token punctuation">(</span><span class="token class-name">XNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// XNode拆分出的SqlNode列表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> contents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 输入XNode的子XNode</span>
    <span class="token class-name">NodeList</span> children <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 循环遍历每一个子XNode</span>
        <span class="token class-name">XNode</span> child <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">newXNode</span><span class="token punctuation">(</span>children<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">CDATA_SECTION_NODE</span> <span class="token operator">||</span> child<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">TEXT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取XNode内的信息</span>
            <span class="token class-name">String</span> data <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getStringBody</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TextSqlNode</span> textSqlNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextSqlNode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 只要有一个TextSqlNode对象是动态的，则整个MixedSqlNode是动态的</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>textSqlNode<span class="token punctuation">.</span><span class="token function">isDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                contents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>textSqlNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isDynamic <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                contents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StaticTextSqlNode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// issue #628</span>
            <span class="token class-name">String</span> nodeName <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 找到对应的处理器</span>
            <span class="token class-name">NodeHandler</span> handler <span class="token operator">=</span> nodeHandlerMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuilderException</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown element &lt;&quot;</span> <span class="token operator">+</span> nodeName <span class="token operator">+</span> <span class="token string">&quot;&gt; in SQL statement.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 用处理器处理节点</span>
            handler<span class="token punctuation">.</span><span class="token function">handleNode</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
            isDynamic <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回一个混合节点，其实就是一个SQL节点树</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MixedSqlNode</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>抽取上面的代码讲解：</p><p>第一行的List，其实就是存放节点树的。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> contents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>假如是文本节点</strong>，就是不带动态标签的SQL，先会传入解析出来的SQL段调用构造方法创建TextSqlNode对象，</p><p>创建TextSqlNode的对象的目的是因为它能够处理<code>${}</code>符，里面还带有一个<code>isDynamic()</code>方法，它能够判断这个SQL段里面有没有<code>${}</code>，如果有则说明是动态的，没有的话就创建一个StaticTextSqlNode对象，表示是一个静态的SqlNode。</p><p>最终<strong>都会添加到节点树中去</strong>。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">TextSqlNode</span> textSqlNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextSqlNode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 只要有一个TextSqlNode对象是动态的，则整个MixedSqlNode是动态的</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>textSqlNode<span class="token punctuation">.</span><span class="token function">isDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    contents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>textSqlNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    isDynamic <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    contents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StaticTextSqlNode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>假如解析出来某一段还是Node对象，也就是动态标签</strong>，此时会拿到动态标签的名称，根据名称去得到对应的标签的处理器，就是最上面的讲到的NodeHandler接口。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> nodeName <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 找到对应的处理器</span>
<span class="token class-name">NodeHandler</span> handler <span class="token operator">=</span> nodeHandlerMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuilderException</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown element &lt;&quot;</span> <span class="token operator">+</span> nodeName <span class="token operator">+</span> <span class="token string">&quot;&gt; in SQL statement.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用处理器处理节点</span>
handler<span class="token punctuation">.</span><span class="token function">handleNode</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
isDynamic <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来拿几个动态节点处理器讲解</p><h3 id="ifhandler" tabindex="-1"><a class="header-anchor" href="#ifhandler" aria-hidden="true">#</a> IfHandler</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.name != null and user.name !=&#39;&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    AND name = #{user.name}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>假如解析SQL的时候遇到了if标签，此时会用到IfHandler的<code>handleNode()</code>方法。在里面会继续调用<code>parseDynamicTags()</code>递归解析。</p><p>会获取<code>&lt;if&gt;</code>标签的test属性存的表达式，就上上面的<code>user.name != null and user.name !=&#39;&#39;</code>，然后就去创建IfSqlNode对象了。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token doc-comment comment">/**
   * 该方法将当前节点拼装到节点树中
   *
   * <span class="token keyword">@param</span> <span class="token parameter">nodeToHandle</span> 要被拼接的节点
   * <span class="token keyword">@param</span> <span class="token parameter">targetContents</span> 节点树
   */</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleNode</span><span class="token punctuation">(</span><span class="token class-name">XNode</span> nodeToHandle<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> targetContents<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 解析该节点的下级节点</span>
    <span class="token class-name">MixedSqlNode</span> mixedSqlNode <span class="token operator">=</span> <span class="token function">parseDynamicTags</span><span class="token punctuation">(</span>nodeToHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取该节点的test属性</span>
    <span class="token class-name">String</span> test <span class="token operator">=</span> nodeToHandle<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个IfSqlNode</span>
    <span class="token class-name">IfSqlNode</span> ifSqlNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IfSqlNode</span><span class="token punctuation">(</span>mixedSqlNode<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将创建的IfSqlNode放入到SQL节点树中</span>
    targetContents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ifSqlNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="foreachhandler" tabindex="-1"><a class="header-anchor" href="#foreachhandler" aria-hidden="true">#</a> ForEachHandler</h3><p>其实就是把标签的属性都存起来了，放到节点树里了。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleNode</span><span class="token punctuation">(</span><span class="token class-name">XNode</span> nodeToHandle<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> targetContents<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">MixedSqlNode</span> mixedSqlNode <span class="token operator">=</span> <span class="token function">parseDynamicTags</span><span class="token punctuation">(</span>nodeToHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> collection <span class="token operator">=</span> nodeToHandle<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;collection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> item <span class="token operator">=</span> nodeToHandle<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> index <span class="token operator">=</span> nodeToHandle<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token keyword">open</span> <span class="token operator">=</span> nodeToHandle<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> close <span class="token operator">=</span> nodeToHandle<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> separator <span class="token operator">=</span> nodeToHandle<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;separator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ForEachSqlNode</span> forEachSqlNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForEachSqlNode</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> mixedSqlNode<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> index<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token keyword">open</span><span class="token punctuation">,</span> close<span class="token punctuation">,</span> separator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    targetContents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>forEachSqlNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="创建sqlsource" tabindex="-1"><a class="header-anchor" href="#创建sqlsource" aria-hidden="true">#</a> 创建SqlSource</h2><p>假如是动态SQL的话则会去创建DynamicSqlSource对象。</p><p>假如不是动态SQL则会去创建RawSqlSource对象。</p><p>RawqlSource对象最终会调用到org.apache.ibatis.builder.SqlSourceBuilder#parse方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 将DynamicSqlSource和RawSqlSource中的“#<span class="token punctuation">{</span><span class="token punctuation">}</span>”符号替换掉，从而将他们转化为StaticSqlSource
 *
 * <span class="token keyword">@param</span> <span class="token parameter">originalSql</span> sqlNode.apply()拼接之后的sql语句。已经不包含<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>等节点，也不含有$<span class="token punctuation">{</span><span class="token punctuation">}</span>符号
 * <span class="token keyword">@param</span> <span class="token parameter">parameterType</span> 实参类型
 * <span class="token keyword">@param</span> <span class="token parameter">additionalParameters</span> 附加参数
 * <span class="token keyword">@return</span> 解析结束的StaticSqlSource
 */</span>
<span class="token keyword">public</span> <span class="token class-name">SqlSource</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> originalSql<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> additionalParameters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用来完成#{}处理的处理器</span>
    <span class="token class-name">ParameterMappingTokenHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParameterMappingTokenHandler</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> parameterType<span class="token punctuation">,</span> additionalParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通用的占位符解析器，用来进行占位符替换</span>
    <span class="token class-name">GenericTokenParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericTokenParser</span><span class="token punctuation">(</span><span class="token string">&quot;#{&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将#{}替换为?的SQL语句</span>
    <span class="token class-name">String</span> sql<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">isShrinkWhitespacesInSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sql <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">removeExtraWhitespaces</span><span class="token punctuation">(</span>originalSql<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        sql <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>originalSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 生成新的StaticSqlSource对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StaticSqlSource</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> handler<span class="token punctuation">.</span><span class="token function">getParameterMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在GenericTokenParser的<code>parse()</code>方法中，会将<code>#{}</code>中的字符串提出出来放到参数映射列表parameterMappings中去保存。</p><p>由于DynamicSqlSource是动态SQL，所以每次的参数映射列表可能不一样，所以会在每次执行SQL之前去调用org.apache.ibatis.scripting.xmltags.DynamicSqlSource#getBoundSql方法，这样才会去根据参数不同来组装SQL。</p><p>最后还是会调用在GenericTokenParser的<code>parse()</code>方法。</p><p>可以看到无论是DynamicSqlSource，还是RawSqlSource最终都会转为StaticSqlSource。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h2><p>本篇只是讲解解析配置的时候，是如何解析获得SqlSource对象的，最后是存入到MappedStatement里去了。</p><p>具体使用的时候，后续再说。因为有动态标签的存在，所以每次传参可能不同，所以动态SQL会在执行SQL的时候再去解析一遍。后面说。</p><p>也没什么好小结的，再回过头去看一下上面的图就可以了。</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: guosgbin@163.com">Dylan Kwok</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis05%EF%BC%9A%E8%A7%A3%E6%9E%90Statement%E6%93%8D%E4%BD%9C%E8%8A%82%E7%82%B9.html" class="nav-link prev" aria-label="05-解析Statement操作节点"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->05-解析Statement操作节点</div></a><a href="/Mybatis_source/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAMybatis08%EF%BC%9A%E8%8E%B7%E5%BE%97SqlSession.html" class="nav-link next" aria-label="08-获得SqlSession"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">08-获得SqlSession<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-50fc29a7.js" defer></script>
  </body>
</html>
