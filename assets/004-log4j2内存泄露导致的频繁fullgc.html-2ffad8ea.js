import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as r,f as i}from"./app-341a7728.js";const t="/assets/image-20240301122232905-de489138.png",s="/assets/image-20240301122412468-394a1712.png",l="/assets/image-20240301142204610-807f09fe.png",o="/assets/image-20240301142914193-651434f9.png",g="/assets/image-20240301142815763-bd4b85bb.png",n="/assets/image-20240301143518060-4f9ba2fc.png",d="/assets/image-20240301153345137-f4b84d39.png",c="/assets/image-20240301154038886-3f5bd26a.png",p="/assets/image-20240301154444481-4dec8b38.png",h={},m=i('<h2 id="ç°è±¡" tabindex="-1"><a class="header-anchor" href="#ç°è±¡" aria-hidden="true">#</a> ç°è±¡</h2><p>çº¿ä¸ŠæœåŠ¡çªç„¶å‘ç”Ÿé¢‘ç¹çš„ Full GCï¼Œå¹¶ä¸”æ¯æ¬¡ Full GC ååªå›æ”¶ä¸€ç‚¹ç‚¹å†…å­˜ï¼Œè€å¹´ä»£çš„å†…å­˜ä½¿ç”¨ç‡ä¸é™ã€‚</p><ul><li>é¢‘ç¹å‘ç”Ÿ Full GC ğŸ‘‡ğŸ»</li></ul><img src="'+t+'" alt="image-20240301122232905" style="zoom:100%;"><ul><li>æ¯æ¬¡ Full GC è€å¹´ä»£åªå›æ”¶äº†ä¸€ç‚¹ç‚¹å†…å­˜ ğŸ‘‡ğŸ»</li></ul><img src="'+s+'" alt="image-20240301122412468" style="zoom:100%;"><h2 id="æ’æŸ¥æ–¹å‘" tabindex="-1"><a class="header-anchor" href="#æ’æŸ¥æ–¹å‘" aria-hidden="true">#</a> æ’æŸ¥æ–¹å‘</h2><p>ç¬¬ä¸€æ—¶é—´ä¸‹è½½ dump çš„ prof æ–‡ä»¶ï¼Œå¹¶å¯¹å°†è¯¥æœåŠ¡å™¨çš„æµé‡åˆ‡èµ°ã€‚</p><h2 id="é—®é¢˜æ’æŸ¥å’Œåˆ†æ" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜æ’æŸ¥å’Œåˆ†æ" aria-hidden="true">#</a> é—®é¢˜æ’æŸ¥å’Œåˆ†æ</h2><h3 id="å®šä½ä¸šåŠ¡ä»£ç " tabindex="-1"><a class="header-anchor" href="#å®šä½ä¸šåŠ¡ä»£ç " aria-hidden="true">#</a> å®šä½ä¸šåŠ¡ä»£ç </h3><p>visualVm å‘ç°å¤§é‡ char[]ã€‚æŒ‰å¤§å°æ’åºï¼Œå‰é¢éƒ¨åˆ†åŸºæœ¬éƒ½æ˜¯å­˜å‚¨çš„ log æ—¥å¿—ï¼Œå¤§å°éƒ½å¥½å‡ å…†ï¼Œæ€€ç–‘æ˜¯æ‰“äº†å¤§æ—¥å¿—æœ‰å…³ï¼Œæ’æŸ¥ç›¸å…³ä¸šåŠ¡ï¼Œå…³é—­äº†ä¸€äº›ä¸åˆç†çš„æ—¥å¿—ã€‚</p><img src="'+l+'" alt="image-20240301142204610" style="zoom:100%;"><p>å°†å…¶ä¸­ä¸€ä¸ªchar[] æ•°ç»„çš„å†…å®¹æ‹¿å‡ºæ¥çœ‹ä¸€ä¸‹ï¼š</p><img src="'+o+'" alt="image-20240301142914193"><p>å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p><img src="'+g+'" alt="image-20240301142815763"><p>ä»ä»£ç ä¸­çœ‹åˆ°ï¼Œè¿™æ¡æ—¥å¿—å¹¶ä¸é•¿ï¼Œä¸ºå•¥è¿™ä¸ª char[] å´å¥½å‡ mï¼Œè€Œä¸” unansweredCnt:0 åé¢çš„æ—¥å¿—æ˜æ˜¾è·Ÿå‰é¢çš„æ¥ä¸ä¸Š, éšä¾¿æ‰¾äº†å…¶ä»–çš„char[] ä¹Ÿæœ‰è¿™ç§æƒ…å†µã€‚</p><h3 id="åˆ†æå¼•ç”¨é“¾è·¯" tabindex="-1"><a class="header-anchor" href="#åˆ†æå¼•ç”¨é“¾è·¯" aria-hidden="true">#</a> åˆ†æå¼•ç”¨é“¾è·¯</h3><p>é€šè¿‡ referencesï¼Œåˆ†æå¼•ç”¨é“¾è·¯</p><img src="'+n+'" alt="image-20240301143518060"><p>å‘ç°æ—¥å¿—æœ€ç»ˆç¼“å­˜åˆ° StringBuilderï¼Œè€Œè¿™ä¸ª StringBuilder å­˜å‚¨åˆ°äº†çº¿ç¨‹çš„ ThreadLocal é‡Œé¢å»äº†ã€‚</p><p>æœç´¢ Log4j2 åœ¨ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº† StringBuilderï¼Œæ’æŸ¥å‘ç° org.apache.logging.log4j.message.ParameterizedMessage è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªå¤ç”¨ StringBuilder çš„ä»£ç ï¼Œçº¿ä¸Šä½¿ç”¨ log4j-api çš„ç‰ˆæœ¬æ˜¯ 2.6.1</p><img src="'+d+'" alt="image-20240301153345137"><p>è¿™æ®µä»£ç ä¸­ Log4j2 å¼•ç”¨äº†ä¸€ä¸ª ThreadLocal ä¸­çš„ StringBuilderï¼Œè¿™æ ·å¤ç”¨ StringBuilder å¯ä»¥å¤§å¹…æé«˜æ—¥å¿—è¾“å‡ºæ•ˆç‡ï¼Œä½†æ˜¯è¿™æ®µä»£ç  buffer.setLength(0)ï¼Œè¿™ä¸ªæ“ä½œåªä¼šå°† StringBuilder çš„å†™å…¥é‡ç½®ä¸ºä» 0 å¼€å§‹å†™å…¥ï¼Œä½†ä¸ä¼šå›æ”¶ StringBuilder å·²ç»å ç”¨çš„å†…å­˜ï¼Œç”±äºå½“å‰çš„ ThreadLocal æ˜¯ tomcat çš„çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ï¼Œçº¿ç¨‹ä¸€èˆ¬ä¸ä¼šé”€æ¯ï¼Œæ‰€ä»¥ ThreadLocal å°±åŸºæœ¬æ²¡å•¥å¯èƒ½ä¼šè¢«é‡Šæ”¾ï¼Œå¯¼è‡´StringBuilder ä¹Ÿä¸ä¼šè¢«å›æ”¶ã€‚è¿™ä¸ª StringBuilder çš„å†…å­˜åªä¼šå¢åŠ ä¸ä¼šå‡å°‘ï¼Œç”±æ­¤å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><h2 id="é—®é¢˜è§£å†³" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜è§£å†³" aria-hidden="true">#</a> é—®é¢˜è§£å†³</h2><p>æŸ¥çœ‹å®˜ç½‘å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ª bugï¼Œå…·ä½“åœ°å€å¦‚ä¸‹ï¼šhttps://issues.apache.org/jira/browse/LOG4J2-1858</p><p>ç„¶å log4j å®˜æ–¹åœ¨ 2.9.0 ç‰ˆæœ¬ä¿®å¤äº†è¿™ä¸ª bugï¼Œ release note åœ°å€ï¼šhttps://logging.apache.org/log4j/2.x/release-notes.html</p><img src="'+c+'" alt="image-20240301154038886" style="zoom:100%;"><p>æˆ‘ä»¬å†³å®šå‡çº§åˆ° 2.12.1</p><img src="'+p+'" alt="image-20240301154444481" style="zoom:100%;"><p>å¯ä»¥çœ‹åˆ°æ–°ç‰ˆæœ¬ä¸­å¢åŠ ä¸€ä¸ªæ“ä½œtrimToMaxSizeï¼Œå½“ buffer çš„é•¿åº¦å¤§äºæŸä¸€ç›´æ—¶ä¼šè§¦å‘ StringBuilder çš„ trimToSize æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå›æ”¶ StringBuilder çš„ç¼“å­˜ã€‚</p><h2 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º" aria-hidden="true">#</a> ç»“è®º</h2><p>1ã€æŸäº›ä¸šåŠ¡æ‰“å°äº†å¤§é‡å¤§æ—¥å¿—ï¼Œå¯¼è‡´æ¯ä¸ªçº¿ç¨‹ threadLocal çš„ StringBuilder å ç”¨å†…å­˜å¢å¤§ï¼Œæœ€å¤§è¾¾åˆ° 5mï¼›</p><p>2ã€ç›®å‰ç³»ç»Ÿå¸¸é©»çº¿ç¨‹ç¨³å®šåœ¨ 6000~7000ï¼Œæœ€ç»ˆæ—¥å¿— buffer å°±ä¼šå åˆ° 3~4gï¼›</p><p>3ã€è§„èŒƒæ—¥å¿—è¾“å‡ºï¼Œé¿å…ç£ç›˜ã€å†…å­˜æµªè´¹ï¼›</p><p>4ã€å‡çº§ log4j2 ç‰ˆæœ¬ï¼Œä» 2.6.1 åˆ° 2.12.1ï¼›</p>',36),u=[m];function _(f,b){return a(),r("div",null,u)}const x=e(h,[["render",_],["__file","004-log4j2å†…å­˜æ³„éœ²å¯¼è‡´çš„é¢‘ç¹fullgc.html.vue"]]);export{x as default};
