<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://blog.guosgbin.cn/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html"><meta property="og:title" content="第一章-创建和销毁对象"><meta property="og:description" content="版本 内容 时间 ---- ---- ---------------------- V1 新建 2023年07月13日23:49:21 第一章：创建和销毁对象，主要包含下面 9 条。 1. 用静态工厂方法替代构造器； 2. 遇到多个构造器参数时考虑使用 builder 模式； 3. 用私有构造器或者枚举类型强化 Singleton 属性； 4. 通过私..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-07-14T06:59:35.000Z"><meta property="article:author" content="超威蓝猫 Dylan Kwok"><meta property="article:modified_time" content="2023-07-14T06:59:35.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"第一章-创建和销毁对象","image":[""],"dateModified":"2023-07-14T06:59:35.000Z","author":[{"@type":"Person","name":"超威蓝猫 Dylan Kwok","url":"","email":"guosgbin@163.com"}]}</script><link rel="icon" href="/小熊猫.svg"><title>第一章-创建和销毁对象</title><meta name="description" content="版本 内容 时间 ---- ---- ---------------------- V1 新建 2023年07月13日23:49:21 第一章：创建和销毁对象，主要包含下面 9 条。 1. 用静态工厂方法替代构造器； 2. 遇到多个构造器参数时考虑使用 builder 模式； 3. 用私有构造器或者枚举类型强化 Singleton 属性； 4. 通过私...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-542658da.css" as="style"><link rel="stylesheet" href="/assets/style-542658da.css">
    <link rel="modulepreload" href="/assets/app-ecfdc732.js"><link rel="modulepreload" href="/assets/01-创建和销毁对象.html-b84cc6a4.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/01-创建和销毁对象.html-98280ce1.js"><link rel="prefetch" href="/assets/index.html-d93d8c2f.js" as="script"><link rel="prefetch" href="/assets/index.html-c4f42206.js" as="script"><link rel="prefetch" href="/assets/SPI机制.html-a1ca3921.js" as="script"><link rel="prefetch" href="/assets/01-CAS和Unsafe的API分析.html-612c4d6a.js" as="script"><link rel="prefetch" href="/assets/02-基本类型原子类AtomicLong.html-4083b8fd.js" as="script"><link rel="prefetch" href="/assets/03-引用类型原子类AtomicReference.html-8442553d.js" as="script"><link rel="prefetch" href="/assets/04-原子数组类AtomicLongArray.html-74e4c741.js" as="script"><link rel="prefetch" href="/assets/05-原子操作类AtomicReferenceFieldUpdater.html-d0310b2a.js" as="script"><link rel="prefetch" href="/assets/06-高性能原子类LongAdder.html-d6e3da8b.js" as="script"><link rel="prefetch" href="/assets/07-LockSupport分析.html-8117dd17.js" as="script"><link rel="prefetch" href="/assets/08-AQS简单介绍.html-30b6ef5b.js" as="script"><link rel="prefetch" href="/assets/09-基于ReentrantLock分析AQS的独占模式.html-2423c430.js" as="script"><link rel="prefetch" href="/assets/10-基于CountDownLatch分析AQS的共享模式.html-91ef4833.js" as="script"><link rel="prefetch" href="/assets/11-AQS的Condition机制.html-836364af.js" as="script"><link rel="prefetch" href="/assets/12-信号量Semaphore.html-3509682c.js" as="script"><link rel="prefetch" href="/assets/13-循环栏栅CyclicBarrier.html-812d137d.js" as="script"><link rel="prefetch" href="/assets/14-阶段Phaser.html-d684f4a1.js" as="script"><link rel="prefetch" href="/assets/15-交换Exchanger.html-b9bf24f3.js" as="script"><link rel="prefetch" href="/assets/16-读写锁ReentrantReadWriteLock.html-de44a1d3.js" as="script"><link rel="prefetch" href="/assets/17-Future模式-FutureTask.html-641c6250.js" as="script"><link rel="prefetch" href="/assets/18-线程池体系概述.html-dbcc52e5.js" as="script"><link rel="prefetch" href="/assets/19-线程池体系-AbstractExecutorService.html-fbd70afb.js" as="script"><link rel="prefetch" href="/assets/20-线程池体系-ThreadPoolExecutor.html-a274637a.js" as="script"><link rel="prefetch" href="/assets/21-线程池体系-ScheduledThreadPoolExecutor.html-707ffd40.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayList写时复制.html-914977b9.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySet写时复制.html-6c9c3cf6.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMap跳表.html-6cff54bf.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSet跳表.html-36cf4f7d.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMap源码分析.html-a3bba8a9.js" as="script"><link rel="prefetch" href="/assets/27-阻塞队列ArrayBlockingQueue.html-cd091357.js" as="script"><link rel="prefetch" href="/assets/28-阻塞队列LinkedBlockingQueue.html-d3579ee7.js" as="script"><link rel="prefetch" href="/assets/29-阻塞队列LinkedBlockingDeque.html-32c13680.js" as="script"><link rel="prefetch" href="/assets/30-阻塞队列PriorityBlockingQueue.html-b5455c77.js" as="script"><link rel="prefetch" href="/assets/31-阻塞队列DelayQueue.html-7759c195.js" as="script"><link rel="prefetch" href="/assets/32-阻塞队列SynchronousQueue.html-97ed879a.js" as="script"><link rel="prefetch" href="/assets/33-阻塞队列LinkedTransferQueue.html-3281c1b4.js" as="script"><link rel="prefetch" href="/assets/index.html-f5239cf3.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis01：myabtis的整体架构.html-f25c0705.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis02：入门案例.html-30e68cd3.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis03：解析全局配置文件.html-2db85266.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis04：解析Mapper映射文件.html-60756a5b.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis05：解析Statement操作节点.html-31e11b60.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis06：解析SQL语句.html-a9181b56.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis07：Java方法和SQL语句绑定.html-9bfa3db6.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis08：获得SqlSession.html-e2a92940.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis09：Executor执行器.html-ad701715.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis10：缓存机制.html-f2daa10c.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis11：StatementHandler.html-95b30d9b.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis12：参数解析和赋值.html-5778c0ea.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis13：结果集处理.html-2ff72779.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis14：插件.html-76cc6bf8.js" as="script"><link rel="prefetch" href="/assets/01-服务端启动流程.html-d2fc1f19.js" as="script"><link rel="prefetch" href="/assets/02-服务端启动添加ChannelInitializer到管道.html-86cb5d6a.js" as="script"><link rel="prefetch" href="/assets/03-客户端启动流程.html-becc83be.js" as="script"><link rel="prefetch" href="/assets/04-线程体系-NioEventLoopGroup.html-700e797e.js" as="script"><link rel="prefetch" href="/assets/05-线程体系-NioEventLoop相关父接口分析.html-754320bc.js" as="script"><link rel="prefetch" href="/assets/06-线程体系-AbstractEventExecutor.html-5250cd42.js" as="script"><link rel="prefetch" href="/assets/07-线程体系-AbstractScheduledEventExecutor-优先队列.html-e7bbaf32.js" as="script"><link rel="prefetch" href="/assets/08-线程体系-NioEventLoop概述.html-fce3fb2c.js" as="script"><link rel="prefetch" href="/assets/09-线程体系-NioEventLoop开启Selector及优化.html-6d8230cf.js" as="script"><link rel="prefetch" href="/assets/10-线程体系-NioEventLoop绑定线程.html-db947821.js" as="script"><link rel="prefetch" href="/assets/11-线程体系-NioEventLoop的run方法.html-def4cc31.js" as="script"><link rel="prefetch" href="/assets/12-线程体系-NioEventLoop规避JDK的NIO空循环bug.html-16ecaf4e.js" as="script"><link rel="prefetch" href="/assets/13-线程体系-NioEventLoop的优雅关闭.html-912d668d.js" as="script"><link rel="prefetch" href="/assets/14-服务端处理客户端的连接(ACCEPT).html-63afdec1.js" as="script"><link rel="prefetch" href="/assets/15-客户端处理READ事件概述.html-b35daeb8.js" as="script"><link rel="prefetch" href="/assets/16-客户端处理READ事件详解及RecvByteBufAllocator.html-a9faccfa.js" as="script"><link rel="prefetch" href="/assets/17-Netty管道机制.html-ba70b238.js" as="script"><link rel="prefetch" href="/assets/18-Netty发送数据流程及出站缓冲区.html-223d04a7.js" as="script"><link rel="prefetch" href="/assets/index.html-b475d8b0.js" as="script"><link rel="prefetch" href="/assets/Redis_Benchmark基准测试.html-dbf21951.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群和槽管理命令.html-2b4a1244.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群基本特性和集群搭建.html-42be726b.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群管理工具redis-cli.html-fc4f1503.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipeline优化RTT.html-8a4aa041.js" as="script"><link rel="prefetch" href="/assets/Redis_Sentinel高可用.html-6bcdb34a.js" as="script"><link rel="prefetch" href="/assets/Redis_key设计规范.html-ab90a7dc.js" as="script"><link rel="prefetch" href="/assets/Redis事务.html-e43061e1.js" as="script"><link rel="prefetch" href="/assets/Redis内存淘汰策略.html-feabd314.js" as="script"><link rel="prefetch" href="/assets/Redis发布订阅.html-68771977.js" as="script"><link rel="prefetch" href="/assets/Redis复制.html-33b20d6f.js" as="script"><link rel="prefetch" href="/assets/Redis大key和热key问题.html-394d194e.js" as="script"><link rel="prefetch" href="/assets/Redis慢查询日志.html-7fb06db0.js" as="script"><link rel="prefetch" href="/assets/Redis持久化机制.html-53af3f7a.js" as="script"><link rel="prefetch" href="/assets/Redis键空间通知(keyspace notification).html-012bd277.js" as="script"><link rel="prefetch" href="/assets/redis-cli 使用.html-f7ab22db.js" as="script"><link rel="prefetch" href="/assets/01-RocketMQ概述.html-25463efe.js" as="script"><link rel="prefetch" href="/assets/02-NameServer启动流程.html-a514999f.js" as="script"><link rel="prefetch" href="/assets/03-Broker启动流程.html-43c84806.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQ网络通信原理.html-ac88de8d.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ 服务端和客户端的启动.html-ef7f1888.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQ网络通信源码.html-b8e0bf43.js" as="script"><link rel="prefetch" href="/assets/07-NameServer作用和路由元信息.html-82a23869.js" as="script"><link rel="prefetch" href="/assets/08-NameServer路由管理源码分析.html-8da2bd72.js" as="script"><link rel="prefetch" href="/assets/09-生产者相关类分析.html-08f6e840.js" as="script"><link rel="prefetch" href="/assets/10-生产者启动流程.html-d761cf07.js" as="script"><link rel="prefetch" href="/assets/11-生产者发送消息.html-743328bc.js" as="script"><link rel="prefetch" href="/assets/12-Broker存储机制概述.html-5e7ed491.js" as="script"><link rel="prefetch" href="/assets/13-MappedFile和MappedFileQueue分析.html-5b9afaf2.js" as="script"><link rel="prefetch" href="/assets/14-CommitLog原理分析.html-93362aa2.js" as="script"><link rel="prefetch" href="/assets/15-broker的刷盘机制.html-21e2029f.js" as="script"><link rel="prefetch" href="/assets/16-ConsumeQueue和Index原理分析.html-ff18bade.js" as="script"><link rel="prefetch" href="/assets/17-broker过期文件删除机制.html-89f05919.js" as="script"><link rel="prefetch" href="/assets/18-消费者启动流程(TODO).html-988c43b3.js" as="script"><link rel="prefetch" href="/assets/19-消息拉取入口和消息队列负载均衡.html-7e4e20d4.js" as="script"><link rel="prefetch" href="/assets/20-消费者发送消息拉取请求流程.html-19825069.js" as="script"><link rel="prefetch" href="/assets/21-broker处理消息拉取请求-1-主流程.html-d9ca6fa4.js" as="script"><link rel="prefetch" href="/assets/22-broker处理消息拉取请求-2-长轮询.html-0aba4f38.js" as="script"><link rel="prefetch" href="/assets/23-broker处理消息拉取请求-3-读取消息.html-729d741b.js" as="script"><link rel="prefetch" href="/assets/24-消费者处理从broker拉取的消息.html-dcfb7d07.js" as="script"><link rel="prefetch" href="/assets/25-并发消费原理.html-5ef206ec.js" as="script"><link rel="prefetch" href="/assets/Test.html-8ac87e1e.js" as="script"><link rel="prefetch" href="/assets/JUC相关问题.html-9dc4b717.js" as="script"><link rel="prefetch" href="/assets/JVM问题.html-17300c49.js" as="script"><link rel="prefetch" href="/assets/MySQL相关问题.html-a6c2cd41.js" as="script"><link rel="prefetch" href="/assets/index.html-8f5e683a.js" as="script"><link rel="prefetch" href="/assets/Redis相关问题.html-575f1ee1.js" as="script"><link rel="prefetch" href="/assets/HowToSayResume.html-11d8bbca.js" as="script"><link rel="prefetch" href="/assets/resume.html-3b3f8934.js" as="script"><link rel="prefetch" href="/assets/404.html-f3795607.js" as="script"><link rel="prefetch" href="/assets/index.html-1f3390c0.js" as="script"><link rel="prefetch" href="/assets/index.html-10b45510.js" as="script"><link rel="prefetch" href="/assets/index.html-dfd17ea5.js" as="script"><link rel="prefetch" href="/assets/index.html-2f392b9e.js" as="script"><link rel="prefetch" href="/assets/index.html-4060f68d.js" as="script"><link rel="prefetch" href="/assets/index.html-0efbdc5e.js" as="script"><link rel="prefetch" href="/assets/index.html-9784a76b.js" as="script"><link rel="prefetch" href="/assets/index.html-d1b39c8b.js" as="script"><link rel="prefetch" href="/assets/SPI机制.html-4b9dc94b.js" as="script"><link rel="prefetch" href="/assets/01-CAS和Unsafe的API分析.html-908b75e4.js" as="script"><link rel="prefetch" href="/assets/02-基本类型原子类AtomicLong.html-69cdfa47.js" as="script"><link rel="prefetch" href="/assets/03-引用类型原子类AtomicReference.html-06de544a.js" as="script"><link rel="prefetch" href="/assets/04-原子数组类AtomicLongArray.html-d919420a.js" as="script"><link rel="prefetch" href="/assets/05-原子操作类AtomicReferenceFieldUpdater.html-30468688.js" as="script"><link rel="prefetch" href="/assets/06-高性能原子类LongAdder.html-35899fc6.js" as="script"><link rel="prefetch" href="/assets/07-LockSupport分析.html-341251b9.js" as="script"><link rel="prefetch" href="/assets/08-AQS简单介绍.html-a91aea5d.js" as="script"><link rel="prefetch" href="/assets/09-基于ReentrantLock分析AQS的独占模式.html-df7cc8d0.js" as="script"><link rel="prefetch" href="/assets/10-基于CountDownLatch分析AQS的共享模式.html-aaa5b92f.js" as="script"><link rel="prefetch" href="/assets/11-AQS的Condition机制.html-d981cb75.js" as="script"><link rel="prefetch" href="/assets/12-信号量Semaphore.html-d5ee2b12.js" as="script"><link rel="prefetch" href="/assets/13-循环栏栅CyclicBarrier.html-8c24a69e.js" as="script"><link rel="prefetch" href="/assets/14-阶段Phaser.html-6932e273.js" as="script"><link rel="prefetch" href="/assets/15-交换Exchanger.html-8f9972a5.js" as="script"><link rel="prefetch" href="/assets/16-读写锁ReentrantReadWriteLock.html-c73d70ac.js" as="script"><link rel="prefetch" href="/assets/17-Future模式-FutureTask.html-857ed2cf.js" as="script"><link rel="prefetch" href="/assets/18-线程池体系概述.html-870e03ae.js" as="script"><link rel="prefetch" href="/assets/19-线程池体系-AbstractExecutorService.html-5bc7bff3.js" as="script"><link rel="prefetch" href="/assets/20-线程池体系-ThreadPoolExecutor.html-baed85aa.js" as="script"><link rel="prefetch" href="/assets/21-线程池体系-ScheduledThreadPoolExecutor.html-ceaefbe9.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayList写时复制.html-b0a181f3.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySet写时复制.html-ee7ac583.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMap跳表.html-055cfd2a.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSet跳表.html-5e9a36a7.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMap源码分析.html-cd802369.js" as="script"><link rel="prefetch" href="/assets/27-阻塞队列ArrayBlockingQueue.html-258ed076.js" as="script"><link rel="prefetch" href="/assets/28-阻塞队列LinkedBlockingQueue.html-c201fb0b.js" as="script"><link rel="prefetch" href="/assets/29-阻塞队列LinkedBlockingDeque.html-ea81fa87.js" as="script"><link rel="prefetch" href="/assets/30-阻塞队列PriorityBlockingQueue.html-0e8b2424.js" as="script"><link rel="prefetch" href="/assets/31-阻塞队列DelayQueue.html-16ddd445.js" as="script"><link rel="prefetch" href="/assets/32-阻塞队列SynchronousQueue.html-633a1293.js" as="script"><link rel="prefetch" href="/assets/33-阻塞队列LinkedTransferQueue.html-a56a0969.js" as="script"><link rel="prefetch" href="/assets/index.html-1c7602c0.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis01：myabtis的整体架构.html-51f539b0.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis02：入门案例.html-947b1f8f.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis03：解析全局配置文件.html-f845751b.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis04：解析Mapper映射文件.html-9afa6faa.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis05：解析Statement操作节点.html-a9b4c7a5.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis06：解析SQL语句.html-33b35ec7.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis07：Java方法和SQL语句绑定.html-c6d20029.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis08：获得SqlSession.html-ccbc6a00.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis09：Executor执行器.html-4b5a76d0.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis10：缓存机制.html-8e767408.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis11：StatementHandler.html-b743a66f.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis12：参数解析和赋值.html-a08cdeb9.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis13：结果集处理.html-2cf6010a.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis14：插件.html-ef59dc9d.js" as="script"><link rel="prefetch" href="/assets/01-服务端启动流程.html-6ee7b9a2.js" as="script"><link rel="prefetch" href="/assets/02-服务端启动添加ChannelInitializer到管道.html-0a549e89.js" as="script"><link rel="prefetch" href="/assets/03-客户端启动流程.html-03ea2d09.js" as="script"><link rel="prefetch" href="/assets/04-线程体系-NioEventLoopGroup.html-5880d5dd.js" as="script"><link rel="prefetch" href="/assets/05-线程体系-NioEventLoop相关父接口分析.html-985d3848.js" as="script"><link rel="prefetch" href="/assets/06-线程体系-AbstractEventExecutor.html-7c4c8730.js" as="script"><link rel="prefetch" href="/assets/07-线程体系-AbstractScheduledEventExecutor-优先队列.html-46b9f2e7.js" as="script"><link rel="prefetch" href="/assets/08-线程体系-NioEventLoop概述.html-6afc9474.js" as="script"><link rel="prefetch" href="/assets/09-线程体系-NioEventLoop开启Selector及优化.html-10923ea1.js" as="script"><link rel="prefetch" href="/assets/10-线程体系-NioEventLoop绑定线程.html-de1677bf.js" as="script"><link rel="prefetch" href="/assets/11-线程体系-NioEventLoop的run方法.html-fb1d6035.js" as="script"><link rel="prefetch" href="/assets/12-线程体系-NioEventLoop规避JDK的NIO空循环bug.html-01f114fd.js" as="script"><link rel="prefetch" href="/assets/13-线程体系-NioEventLoop的优雅关闭.html-ae11fb2e.js" as="script"><link rel="prefetch" href="/assets/14-服务端处理客户端的连接(ACCEPT).html-c6ca116d.js" as="script"><link rel="prefetch" href="/assets/15-客户端处理READ事件概述.html-4a9fc02c.js" as="script"><link rel="prefetch" href="/assets/16-客户端处理READ事件详解及RecvByteBufAllocator.html-d901fd26.js" as="script"><link rel="prefetch" href="/assets/17-Netty管道机制.html-6809a475.js" as="script"><link rel="prefetch" href="/assets/18-Netty发送数据流程及出站缓冲区.html-0f2349b8.js" as="script"><link rel="prefetch" href="/assets/index.html-75a82bf4.js" as="script"><link rel="prefetch" href="/assets/Redis_Benchmark基准测试.html-6bf7a606.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群和槽管理命令.html-8f38e285.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群基本特性和集群搭建.html-a1fa51e7.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群管理工具redis-cli.html-9aadc41f.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipeline优化RTT.html-a3b81191.js" as="script"><link rel="prefetch" href="/assets/Redis_Sentinel高可用.html-11b436fd.js" as="script"><link rel="prefetch" href="/assets/Redis_key设计规范.html-ab5d4cf1.js" as="script"><link rel="prefetch" href="/assets/Redis事务.html-f1de2ae5.js" as="script"><link rel="prefetch" href="/assets/Redis内存淘汰策略.html-1009bb67.js" as="script"><link rel="prefetch" href="/assets/Redis发布订阅.html-48cd5f93.js" as="script"><link rel="prefetch" href="/assets/Redis复制.html-4e1dc834.js" as="script"><link rel="prefetch" href="/assets/Redis大key和热key问题.html-f11ae339.js" as="script"><link rel="prefetch" href="/assets/Redis慢查询日志.html-4cb400c3.js" as="script"><link rel="prefetch" href="/assets/Redis持久化机制.html-d08f249e.js" as="script"><link rel="prefetch" href="/assets/Redis键空间通知(keyspace notification).html-1f78b78f.js" as="script"><link rel="prefetch" href="/assets/redis-cli 使用.html-b02457bc.js" as="script"><link rel="prefetch" href="/assets/01-RocketMQ概述.html-8e4ffa50.js" as="script"><link rel="prefetch" href="/assets/02-NameServer启动流程.html-dad1c474.js" as="script"><link rel="prefetch" href="/assets/03-Broker启动流程.html-f4b7c80d.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQ网络通信原理.html-bcf737f2.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ 服务端和客户端的启动.html-862fa716.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQ网络通信源码.html-09c101c8.js" as="script"><link rel="prefetch" href="/assets/07-NameServer作用和路由元信息.html-6ab8c72a.js" as="script"><link rel="prefetch" href="/assets/08-NameServer路由管理源码分析.html-961626f6.js" as="script"><link rel="prefetch" href="/assets/09-生产者相关类分析.html-c7093050.js" as="script"><link rel="prefetch" href="/assets/10-生产者启动流程.html-15038ac7.js" as="script"><link rel="prefetch" href="/assets/11-生产者发送消息.html-98164fb2.js" as="script"><link rel="prefetch" href="/assets/12-Broker存储机制概述.html-75e0b6f8.js" as="script"><link rel="prefetch" href="/assets/13-MappedFile和MappedFileQueue分析.html-1c0831f4.js" as="script"><link rel="prefetch" href="/assets/14-CommitLog原理分析.html-e3946cad.js" as="script"><link rel="prefetch" href="/assets/15-broker的刷盘机制.html-5fbcc24e.js" as="script"><link rel="prefetch" href="/assets/16-ConsumeQueue和Index原理分析.html-fd7bbb03.js" as="script"><link rel="prefetch" href="/assets/17-broker过期文件删除机制.html-abaad10c.js" as="script"><link rel="prefetch" href="/assets/18-消费者启动流程(TODO).html-b4721ecb.js" as="script"><link rel="prefetch" href="/assets/19-消息拉取入口和消息队列负载均衡.html-7d5e34b1.js" as="script"><link rel="prefetch" href="/assets/20-消费者发送消息拉取请求流程.html-928e828c.js" as="script"><link rel="prefetch" href="/assets/21-broker处理消息拉取请求-1-主流程.html-9c500247.js" as="script"><link rel="prefetch" href="/assets/22-broker处理消息拉取请求-2-长轮询.html-a69b102b.js" as="script"><link rel="prefetch" href="/assets/23-broker处理消息拉取请求-3-读取消息.html-330c1784.js" as="script"><link rel="prefetch" href="/assets/24-消费者处理从broker拉取的消息.html-ed5fb28a.js" as="script"><link rel="prefetch" href="/assets/25-并发消费原理.html-7a296875.js" as="script"><link rel="prefetch" href="/assets/Test.html-806da57f.js" as="script"><link rel="prefetch" href="/assets/JUC相关问题.html-7e14b457.js" as="script"><link rel="prefetch" href="/assets/JVM问题.html-171f0cc4.js" as="script"><link rel="prefetch" href="/assets/MySQL相关问题.html-ddf23070.js" as="script"><link rel="prefetch" href="/assets/index.html-e0070464.js" as="script"><link rel="prefetch" href="/assets/Redis相关问题.html-6f6e0d2f.js" as="script"><link rel="prefetch" href="/assets/HowToSayResume.html-998ba8a9.js" as="script"><link rel="prefetch" href="/assets/resume.html-d0b30503.js" as="script"><link rel="prefetch" href="/assets/404.html-0e7f810a.js" as="script"><link rel="prefetch" href="/assets/index.html-999ddfc0.js" as="script"><link rel="prefetch" href="/assets/index.html-423a081f.js" as="script"><link rel="prefetch" href="/assets/index.html-b7837fd9.js" as="script"><link rel="prefetch" href="/assets/index.html-4f4f1e47.js" as="script"><link rel="prefetch" href="/assets/index.html-35d818e0.js" as="script"><link rel="prefetch" href="/assets/index.html-2f6dab8b.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-2450701e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="vp-brand"><img class="vp-nav-logo" src="/小熊猫.png" alt><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a href="/EffectiveJava_note/" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="《Effective Java》第三版阅读笔记"><!---->《Effective Java》第三版阅读笔记<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html" class="router-link-active router-link-exact-active nav-link active vp-sidebar-link vp-sidebar-page active" aria-label="第一章-创建和销毁对象"><!---->第一章-创建和销毁对象<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#用静态工厂方法替代构造器" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="用静态工厂方法替代构造器"><!---->用静态工厂方法替代构造器<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#静态工厂方法的优点" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="静态工厂方法的优点"><!---->静态工厂方法的优点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#静态工厂方法的缺点以及弥补方式" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="静态工厂方法的缺点以及弥补方式"><!---->静态工厂方法的缺点以及弥补方式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#遇到多个构造器参数时考虑使用-builder-模式" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="遇到多个构造器参数时考虑使用 builder 模式"><!---->遇到多个构造器参数时考虑使用 builder 模式<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#静态工厂和构造器的缺点" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="静态工厂和构造器的缺点"><!---->静态工厂和构造器的缺点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#建造者-builder-模式" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="建造者 builder 模式"><!---->建造者 builder 模式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#类层次的建造者模式" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="类层次的建造者模式"><!---->类层次的建造者模式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#builder-模式应用场景" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="builder 模式应用场景"><!---->builder 模式应用场景<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#builder-模式的优缺点" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="builder 模式的优缺点"><!---->builder 模式的优缺点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#用私有构造器或者枚举类型强化-singleton-属性" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="用私有构造器或者枚举类型强化 Singleton 属性"><!---->用私有构造器或者枚举类型强化 Singleton 属性<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#实现单例的两种写法" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="实现单例的两种写法"><!---->实现单例的两种写法<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#防止反序列化破坏单例" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="防止反序列化破坏单例"><!---->防止反序列化破坏单例<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#使用枚举实现单例模式" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="使用枚举实现单例模式"><!---->使用枚举实现单例模式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#通过私有构造器强化不可实例化的能力" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="通过私有构造器强化不可实例化的能力"><!---->通过私有构造器强化不可实例化的能力<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#优先考虑依赖注入来引用资源" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="优先考虑依赖注入来引用资源"><!---->优先考虑依赖注入来引用资源<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#避免创建不必要的对象" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="避免创建不必要的对象"><!---->避免创建不必要的对象<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#消除过期的对象引用" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="消除过期的对象引用"><!---->消除过期的对象引用<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#隐蔽的内存泄漏问题及解决方案" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="隐蔽的内存泄漏问题及解决方案"><!---->隐蔽的内存泄漏问题及解决方案<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#注意点" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="注意点"><!---->注意点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#简易栈的问题以及解决方案" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="简易栈的问题以及解决方案"><!---->简易栈的问题以及解决方案<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#rocketmq-中的案例" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="RocketMQ 中的案例"><!---->RocketMQ 中的案例<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#避免使用终结方法和清除方法" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="避免使用终结方法和清除方法"><!---->避免使用终结方法和清除方法<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#try-with-resources-优先于-try-finally" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="try-with-resources 优先于 try-finally"><!---->try-with-resources 优先于 try-finally<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->第一章-创建和销毁对象</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">超威蓝猫 Dylan Kwok</span></span><span property="author" content="超威蓝猫 Dylan Kwok"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-07-14T06:59:35.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#用静态工厂方法替代构造器" class="router-link-active router-link-exact-active toc-link level2">用静态工厂方法替代构造器</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#静态工厂方法的优点" class="router-link-active router-link-exact-active toc-link level3">静态工厂方法的优点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#静态工厂方法的缺点以及弥补方式" class="router-link-active router-link-exact-active toc-link level3">静态工厂方法的缺点以及弥补方式</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#遇到多个构造器参数时考虑使用-builder-模式" class="router-link-active router-link-exact-active toc-link level2">遇到多个构造器参数时考虑使用 builder 模式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#静态工厂和构造器的缺点" class="router-link-active router-link-exact-active toc-link level3">静态工厂和构造器的缺点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#建造者-builder-模式" class="router-link-active router-link-exact-active toc-link level3">建造者 builder 模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#类层次的建造者模式" class="router-link-active router-link-exact-active toc-link level3">类层次的建造者模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#builder-模式应用场景" class="router-link-active router-link-exact-active toc-link level3">builder 模式应用场景</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#builder-模式的优缺点" class="router-link-active router-link-exact-active toc-link level3">builder 模式的优缺点</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#用私有构造器或者枚举类型强化-singleton-属性" class="router-link-active router-link-exact-active toc-link level2">用私有构造器或者枚举类型强化 Singleton 属性</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#实现单例的两种写法" class="router-link-active router-link-exact-active toc-link level3">实现单例的两种写法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#防止反序列化破坏单例" class="router-link-active router-link-exact-active toc-link level3">防止反序列化破坏单例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#使用枚举实现单例模式" class="router-link-active router-link-exact-active toc-link level3">使用枚举实现单例模式</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#通过私有构造器强化不可实例化的能力" class="router-link-active router-link-exact-active toc-link level2">通过私有构造器强化不可实例化的能力</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#优先考虑依赖注入来引用资源" class="router-link-active router-link-exact-active toc-link level2">优先考虑依赖注入来引用资源</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#避免创建不必要的对象" class="router-link-active router-link-exact-active toc-link level2">避免创建不必要的对象</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#消除过期的对象引用" class="router-link-active router-link-exact-active toc-link level2">消除过期的对象引用</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#隐蔽的内存泄漏问题及解决方案" class="router-link-active router-link-exact-active toc-link level3">隐蔽的内存泄漏问题及解决方案</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#注意点" class="router-link-active router-link-exact-active toc-link level3">注意点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#简易栈的问题以及解决方案" class="router-link-active router-link-exact-active toc-link level3">简易栈的问题以及解决方案</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#rocketmq-中的案例" class="router-link-active router-link-exact-active toc-link level3">RocketMQ 中的案例</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#避免使用终结方法和清除方法" class="router-link-active router-link-exact-active toc-link level2">避免使用终结方法和清除方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/EffectiveJava_note/01-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1.html#try-with-resources-优先于-try-finally" class="router-link-active router-link-exact-active toc-link level2">try-with-resources 优先于 try-finally</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><table><thead><tr><th>版本</th><th>内容</th><th>时间</th></tr></thead><tbody><tr><td>V1</td><td>新建</td><td>2023年07月13日23:49:21</td></tr></tbody></table><p>第一章：创建和销毁对象，主要包含下面 9 条。</p><ol><li>用静态工厂方法替代构造器；</li><li>遇到多个构造器参数时考虑使用 builder 模式；</li><li>用私有构造器或者枚举类型强化 Singleton 属性；</li><li>通过私有构造器强化不可实例化的能力；</li><li>优先考虑依赖注入来引用资源；</li><li>避免创建不必要的对象；</li><li>消除过期的对象引用；</li><li>避免使用终结方法和清除方法；</li><li>try-with-resources 优先于 try-finally；</li></ol><h2 id="用静态工厂方法替代构造器" tabindex="-1"><a class="header-anchor" href="#用静态工厂方法替代构造器" aria-hidden="true">#</a> 用静态工厂方法替代构造器</h2><p>一个类除了可以提供构造器之外，还可以提供一些见名知意的静态工厂方法去返回该类的实例。</p><h3 id="静态工厂方法的优点" tabindex="-1"><a class="header-anchor" href="#静态工厂方法的优点" aria-hidden="true">#</a> 静态工厂方法的优点</h3><ol><li><strong><!----></strong>，而构造器的方法名只能有一种。虽然构造器可以重载，但是如果重载的构造器过多的话，会对增加使用的难度，调用者还要斟酌用哪个构造器；</li><li><strong><!----></strong>（eg.单例模式和享元模式）；</li><li>**<!---->，**这样可以屏蔽一些不是 public 的子类的实现，减少调用者的使用难度。例如在 JDK 的集合框架中有这样一个类 java.util.Collections，这个类中提供了不可修改的集合、 同步集合的实现，这样可以通过调用 API 直接返回带有指定特性（不可修改、同步等）的集合，这样我们的 API 调用者就不用去关系其内部的子类是如何实现这些特性的；</li><li><strong><!----></strong>；</li><li><strong><!----></strong>；这个有点典型的案例有 SPI 机制（Service Provider Interface），SPI 是一种用于实现松耦合、可扩展插件系统的机制，它允许应用程序在运行时发现和加载某个特定服务接口的提供者。JDK 自带的 ServiceLoader 类实现了 SPI 机制，还有其他开源框架中有大量的 SPI 的案例（JDBC、日志门面、motan rpc、dubbo、spring 等）；</li></ol><h3 id="静态工厂方法的缺点以及弥补方式" tabindex="-1"><a class="header-anchor" href="#静态工厂方法的缺点以及弥补方式" aria-hidden="true">#</a> 静态工厂方法的缺点以及弥补方式</h3><ol><li><strong><!----></strong>，也就是说不能继承这个类。不过这样也有个好处就是我们可以多多使用组合，而不是继承；</li><li><strong><!----></strong>。 Java 自带的 API 文档会把构造器明确的标注出来，但是我们写的静态工厂方法并不容易被发现；</li></ol><p>我们可以通过一些合适的命名来弥补静态工厂方法不容易被发现的劣势：</p><ul><li><p><strong><!----></strong>：类型转换的方法，只有单个参数，返回该类型的一个实例。例如 java.util.Date#from 方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Instant</span> instant<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>instant<span class="token punctuation">.</span><span class="token function">toEpochMilli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>：聚合方法，带有多个参数，返回该类型的一个实例，把它们合并起来。例如 java.util.List#of(E, E, E) 系列方法返回一个不可变的 List 实例（JDK 9 之后）。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">E</span> e1<span class="token punctuation">,</span> <span class="token class-name">E</span> e2<span class="token punctuation">,</span> <span class="token class-name">E</span> e3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ImmutableCollections</span><span class="token punctuation">.</span><span class="token function">listFromTrustedArray</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> e3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>：例如 java.lang.Integer#valueOf(java.lang.String) 方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NumberFormatException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>：获取一个实例，静态工厂方法可以有参数，也可以没有参数，没有参数的可以视为默认的实现。例如：java.util.Calendar#getInstance()</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Calendar</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Locale</span> aLocale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token class-name">Locale<span class="token punctuation">.</span>Category</span><span class="token punctuation">.</span><span class="token constant">FORMAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">createCalendar</span><span class="token punctuation">(</span><span class="token function">defaultTimeZone</span><span class="token punctuation">(</span>aLocale<span class="token punctuation">)</span><span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>：获取一个实例，这个命名强调的是每次都返回一个新的实例。例如：java.lang.reflect.Array#newInstance(java.lang.Class&lt;?&gt;, int)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> componentType<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">NegativeArraySizeException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">newArray</span><span class="token punctuation">(</span>componentType<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>：这里的 type 表示静态工厂方法需要返回的对象的类型的名字，主要是工厂方法处于不同的类中的时候使用。例如：java.lang.Class#getConstructor</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameterTypes<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">SecurityException</span> <span class="token punctuation">{</span>
    <span class="token function">checkMemberAccess</span><span class="token punctuation">(</span><span class="token class-name">Member</span><span class="token punctuation">.</span><span class="token constant">PUBLIC</span><span class="token punctuation">,</span> <span class="token class-name">Reflection</span><span class="token punctuation">.</span><span class="token function">getCallerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getConstructor0</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">,</span> <span class="token class-name">Member</span><span class="token punctuation">.</span><span class="token constant">PUBLIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>：这里的 type 表示静态工厂方法需要返回的对象的类型的名字，主要是工厂方法处于不同的类中的时候使用。例如：java.lang.Class#newInstance</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ...... 省略具体实现 ......</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="遇到多个构造器参数时考虑使用-builder-模式" tabindex="-1"><a class="header-anchor" href="#遇到多个构造器参数时考虑使用-builder-模式" aria-hidden="true">#</a> 遇到多个构造器参数时考虑使用 builder 模式</h2><h3 id="静态工厂和构造器的缺点" tabindex="-1"><a class="header-anchor" href="#静态工厂和构造器的缺点" aria-hidden="true">#</a> 静态工厂和构造器的缺点</h3><p>静态工厂和构造器有一个共同的缺点，它们在多个参数的情况下的扩展性并不好，例如有些参数可能是必填的，有些参数可能是可选的。先说两种并不是最优的处理：① 使用构造函数重载的方式去处理多个参数；② 创建好 JavaBean 后，调用对应的 set 方法；</p><ol><li>使用<strong>构造函数重载</strong>的方案的缺点是<strong>客户端调用起来不方便，而且比较难阅读</strong>；</li><li><strong>创建 JavaBean 后调用 set 方法去设置参数</strong>，缺点是在创建对象然后设置参数是多个步骤，也就是说在<strong>实例构造的过程中 JavaBean 可能处于不一致的状态</strong>，导致不可预知的错误；</li></ol><h3 id="建造者-builder-模式" tabindex="-1"><a class="header-anchor" href="#建造者-builder-模式" aria-hidden="true">#</a> 建造者 builder 模式</h3><p>上面两种解决方案并不是最优的，Effective Java 作者推荐使用 builder 模式，也就是建造者模式来处理多个参数的情况。看一个案例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>   <span class="token comment">// 必填</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> hobby<span class="token punctuation">;</span>  <span class="token comment">// 可选</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> career<span class="token punctuation">;</span> <span class="token comment">// 可选</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PersonBuilder</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> hobby<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> career<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">PersonBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PersonBuilder</span> <span class="token function">personBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PersonBuilder</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">PersonBuilder</span> <span class="token function">withHobby</span><span class="token punctuation">(</span><span class="token class-name">String</span> hobby<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>hobby <span class="token operator">=</span> hobby<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">PersonBuilder</span> <span class="token function">withCareer</span><span class="token punctuation">(</span><span class="token class-name">String</span> career<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>career <span class="token operator">=</span> career<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            person<span class="token punctuation">.</span>career <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>career<span class="token punctuation">;</span>
            person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            person<span class="token punctuation">.</span>hobby <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hobby<span class="token punctuation">;</span>
            <span class="token keyword">return</span> person<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 name 是必填的属性，所以在创建 PersonBuilder 的时候必填，其余的属性在各自的 with 开头的方法里面去构建。调用方的构建代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token class-name">PersonBuilder</span><span class="token punctuation">.</span><span class="token function">personBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;千珏&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withCareer</span><span class="token punctuation">(</span><span class="token string">&quot;ADC&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withHobby</span><span class="token punctuation">(</span><span class="token string">&quot;印记&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="类层次的建造者模式" tabindex="-1"><a class="header-anchor" href="#类层次的建造者模式" aria-hidden="true">#</a> 类层次的建造者模式</h3><p><strong>抽象类有抽象的 builder，具体类有具体的 builder。</strong></p><p>先看一个抽象的 Phone 类，Phone 类内部有一个抽象的 Builder，需要子类实现的方法有两个：</p><ol><li>一个是 build 方法，构建一个 Phone 对象出来；</li><li>一个是 self 方法，该方法需要子类实现返回 “this”，用来组成链式调用；</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span> <span class="token comment">// 品牌</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> size<span class="token punctuation">;</span>  <span class="token comment">// 尺寸</span>

    <span class="token keyword">public</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> builder<span class="token punctuation">.</span>brand<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> builder<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">abstract</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Builder</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span> <span class="token comment">// 品牌</span>
        <span class="token keyword">private</span> <span class="token class-name">Double</span> size<span class="token punctuation">;</span>  <span class="token comment">// 尺寸</span>

        <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">withBrand</span><span class="token punctuation">(</span><span class="token class-name">String</span> brand<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> brand<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">withSize</span><span class="token punctuation">(</span><span class="token class-name">Double</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/* 构建一个实例 */</span>
        <span class="token keyword">abstract</span> <span class="token class-name">Phone</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* 子类必须重载这个方法，返回 &#39;this&#39; */</span>
        <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">T</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看一个子类 SmartPhone 的实现</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">SmartPhone</span> <span class="token keyword">extends</span> <span class="token class-name">Phone</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> games3D<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SmartPhone</span><span class="token punctuation">(</span><span class="token class-name">SmartPhoneBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>games3D <span class="token operator">=</span> builder<span class="token punctuation">.</span>games3D<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SmartPhoneBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">Phone<span class="token punctuation">.</span>Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SmartPhoneBuilder</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> games3D<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">SmartPhoneBuilder</span> <span class="token function">withGames3D</span><span class="token punctuation">(</span><span class="token class-name">String</span> games3D<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>games3D <span class="token operator">=</span> games3D<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Phone</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SmartPhone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token class-name">SmartPhoneBuilder</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmartPhone<span class="token punctuation">.</span>SmartPhoneBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withBrand</span><span class="token punctuation">(</span><span class="token string">&quot;小米&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSize</span><span class="token punctuation">(</span><span class="token number">7.2</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withGames3D</span><span class="token punctuation">(</span><span class="token string">&quot;小米枪战&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>子类的构建器中的 build 方法，都声明返回正确的子类。例如在子类 SmartPhone 中的 build 方法就是返回的 SmartPhone 对象实例。</p><h3 id="builder-模式应用场景" tabindex="-1"><a class="header-anchor" href="#builder-模式应用场景" aria-hidden="true">#</a> builder 模式应用场景</h3><p><strong>如果类的构造器或者静态工厂方法中有多个参数，设计这种类的时候，可以考虑 Builder 模式。</strong></p><h3 id="builder-模式的优缺点" tabindex="-1"><a class="header-anchor" href="#builder-模式的优缺点" aria-hidden="true">#</a> builder 模式的优缺点</h3><p>优点：<strong><!----></strong>；</p><p>缺点：</p><ol><li><strong><!----></strong>。虽然创建这个构建器的开销并不是很大，如果是某些十分注重性能的情况下，可能就有问题了；</li><li>builder 模式比构造函数重载还要冗长，所以它只有在多个参数的时候才使用，比如 4 个或者更多个参数；</li></ol><blockquote><p>如果某个类的参数比较多，建议一开始就使用 builder 模式。如果一开始使用的是构造函数或者静态工厂方法，后面参数变多后又改为 builder 模式的话，这时候之前那些过时的构造函数和静态工厂方法就会显得不协调了。</p></blockquote><h2 id="用私有构造器或者枚举类型强化-singleton-属性" tabindex="-1"><a class="header-anchor" href="#用私有构造器或者枚举类型强化-singleton-属性" aria-hidden="true">#</a> 用私有构造器或者枚举类型强化 Singleton 属性</h2><blockquote><p>其实就是单例模式的一些写法，但是本次并不是分析单例模式有多少次写法，这里主要阐述的是作者在文中的观点</p></blockquote><h3 id="实现单例的两种写法" tabindex="-1"><a class="header-anchor" href="#实现单例的两种写法" aria-hidden="true">#</a> 实现单例的两种写法</h3><p>第一种就是直接使用一个 public 的静态的 final 域，私有化构造函数。为了防止反射创建实例，在构造函数中做了判空处理。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Person</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">INSTANCE</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;请不要重复构造!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;你好...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种和上面差不多，只不过是使用的静态工厂方法返回单例对象。也是需要私有化构造函数，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Person</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">INSTANCE</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;请不要重复构造!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Person</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;你好...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="防止反序列化破坏单例" tabindex="-1"><a class="header-anchor" href="#防止反序列化破坏单例" aria-hidden="true">#</a> 防止反序列化破坏单例</h3><p>为了防止反序列化创建一个新的实例，可以在类中增加一个 readResolve() 方法，并返回单例对象。这样就可以防止反序列化破坏单例。具体的原理是反序列化的时候会判断当前类中是否有 readResolve() 方法，如果有的话就会直接拿 readResolve() 方法的返回值作为反序列化后得到的实例。</p><p>具体的源码可以去看 java.io.ObjectInputStream#readOrdinaryObject 的实现。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Person</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;古拉加斯大肚子&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">INSTANCE</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;请不要重复构造!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Person</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调用了 readResolve() 方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; 说你好...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用枚举实现单例模式" tabindex="-1"><a class="header-anchor" href="#使用枚举实现单例模式" aria-hidden="true">#</a> 使用枚举实现单例模式</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token constant">JIU_TONG</span><span class="token punctuation">;</span> <span class="token comment">// 酒桶</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;你好...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token constant">JIU_TONG</span><span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用枚举实现单例是一个最简单的方式，Java 对枚举的处理已经保证单个枚举值是单例的了，而且无法通过反射和序列化去破坏单例。可以去反编译查看枚举的源码，就可以得到答案。</p><h2 id="通过私有构造器强化不可实例化的能力" tabindex="-1"><a class="header-anchor" href="#通过私有构造器强化不可实例化的能力" aria-hidden="true">#</a> 通过私有构造器强化不可实例化的能力</h2><p><strong>有些工具类提供了一些静态方法，其实我们并不需要实例化工具类，因为实例化它们是没有意义的，我们可以在工具类中提供一个私有的构造函数来防止它被实例化。</strong></p><p>例如 JDK 的 java.lang.Math 类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Math</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Don&#39;t let anyone instantiate this class.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token comment">// ...... 省略其他 ......</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>又比如 JDK 的 java.util.Arrays</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Arrays</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...... 省略其他 ......</span>

    <span class="token comment">// Suppresses default constructor, ensuring non-instantiability.</span>
    <span class="token keyword">private</span> <span class="token class-name">Arrays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 
    <span class="token comment">// ...... 省略其他 ......</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>私有构造函数带来的问题就是无法子类化该类，因为子类无法调用父类的 private 的构造函数。</p><h2 id="优先考虑依赖注入来引用资源" tabindex="-1"><a class="header-anchor" href="#优先考虑依赖注入来引用资源" aria-hidden="true">#</a> 优先考虑依赖注入来引用资源</h2><p>这个意思其实就是说，假如某个类依赖了另外一个类的功能，优先考虑依赖注入的方式。看个案例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClusterApi</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">HaService</span> haService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">LoadBalance</span> loadBalance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ClusterApi</span><span class="token punctuation">(</span><span class="token class-name">HaService</span> haService<span class="token punctuation">,</span> <span class="token class-name">LoadBalance</span> loadBalance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>haService <span class="token operator">=</span> haService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loadBalance <span class="token operator">=</span> loadBalance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">HaService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">LoadBalance</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>假如 ClusterApi 是集群相关的 API 类，内部需要使用 HA 高可用和负载均衡的服务的功能，那么可以通过依赖注入的方式注入到 ClusterApi 中。</p><blockquote><p>这样看起来好像我们平时开发一直在用依赖注入啊，其实这些都是 Spring 帮我们做好了，我们自然而然的就用了。</p></blockquote><h2 id="避免创建不必要的对象" tabindex="-1"><a class="header-anchor" href="#避免创建不必要的对象" aria-hidden="true">#</a> 避免创建不必要的对象</h2><p>一般来说，最好重用单个对象，而不是每次需要的时候就创建一个相同功能的新对象。如果对象是不可变（immutable）的对象，它就始终可以被重用。</p><p>看几个案例：</p><ul><li><p>关于 String 对象的创建，如果使用 <code>String s = new String(&quot;nihao&quot;)</code> 创建字符串，入参 <code>nihao</code> 其实就是一个 String 实例，这样就会多创建 String 实例。建议直接使用 <code>String s = &quot;nihao&quot;</code>，因为在 JVM 中有个字符串常量池，会重用字符串；</p></li><li><p><strong><!----></strong>。例如在 java.lang.Integer#valueOf 系列方法中实现了缓存机制，如果没有命中缓存才会去创建 Integer 实例，可以避免创建多个实例；</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 假如 i 的大小命中了缓存，直接返回缓存中的对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 未命中缓存则新建一个 Integer 对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>。需要注意的是对于那些创建和回收代价很小的小对象，就不适合使用对象池来重用这些对象了；</p></li><li><p><strong><!----></strong>。举个例子吧，比如 HashMap 的 java.util.HashMap#keySet 方法，每次返回 Map 对象的 Set 视图。这里很明显看到每次返回都是返回相同的 keySet 实例。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> <span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> ks <span class="token operator">=</span> keySet<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ks <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keySet <span class="token operator">=</span> ks<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ks<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><!----></strong>。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Long</span> boxSum <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> boxStart <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    boxSum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;box waste time, &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> boxStart<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> unboxSum <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> unboxStart <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    unboxSum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;unbox waste time, &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> unboxStart<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>控制台打印如下，可以看到没有自动装箱的操作花费的时间大大减少了。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>box waste time, 4415ms.
unbox waste time, 862ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="消除过期的对象引用" tabindex="-1"><a class="header-anchor" href="#消除过期的对象引用" aria-hidden="true">#</a> 消除过期的对象引用</h2><h3 id="隐蔽的内存泄漏问题及解决方案" tabindex="-1"><a class="header-anchor" href="#隐蔽的内存泄漏问题及解决方案" aria-hidden="true">#</a> 隐蔽的内存泄漏问题及解决方案</h3><p>在支持垃圾回收的语言中，内存泄漏是十分隐蔽的，作者称这类内存泄漏为 “无意识的对象保持” （unintentional object retention）。<strong><!----></strong></p><p>修复方案非常简单：<strong><!----></strong>。</p><h3 id="注意点" tabindex="-1"><a class="header-anchor" href="#注意点" aria-hidden="true">#</a> 注意点</h3><p><strong><!----></strong>。</p><p>关于内存泄漏的来源有下面几种：</p><ol><li><strong>只要是类自己管理内存，程序员就应该警惕内存泄漏的问题</strong>；常见的如数组的元素，后面再举一个 RocketMQ 的例子；</li><li><strong>缓存也是内存泄漏的一个来源（这里的缓存是本地缓存的概念）</strong>，因为”缓存项的生命周期是否有意义“并不容器被确定，所以应该时不时的清除调没有用的数据。例如可以通过 java.util.LinkedHashMap#removeEldestEntry 来实现一个 LRU；</li><li><strong>内存泄漏的第三个常见来源是监听器和其他回调</strong>。 如果你实现了一个 API，客户端在这个 API 中注册回调，却没有显式地取消注册，那么除非你采取某些动作，否则它们就会不断地堆积起来 。</li></ol><h3 id="简易栈的问题以及解决方案" tabindex="-1"><a class="header-anchor" href="#简易栈的问题以及解决方案" aria-hidden="true">#</a> 简易栈的问题以及解决方案</h3><p>先看下作者给的案例，一个简易栈的实现：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stack</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Object</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elements<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EmptyStackException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> elements<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>elements<span class="token punctuation">.</span>length <span class="token operator">==</span> size<span class="token punctuation">)</span>
            elements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的 pop 方法会出现比较隐蔽的内存泄漏，关键点就是在 <code>elements[--size]</code> 这里，我们只是将 size 减 1 了，这样之前的元素只是我们访问不到了，并没有被删除，它和它引用的那些对象都不会被垃圾回收器回收，这就出现了内存泄漏了。解决方案如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EmptyStackException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> result <span class="token operator">=</span> elements<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
    elements<span class="token punctuation">[</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// Eliminate obsolete reference</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实就是显示的将用不到的对象置空就行了，help gc。</p><h3 id="rocketmq-中的案例" tabindex="-1"><a class="header-anchor" href="#rocketmq-中的案例" aria-hidden="true">#</a> RocketMQ 中的案例</h3><p>RocketMQ 中的消费者需要去 broker 拉取消息去消费，其中 broker 的返回对象如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PullResultExt</span> <span class="token keyword">extends</span> <span class="token class-name">PullResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> suggestWhichBrokerId<span class="token punctuation">;</span>
    <span class="token comment">// 从网络中读取消息列表中的属性</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messageBinary<span class="token punctuation">;</span>
 
	<span class="token comment">// ...... 省略其他 ......   </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的 messageBinary 是 broker 返回的消息的字节数组，消费者这边需要进行解码，解码代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">PullResult</span> <span class="token function">processPullResult</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">MessageQueue</span> mq<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">PullResult</span> pullResult<span class="token punctuation">,</span>
	<span class="token keyword">final</span> <span class="token class-name">SubscriptionData</span> subscriptionData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">PullResultExt</span> pullResultExt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PullResultExt</span><span class="token punctuation">)</span> pullResult<span class="token punctuation">;</span>

	<span class="token comment">// ...... 省略其他处理 ......</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">PullStatus</span><span class="token punctuation">.</span><span class="token constant">FOUND</span> <span class="token operator">==</span> pullResult<span class="token punctuation">.</span><span class="token function">getPullStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 消息转换成 ByteBUffer</span>
		<span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>pullResultExt<span class="token punctuation">.</span><span class="token function">getMessageBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 解码</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgList <span class="token operator">=</span> <span class="token class-name">MessageDecoder</span><span class="token punctuation">.</span><span class="token function">decodes</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// ...... 省略过滤处理 ......</span>

		<span class="token comment">// 将再次过滤后的消息 list，保存到 pullResult 中</span>
		pullResultExt<span class="token punctuation">.</span><span class="token function">setMsgFoundList</span><span class="token punctuation">(</span>msgListFilterAgain<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// help gc</span>
	pullResultExt<span class="token punctuation">.</span><span class="token function">setMessageBinary</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> pullResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关键点就是将 byte 数组转码成消费者识别的对象后，保存到新的字段中去了，最后会将字节数组字段置空，help gc，就是 <code>pullResultExt.setMessageBinary(null)</code></p><h2 id="避免使用终结方法和清除方法" tabindex="-1"><a class="header-anchor" href="#避免使用终结方法和清除方法" aria-hidden="true">#</a> 避免使用终结方法和清除方法</h2><p>终结方法（finalizer）通常是不可预测的，也是很危险的，一般情况下是不必要的。使用终结方法会导致行为不稳定、性能降低，以及可移植性的问题。一般需要避免使用终结方法。在 Java9 中用清除方法（cleaner）代替了终结方法。清除方法没有终结方法那么危险，但仍然是不可预测、运行缓慢的，一般情况也是不建议使用的。</p><p>终结方法和清除方法都有的问题：</p><ul><li>终结方法和清除方法有非常严重的性能损失；</li><li>终结方法和清除方法不保证会被及时执行，当一个对象被视为不可达时，才会去调用它们的终结方法或清除方法，这段时间是无法控制的，这个现象在不同的 JVM 中的效果也是不一样的；</li></ul><p>终结方法独有的问题：</p><ul><li>调用终结方法的线程是一个低优先级的线程，所以终结方法的执行效率在某些情况下可能并不高；</li><li>终结方法还有一个问题是，如果忽略在终结过程中被抛出来的未被捕获的异常，该对象的终结过程也会被终止。如果异常发生在终结方法中，并不会打印出栈轨迹，甚至连警告都不会打印出来；</li></ul><p><strong><!----></strong>。</p><h2 id="try-with-resources-优先于-try-finally" tabindex="-1"><a class="header-anchor" href="#try-with-resources-优先于-try-finally" aria-hidden="true">#</a> try-with-resources 优先于 try-finally</h2><p>Java 类库中有许多需要通过 close 方法来手动关闭的资源。例如 InputStream、OutputStream 和 java.sql.Connection。但是客户端往往会忘记关闭资源。</p><p>try-finally 语句是确保资源关闭的最佳方式，就算发送异常或者返回也会调用 finally 后的语句。但是 try-finally 对关闭多个资源并不友好，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BUFFER_SIZE</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

<span class="token comment">// try-finally is ugly when used with more than one resource! (Page 34)</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token class-name">String</span> src<span class="token punctuation">,</span> <span class="token class-name">String</span> dst<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token constant">BUFFER_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> n<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Java7 引入了 try-with-resource 的语句。使用这个语句的前提是，要被 close 的资源必须实现 AutoCloseable 接口，其中包含了单个返回 void 的 close 方法。Java 类库和其他第三方类库中，现在都实现或者扩展了 AutoCloseable 接口。如果编写了一个类，它代表的是必须关闭的资源，那么这个类也应该实现 AutoCloseable 接口</strong>。上面的案例改造如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BUFFER_SIZE</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

<span class="token comment">// try-with-resources on multiple resources - short and sweet (Page 35)</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token class-name">String</span> src<span class="token punctuation">,</span> <span class="token class-name">String</span> dst<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span>   in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token constant">BUFFER_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> n<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><!----></strong></p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: guosgbin@163.com">Dylan Kwok</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a href="/EffectiveJava_note/" class="nav-link active prev" aria-label="《Effective Java》第三版阅读笔记"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->《Effective Java》第三版阅读笔记</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-ecfdc732.js" defer></script>
  </body>
</html>
