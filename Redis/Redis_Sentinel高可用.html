<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://blog.guosgbin.cn/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html"><meta property="og:title" content="Redis Sentinelé«˜å¯ç”¨"><meta property="og:description" content="ç‰ˆæœ¬ å†…å®¹ æ—¶é—´ ---- ---------------------------------------- ---------------------- V1 æ–°å»º 2023å¹´04æœˆ05æ—¥00:30:28 V2 æ–°å¢ Jedis çš„ JedisSentinelPool æºç åˆ†æ 2023å¹´04æœˆ11æ—¥22:47:21 Sentinel åŸºæœ¬æ¦‚å¿µ å¼•å…¥..."><meta property="og:type" content="article"><meta property="og:image" content="https://blog.guosgbin.cn/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-05-07T11:11:01.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Redis Sentinelé«˜å¯ç”¨"><meta property="article:author" content="è¶…å¨è“çŒ« Dylan Kwok"><meta property="article:modified_time" content="2023-05-07T11:11:01.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis Sentinelé«˜å¯ç”¨","image":["https://blog.guosgbin.cn/"],"dateModified":"2023-05-07T11:11:01.000Z","author":[{"@type":"Person","name":"è¶…å¨è“çŒ« Dylan Kwok","url":"","email":"guosgbin@163.com"}]}</script><link rel="icon" href="/å°ç†ŠçŒ«.svg"><title>Redis Sentinelé«˜å¯ç”¨</title><meta name="description" content="ç‰ˆæœ¬ å†…å®¹ æ—¶é—´ ---- ---------------------------------------- ---------------------- V1 æ–°å»º 2023å¹´04æœˆ05æ—¥00:30:28 V2 æ–°å¢ Jedis çš„ JedisSentinelPool æºç åˆ†æ 2023å¹´04æœˆ11æ—¥22:47:21 Sentinel åŸºæœ¬æ¦‚å¿µ å¼•å…¥...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-219a40be.css" as="style"><link rel="stylesheet" href="/assets/style-219a40be.css">
    <link rel="modulepreload" href="/assets/app-3c76045a.js"><link rel="modulepreload" href="/assets/Redis_Sentinelé«˜å¯ç”¨.html-5d63f8e2.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/Redis_Sentinelé«˜å¯ç”¨.html-6bcdb34a.js"><link rel="prefetch" href="/assets/index.html-31dfa0cc.js" as="script"><link rel="prefetch" href="/assets/01-åˆ›å»ºå’Œé”€æ¯å¯¹è±¡.html-98280ce1.js" as="script"><link rel="prefetch" href="/assets/index.html-c4f42206.js" as="script"><link rel="prefetch" href="/assets/01-CASå’ŒUnsafeçš„APIåˆ†æ.html-612c4d6a.js" as="script"><link rel="prefetch" href="/assets/02-åŸºæœ¬ç±»å‹åŸå­ç±»AtomicLong.html-4083b8fd.js" as="script"><link rel="prefetch" href="/assets/03-å¼•ç”¨ç±»å‹åŸå­ç±»AtomicReference.html-8442553d.js" as="script"><link rel="prefetch" href="/assets/04-åŸå­æ•°ç»„ç±»AtomicLongArray.html-74e4c741.js" as="script"><link rel="prefetch" href="/assets/05-åŸå­æ“ä½œç±»AtomicReferenceFieldUpdater.html-d0310b2a.js" as="script"><link rel="prefetch" href="/assets/06-é«˜æ€§èƒ½åŸå­ç±»LongAdder.html-d6e3da8b.js" as="script"><link rel="prefetch" href="/assets/07-LockSupportåˆ†æ.html-8117dd17.js" as="script"><link rel="prefetch" href="/assets/08-AQSç®€å•ä»‹ç».html-f6f424de.js" as="script"><link rel="prefetch" href="/assets/09-åŸºäºReentrantLockåˆ†æAQSçš„ç‹¬å æ¨¡å¼.html-2423c430.js" as="script"><link rel="prefetch" href="/assets/10-åŸºäºCountDownLatchåˆ†æAQSçš„å…±äº«æ¨¡å¼.html-91ef4833.js" as="script"><link rel="prefetch" href="/assets/11-AQSçš„Conditionæœºåˆ¶.html-836364af.js" as="script"><link rel="prefetch" href="/assets/12-ä¿¡å·é‡Semaphore.html-3509682c.js" as="script"><link rel="prefetch" href="/assets/13-å¾ªç¯æ æ …CyclicBarrier.html-812d137d.js" as="script"><link rel="prefetch" href="/assets/14-é˜¶æ®µPhaser.html-d684f4a1.js" as="script"><link rel="prefetch" href="/assets/15-äº¤æ¢Exchanger.html-b9bf24f3.js" as="script"><link rel="prefetch" href="/assets/16-è¯»å†™é”ReentrantReadWriteLock.html-de44a1d3.js" as="script"><link rel="prefetch" href="/assets/17-Futureæ¨¡å¼-FutureTask.html-641c6250.js" as="script"><link rel="prefetch" href="/assets/18-çº¿ç¨‹æ± ä½“ç³»æ¦‚è¿°.html-dbcc52e5.js" as="script"><link rel="prefetch" href="/assets/19-çº¿ç¨‹æ± ä½“ç³»-AbstractExecutorService.html-fbd70afb.js" as="script"><link rel="prefetch" href="/assets/20-çº¿ç¨‹æ± ä½“ç³»-ThreadPoolExecutor.html-a274637a.js" as="script"><link rel="prefetch" href="/assets/21-çº¿ç¨‹æ± ä½“ç³»-ScheduledThreadPoolExecutor.html-707ffd40.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayListå†™æ—¶å¤åˆ¶.html-914977b9.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySetå†™æ—¶å¤åˆ¶.html-6c9c3cf6.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMapè·³è¡¨.html-6cff54bf.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSetè·³è¡¨.html-36cf4f7d.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMapæºç åˆ†æ.html-a3bba8a9.js" as="script"><link rel="prefetch" href="/assets/27-é˜»å¡é˜Ÿåˆ—ArrayBlockingQueue.html-cd091357.js" as="script"><link rel="prefetch" href="/assets/28-é˜»å¡é˜Ÿåˆ—LinkedBlockingQueue.html-d3579ee7.js" as="script"><link rel="prefetch" href="/assets/29-é˜»å¡é˜Ÿåˆ—LinkedBlockingDeque.html-32c13680.js" as="script"><link rel="prefetch" href="/assets/30-é˜»å¡é˜Ÿåˆ—PriorityBlockingQueue.html-b5455c77.js" as="script"><link rel="prefetch" href="/assets/31-é˜»å¡é˜Ÿåˆ—DelayQueue.html-7759c195.js" as="script"><link rel="prefetch" href="/assets/32-é˜»å¡é˜Ÿåˆ—SynchronousQueue.html-97ed879a.js" as="script"><link rel="prefetch" href="/assets/33-é˜»å¡é˜Ÿåˆ—LinkedTransferQueue.html-3281c1b4.js" as="script"><link rel="prefetch" href="/assets/index.html-f5239cf3.js" as="script"><link rel="prefetch" href="/assets/SPIæœºåˆ¶.html-a1ca3921.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis01ï¼šmyabtisçš„æ•´ä½“æ¶æ„.html-f25c0705.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis02ï¼šå…¥é—¨æ¡ˆä¾‹.html-30e68cd3.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis03ï¼šè§£æå…¨å±€é…ç½®æ–‡ä»¶.html-2db85266.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis04ï¼šè§£æMapperæ˜ å°„æ–‡ä»¶.html-60756a5b.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis05ï¼šè§£æStatementæ“ä½œèŠ‚ç‚¹.html-31e11b60.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis06ï¼šè§£æSQLè¯­å¥.html-a9181b56.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis07ï¼šJavaæ–¹æ³•å’ŒSQLè¯­å¥ç»‘å®š.html-9bfa3db6.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis08ï¼šè·å¾—SqlSession.html-e2a92940.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis09ï¼šExecutoræ‰§è¡Œå™¨.html-ad701715.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis10ï¼šç¼“å­˜æœºåˆ¶.html-f2daa10c.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis11ï¼šStatementHandler.html-95b30d9b.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis12ï¼šå‚æ•°è§£æå’Œèµ‹å€¼.html-5778c0ea.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis13ï¼šç»“æœé›†å¤„ç†.html-2ff72779.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis14ï¼šæ’ä»¶.html-76cc6bf8.js" as="script"><link rel="prefetch" href="/assets/01-æœåŠ¡ç«¯å¯åŠ¨æµç¨‹.html-d2fc1f19.js" as="script"><link rel="prefetch" href="/assets/02-æœåŠ¡ç«¯å¯åŠ¨æ·»åŠ ChannelInitializeråˆ°ç®¡é“.html-86cb5d6a.js" as="script"><link rel="prefetch" href="/assets/03-å®¢æˆ·ç«¯å¯åŠ¨æµç¨‹.html-becc83be.js" as="script"><link rel="prefetch" href="/assets/04-çº¿ç¨‹ä½“ç³»-NioEventLoopGroup.html-700e797e.js" as="script"><link rel="prefetch" href="/assets/05-çº¿ç¨‹ä½“ç³»-NioEventLoopç›¸å…³çˆ¶æ¥å£åˆ†æ.html-754320bc.js" as="script"><link rel="prefetch" href="/assets/06-çº¿ç¨‹ä½“ç³»-AbstractEventExecutor.html-5250cd42.js" as="script"><link rel="prefetch" href="/assets/07-çº¿ç¨‹ä½“ç³»-AbstractScheduledEventExecutor-ä¼˜å…ˆé˜Ÿåˆ—.html-e7bbaf32.js" as="script"><link rel="prefetch" href="/assets/08-çº¿ç¨‹ä½“ç³»-NioEventLoopæ¦‚è¿°.html-fce3fb2c.js" as="script"><link rel="prefetch" href="/assets/09-çº¿ç¨‹ä½“ç³»-NioEventLoopå¼€å¯SelectoråŠä¼˜åŒ–.html-6d8230cf.js" as="script"><link rel="prefetch" href="/assets/10-çº¿ç¨‹ä½“ç³»-NioEventLoopç»‘å®šçº¿ç¨‹.html-db947821.js" as="script"><link rel="prefetch" href="/assets/11-çº¿ç¨‹ä½“ç³»-NioEventLoopçš„runæ–¹æ³•.html-def4cc31.js" as="script"><link rel="prefetch" href="/assets/12-çº¿ç¨‹ä½“ç³»-NioEventLoopè§„é¿JDKçš„NIOç©ºå¾ªç¯bug.html-16ecaf4e.js" as="script"><link rel="prefetch" href="/assets/13-çº¿ç¨‹ä½“ç³»-NioEventLoopçš„ä¼˜é›…å…³é—­.html-912d668d.js" as="script"><link rel="prefetch" href="/assets/14-æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥(ACCEPT).html-63afdec1.js" as="script"><link rel="prefetch" href="/assets/15-å®¢æˆ·ç«¯å¤„ç†READäº‹ä»¶æ¦‚è¿°.html-b35daeb8.js" as="script"><link rel="prefetch" href="/assets/16-å®¢æˆ·ç«¯å¤„ç†READäº‹ä»¶è¯¦è§£åŠRecvByteBufAllocator.html-a9faccfa.js" as="script"><link rel="prefetch" href="/assets/17-Nettyç®¡é“æœºåˆ¶.html-ba70b238.js" as="script"><link rel="prefetch" href="/assets/18-Nettyå‘é€æ•°æ®æµç¨‹åŠå‡ºç«™ç¼“å†²åŒº.html-223d04a7.js" as="script"><link rel="prefetch" href="/assets/index.html-b475d8b0.js" as="script"><link rel="prefetch" href="/assets/Redis_BenchmarkåŸºå‡†æµ‹è¯•.html-dbf21951.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤å’Œæ§½ç®¡ç†å‘½ä»¤.html-2b4a1244.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤åŸºæœ¬ç‰¹æ€§å’Œé›†ç¾¤æ­å»º.html-42be726b.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤ç®¡ç†å·¥å…·redis-cli.html-fc4f1503.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipelineä¼˜åŒ–RTT.html-8a4aa041.js" as="script"><link rel="prefetch" href="/assets/Redis_keyè®¾è®¡è§„èŒƒ.html-ab90a7dc.js" as="script"><link rel="prefetch" href="/assets/Redisäº‹åŠ¡.html-e43061e1.js" as="script"><link rel="prefetch" href="/assets/Rediså†…å­˜æ·˜æ±°ç­–ç•¥.html-feabd314.js" as="script"><link rel="prefetch" href="/assets/Rediså‘å¸ƒè®¢é˜….html-68771977.js" as="script"><link rel="prefetch" href="/assets/Rediså¤åˆ¶.html-33b20d6f.js" as="script"><link rel="prefetch" href="/assets/Rediså¤§keyå’Œçƒ­keyé—®é¢˜.html-394d194e.js" as="script"><link rel="prefetch" href="/assets/Redisæ…¢æŸ¥è¯¢æ—¥å¿—.html-7fb06db0.js" as="script"><link rel="prefetch" href="/assets/RedisæŒä¹…åŒ–æœºåˆ¶.html-53af3f7a.js" as="script"><link rel="prefetch" href="/assets/Redisé”®ç©ºé—´é€šçŸ¥(keyspace notification).html-012bd277.js" as="script"><link rel="prefetch" href="/assets/redis-cli ä½¿ç”¨.html-f7ab22db.js" as="script"><link rel="prefetch" href="/assets/01-RocketMQæ¦‚è¿°.html-25463efe.js" as="script"><link rel="prefetch" href="/assets/02-NameServerå¯åŠ¨æµç¨‹.html-a514999f.js" as="script"><link rel="prefetch" href="/assets/03-Brokerå¯åŠ¨æµç¨‹.html-43c84806.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQç½‘ç»œé€šä¿¡åŸç†.html-ac88de8d.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å¯åŠ¨.html-ef7f1888.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQç½‘ç»œé€šä¿¡æºç .html-b8e0bf43.js" as="script"><link rel="prefetch" href="/assets/07-NameServerä½œç”¨å’Œè·¯ç”±å…ƒä¿¡æ¯.html-82a23869.js" as="script"><link rel="prefetch" href="/assets/08-NameServerè·¯ç”±ç®¡ç†æºç åˆ†æ.html-8da2bd72.js" as="script"><link rel="prefetch" href="/assets/09-ç”Ÿäº§è€…ç›¸å…³ç±»åˆ†æ.html-08f6e840.js" as="script"><link rel="prefetch" href="/assets/10-ç”Ÿäº§è€…å¯åŠ¨æµç¨‹.html-d761cf07.js" as="script"><link rel="prefetch" href="/assets/11-ç”Ÿäº§è€…å‘é€æ¶ˆæ¯.html-743328bc.js" as="script"><link rel="prefetch" href="/assets/12-Brokerå­˜å‚¨æœºåˆ¶æ¦‚è¿°.html-5e7ed491.js" as="script"><link rel="prefetch" href="/assets/13-MappedFileå’ŒMappedFileQueueåˆ†æ.html-5b9afaf2.js" as="script"><link rel="prefetch" href="/assets/14-CommitLogåŸç†åˆ†æ.html-93362aa2.js" as="script"><link rel="prefetch" href="/assets/15-brokerçš„åˆ·ç›˜æœºåˆ¶.html-21e2029f.js" as="script"><link rel="prefetch" href="/assets/16-ConsumeQueueå’ŒIndexåŸç†åˆ†æ.html-ff18bade.js" as="script"><link rel="prefetch" href="/assets/17-brokerè¿‡æœŸæ–‡ä»¶åˆ é™¤æœºåˆ¶.html-89f05919.js" as="script"><link rel="prefetch" href="/assets/18-æ¶ˆè´¹è€…å¯åŠ¨æµç¨‹(TODO).html-988c43b3.js" as="script"><link rel="prefetch" href="/assets/19-æ¶ˆæ¯æ‹‰å–å…¥å£å’Œæ¶ˆæ¯é˜Ÿåˆ—è´Ÿè½½å‡è¡¡.html-7e4e20d4.js" as="script"><link rel="prefetch" href="/assets/20-æ¶ˆè´¹è€…å‘é€æ¶ˆæ¯æ‹‰å–è¯·æ±‚æµç¨‹.html-19825069.js" as="script"><link rel="prefetch" href="/assets/21-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-1-ä¸»æµç¨‹.html-d9ca6fa4.js" as="script"><link rel="prefetch" href="/assets/22-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-2-é•¿è½®è¯¢.html-0aba4f38.js" as="script"><link rel="prefetch" href="/assets/23-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-3-è¯»å–æ¶ˆæ¯.html-729d741b.js" as="script"><link rel="prefetch" href="/assets/24-æ¶ˆè´¹è€…å¤„ç†ä»brokeræ‹‰å–çš„æ¶ˆæ¯.html-dcfb7d07.js" as="script"><link rel="prefetch" href="/assets/25-å¹¶å‘æ¶ˆè´¹åŸç†.html-5ef206ec.js" as="script"><link rel="prefetch" href="/assets/resume.html-ae9f6b8c.js" as="script"><link rel="prefetch" href="/assets/404.html-f3795607.js" as="script"><link rel="prefetch" href="/assets/index.html-1f3390c0.js" as="script"><link rel="prefetch" href="/assets/index.html-10b45510.js" as="script"><link rel="prefetch" href="/assets/index.html-dfd17ea5.js" as="script"><link rel="prefetch" href="/assets/index.html-2f392b9e.js" as="script"><link rel="prefetch" href="/assets/index.html-0efbdc5e.js" as="script"><link rel="prefetch" href="/assets/index.html-bcc08b2b.js" as="script"><link rel="prefetch" href="/assets/01-åˆ›å»ºå’Œé”€æ¯å¯¹è±¡.html-c7dc3bc1.js" as="script"><link rel="prefetch" href="/assets/index.html-3504ecc2.js" as="script"><link rel="prefetch" href="/assets/01-CASå’ŒUnsafeçš„APIåˆ†æ.html-f83da6f7.js" as="script"><link rel="prefetch" href="/assets/02-åŸºæœ¬ç±»å‹åŸå­ç±»AtomicLong.html-7f596d55.js" as="script"><link rel="prefetch" href="/assets/03-å¼•ç”¨ç±»å‹åŸå­ç±»AtomicReference.html-8cf5de85.js" as="script"><link rel="prefetch" href="/assets/04-åŸå­æ•°ç»„ç±»AtomicLongArray.html-0a61ba38.js" as="script"><link rel="prefetch" href="/assets/05-åŸå­æ“ä½œç±»AtomicReferenceFieldUpdater.html-c33db206.js" as="script"><link rel="prefetch" href="/assets/06-é«˜æ€§èƒ½åŸå­ç±»LongAdder.html-e76896b8.js" as="script"><link rel="prefetch" href="/assets/07-LockSupportåˆ†æ.html-d94546d3.js" as="script"><link rel="prefetch" href="/assets/08-AQSç®€å•ä»‹ç».html-fb75b9ce.js" as="script"><link rel="prefetch" href="/assets/09-åŸºäºReentrantLockåˆ†æAQSçš„ç‹¬å æ¨¡å¼.html-74ba20c6.js" as="script"><link rel="prefetch" href="/assets/10-åŸºäºCountDownLatchåˆ†æAQSçš„å…±äº«æ¨¡å¼.html-d6833d42.js" as="script"><link rel="prefetch" href="/assets/11-AQSçš„Conditionæœºåˆ¶.html-2b567c7b.js" as="script"><link rel="prefetch" href="/assets/12-ä¿¡å·é‡Semaphore.html-3c4fa7c2.js" as="script"><link rel="prefetch" href="/assets/13-å¾ªç¯æ æ …CyclicBarrier.html-e4ba7e46.js" as="script"><link rel="prefetch" href="/assets/14-é˜¶æ®µPhaser.html-2d728c7e.js" as="script"><link rel="prefetch" href="/assets/15-äº¤æ¢Exchanger.html-4cb4aaa4.js" as="script"><link rel="prefetch" href="/assets/16-è¯»å†™é”ReentrantReadWriteLock.html-1a3d0034.js" as="script"><link rel="prefetch" href="/assets/17-Futureæ¨¡å¼-FutureTask.html-ba104f22.js" as="script"><link rel="prefetch" href="/assets/18-çº¿ç¨‹æ± ä½“ç³»æ¦‚è¿°.html-a519db89.js" as="script"><link rel="prefetch" href="/assets/19-çº¿ç¨‹æ± ä½“ç³»-AbstractExecutorService.html-8bda4499.js" as="script"><link rel="prefetch" href="/assets/20-çº¿ç¨‹æ± ä½“ç³»-ThreadPoolExecutor.html-92e574d6.js" as="script"><link rel="prefetch" href="/assets/21-çº¿ç¨‹æ± ä½“ç³»-ScheduledThreadPoolExecutor.html-46cf1175.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayListå†™æ—¶å¤åˆ¶.html-c460ab8a.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySetå†™æ—¶å¤åˆ¶.html-2a37dc92.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMapè·³è¡¨.html-88e68fac.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSetè·³è¡¨.html-06c8535d.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMapæºç åˆ†æ.html-c588bba3.js" as="script"><link rel="prefetch" href="/assets/27-é˜»å¡é˜Ÿåˆ—ArrayBlockingQueue.html-2339afa5.js" as="script"><link rel="prefetch" href="/assets/28-é˜»å¡é˜Ÿåˆ—LinkedBlockingQueue.html-3ab46d59.js" as="script"><link rel="prefetch" href="/assets/29-é˜»å¡é˜Ÿåˆ—LinkedBlockingDeque.html-13baa2ce.js" as="script"><link rel="prefetch" href="/assets/30-é˜»å¡é˜Ÿåˆ—PriorityBlockingQueue.html-5c7c236f.js" as="script"><link rel="prefetch" href="/assets/31-é˜»å¡é˜Ÿåˆ—DelayQueue.html-2235dad4.js" as="script"><link rel="prefetch" href="/assets/32-é˜»å¡é˜Ÿåˆ—SynchronousQueue.html-c87f9f94.js" as="script"><link rel="prefetch" href="/assets/33-é˜»å¡é˜Ÿåˆ—LinkedTransferQueue.html-a45621b8.js" as="script"><link rel="prefetch" href="/assets/index.html-a77ab32c.js" as="script"><link rel="prefetch" href="/assets/SPIæœºåˆ¶.html-7d1871b8.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis01ï¼šmyabtisçš„æ•´ä½“æ¶æ„.html-ccf8b837.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis02ï¼šå…¥é—¨æ¡ˆä¾‹.html-63b5dd28.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis03ï¼šè§£æå…¨å±€é…ç½®æ–‡ä»¶.html-19c8994e.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis04ï¼šè§£æMapperæ˜ å°„æ–‡ä»¶.html-aa482da5.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis05ï¼šè§£æStatementæ“ä½œèŠ‚ç‚¹.html-ef3bfc18.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis06ï¼šè§£æSQLè¯­å¥.html-75c632d1.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis07ï¼šJavaæ–¹æ³•å’ŒSQLè¯­å¥ç»‘å®š.html-cab54906.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis08ï¼šè·å¾—SqlSession.html-e6bf69f2.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis09ï¼šExecutoræ‰§è¡Œå™¨.html-d75cec22.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis10ï¼šç¼“å­˜æœºåˆ¶.html-dc26c422.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis11ï¼šStatementHandler.html-72bbea18.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis12ï¼šå‚æ•°è§£æå’Œèµ‹å€¼.html-5310109e.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis13ï¼šç»“æœé›†å¤„ç†.html-fa98c3ca.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis14ï¼šæ’ä»¶.html-0aca7db4.js" as="script"><link rel="prefetch" href="/assets/01-æœåŠ¡ç«¯å¯åŠ¨æµç¨‹.html-c2f6c24b.js" as="script"><link rel="prefetch" href="/assets/02-æœåŠ¡ç«¯å¯åŠ¨æ·»åŠ ChannelInitializeråˆ°ç®¡é“.html-9a427c70.js" as="script"><link rel="prefetch" href="/assets/03-å®¢æˆ·ç«¯å¯åŠ¨æµç¨‹.html-9f3176c6.js" as="script"><link rel="prefetch" href="/assets/04-çº¿ç¨‹ä½“ç³»-NioEventLoopGroup.html-7c68340b.js" as="script"><link rel="prefetch" href="/assets/05-çº¿ç¨‹ä½“ç³»-NioEventLoopç›¸å…³çˆ¶æ¥å£åˆ†æ.html-71db5774.js" as="script"><link rel="prefetch" href="/assets/06-çº¿ç¨‹ä½“ç³»-AbstractEventExecutor.html-4b75981e.js" as="script"><link rel="prefetch" href="/assets/07-çº¿ç¨‹ä½“ç³»-AbstractScheduledEventExecutor-ä¼˜å…ˆé˜Ÿåˆ—.html-20fb2833.js" as="script"><link rel="prefetch" href="/assets/08-çº¿ç¨‹ä½“ç³»-NioEventLoopæ¦‚è¿°.html-15f5eeed.js" as="script"><link rel="prefetch" href="/assets/09-çº¿ç¨‹ä½“ç³»-NioEventLoopå¼€å¯SelectoråŠä¼˜åŒ–.html-11c3de6d.js" as="script"><link rel="prefetch" href="/assets/10-çº¿ç¨‹ä½“ç³»-NioEventLoopç»‘å®šçº¿ç¨‹.html-20ee8f6b.js" as="script"><link rel="prefetch" href="/assets/11-çº¿ç¨‹ä½“ç³»-NioEventLoopçš„runæ–¹æ³•.html-331dc095.js" as="script"><link rel="prefetch" href="/assets/12-çº¿ç¨‹ä½“ç³»-NioEventLoopè§„é¿JDKçš„NIOç©ºå¾ªç¯bug.html-2ce8d9ff.js" as="script"><link rel="prefetch" href="/assets/13-çº¿ç¨‹ä½“ç³»-NioEventLoopçš„ä¼˜é›…å…³é—­.html-14097ba9.js" as="script"><link rel="prefetch" href="/assets/14-æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥(ACCEPT).html-565897a0.js" as="script"><link rel="prefetch" href="/assets/15-å®¢æˆ·ç«¯å¤„ç†READäº‹ä»¶æ¦‚è¿°.html-8bfdfd17.js" as="script"><link rel="prefetch" href="/assets/16-å®¢æˆ·ç«¯å¤„ç†READäº‹ä»¶è¯¦è§£åŠRecvByteBufAllocator.html-8732f510.js" as="script"><link rel="prefetch" href="/assets/17-Nettyç®¡é“æœºåˆ¶.html-67511140.js" as="script"><link rel="prefetch" href="/assets/18-Nettyå‘é€æ•°æ®æµç¨‹åŠå‡ºç«™ç¼“å†²åŒº.html-6f7fd970.js" as="script"><link rel="prefetch" href="/assets/index.html-584d0d15.js" as="script"><link rel="prefetch" href="/assets/Redis_BenchmarkåŸºå‡†æµ‹è¯•.html-ceaa3739.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤å’Œæ§½ç®¡ç†å‘½ä»¤.html-083d70e1.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤åŸºæœ¬ç‰¹æ€§å’Œé›†ç¾¤æ­å»º.html-a0e5b691.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤ç®¡ç†å·¥å…·redis-cli.html-d7a6069c.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipelineä¼˜åŒ–RTT.html-9624fa55.js" as="script"><link rel="prefetch" href="/assets/Redis_keyè®¾è®¡è§„èŒƒ.html-2a8d1288.js" as="script"><link rel="prefetch" href="/assets/Redisäº‹åŠ¡.html-7e8db388.js" as="script"><link rel="prefetch" href="/assets/Rediså†…å­˜æ·˜æ±°ç­–ç•¥.html-904c55e6.js" as="script"><link rel="prefetch" href="/assets/Rediså‘å¸ƒè®¢é˜….html-d5852c8c.js" as="script"><link rel="prefetch" href="/assets/Rediså¤åˆ¶.html-7a1ffcf3.js" as="script"><link rel="prefetch" href="/assets/Rediså¤§keyå’Œçƒ­keyé—®é¢˜.html-5f41277b.js" as="script"><link rel="prefetch" href="/assets/Redisæ…¢æŸ¥è¯¢æ—¥å¿—.html-332ee315.js" as="script"><link rel="prefetch" href="/assets/RedisæŒä¹…åŒ–æœºåˆ¶.html-73e756ff.js" as="script"><link rel="prefetch" href="/assets/Redisé”®ç©ºé—´é€šçŸ¥(keyspace notification).html-3777fa11.js" as="script"><link rel="prefetch" href="/assets/redis-cli ä½¿ç”¨.html-310b21ad.js" as="script"><link rel="prefetch" href="/assets/01-RocketMQæ¦‚è¿°.html-fae38680.js" as="script"><link rel="prefetch" href="/assets/02-NameServerå¯åŠ¨æµç¨‹.html-a329e2f1.js" as="script"><link rel="prefetch" href="/assets/03-Brokerå¯åŠ¨æµç¨‹.html-7478967c.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQç½‘ç»œé€šä¿¡åŸç†.html-dd8d7994.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å¯åŠ¨.html-8ddb8f5f.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQç½‘ç»œé€šä¿¡æºç .html-39ad2bf4.js" as="script"><link rel="prefetch" href="/assets/07-NameServerä½œç”¨å’Œè·¯ç”±å…ƒä¿¡æ¯.html-cbd75d7b.js" as="script"><link rel="prefetch" href="/assets/08-NameServerè·¯ç”±ç®¡ç†æºç åˆ†æ.html-e34a7ebf.js" as="script"><link rel="prefetch" href="/assets/09-ç”Ÿäº§è€…ç›¸å…³ç±»åˆ†æ.html-39972512.js" as="script"><link rel="prefetch" href="/assets/10-ç”Ÿäº§è€…å¯åŠ¨æµç¨‹.html-85a4255d.js" as="script"><link rel="prefetch" href="/assets/11-ç”Ÿäº§è€…å‘é€æ¶ˆæ¯.html-c2f0366f.js" as="script"><link rel="prefetch" href="/assets/12-Brokerå­˜å‚¨æœºåˆ¶æ¦‚è¿°.html-537798e1.js" as="script"><link rel="prefetch" href="/assets/13-MappedFileå’ŒMappedFileQueueåˆ†æ.html-e7b81171.js" as="script"><link rel="prefetch" href="/assets/14-CommitLogåŸç†åˆ†æ.html-38cb6751.js" as="script"><link rel="prefetch" href="/assets/15-brokerçš„åˆ·ç›˜æœºåˆ¶.html-57d3941c.js" as="script"><link rel="prefetch" href="/assets/16-ConsumeQueueå’ŒIndexåŸç†åˆ†æ.html-7ef6b7db.js" as="script"><link rel="prefetch" href="/assets/17-brokerè¿‡æœŸæ–‡ä»¶åˆ é™¤æœºåˆ¶.html-9440b808.js" as="script"><link rel="prefetch" href="/assets/18-æ¶ˆè´¹è€…å¯åŠ¨æµç¨‹(TODO).html-c326400f.js" as="script"><link rel="prefetch" href="/assets/19-æ¶ˆæ¯æ‹‰å–å…¥å£å’Œæ¶ˆæ¯é˜Ÿåˆ—è´Ÿè½½å‡è¡¡.html-179bc4e2.js" as="script"><link rel="prefetch" href="/assets/20-æ¶ˆè´¹è€…å‘é€æ¶ˆæ¯æ‹‰å–è¯·æ±‚æµç¨‹.html-88c33cda.js" as="script"><link rel="prefetch" href="/assets/21-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-1-ä¸»æµç¨‹.html-3ac5f0eb.js" as="script"><link rel="prefetch" href="/assets/22-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-2-é•¿è½®è¯¢.html-c23ea7fb.js" as="script"><link rel="prefetch" href="/assets/23-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-3-è¯»å–æ¶ˆæ¯.html-13b02305.js" as="script"><link rel="prefetch" href="/assets/24-æ¶ˆè´¹è€…å¤„ç†ä»brokeræ‹‰å–çš„æ¶ˆæ¯.html-0ef8ebfe.js" as="script"><link rel="prefetch" href="/assets/25-å¹¶å‘æ¶ˆè´¹åŸç†.html-3037f738.js" as="script"><link rel="prefetch" href="/assets/resume.html-ea5cfc12.js" as="script"><link rel="prefetch" href="/assets/404.html-032f11b4.js" as="script"><link rel="prefetch" href="/assets/index.html-f5298b1a.js" as="script"><link rel="prefetch" href="/assets/index.html-bafd72d0.js" as="script"><link rel="prefetch" href="/assets/index.html-24efbba9.js" as="script"><link rel="prefetch" href="/assets/index.html-fa228c4d.js" as="script"><link rel="prefetch" href="/assets/index.html-eeafea22.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-2450701e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="vp-brand"><img class="vp-nav-logo" src="/å°ç†ŠçŒ«.png" alt><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a href="/Redis/Redis_Benchmark%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redis BenchmarkåŸºå‡†æµ‹è¯•"><!---->Redis BenchmarkåŸºå‡†æµ‹è¯•<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis_Cluster%E9%9B%86%E7%BE%A4%E5%92%8C%E6%A7%BD%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redis Clusteré›†ç¾¤å’Œæ§½ç®¡ç†å‘½ä»¤"><!---->Redis Clusteré›†ç¾¤å’Œæ§½ç®¡ç†å‘½ä»¤<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis_Cluster%E9%9B%86%E7%BE%A4%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7%E5%92%8C%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redis Clusteré›†ç¾¤åŸºæœ¬ç‰¹æ€§å’Œé›†ç¾¤æ­å»º"><!---->Redis Clusteré›†ç¾¤åŸºæœ¬ç‰¹æ€§å’Œé›†ç¾¤æ­å»º<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis_Cluster%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7redis-cli.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redis Clusteré›†ç¾¤ç®¡ç†å·¥å…·redis-cli"><!---->Redis Clusteré›†ç¾¤ç®¡ç†å·¥å…·redis-cli<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis_key%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redis keyè®¾è®¡è§„èŒƒ"><!---->Redis keyè®¾è®¡è§„èŒƒ<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis_Pipeline%E4%BC%98%E5%8C%96RTT.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redis Pipelineä¼˜åŒ–RTT"><!---->Redis Pipelineä¼˜åŒ–RTT<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html" class="router-link-active router-link-exact-active nav-link active vp-sidebar-link vp-sidebar-page active" aria-label="Redis Sentinelé«˜å¯ç”¨"><!---->Redis Sentinelé«˜å¯ç”¨<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-åŸºæœ¬æ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel åŸºæœ¬æ¦‚å¿µ"><!---->Sentinel åŸºæœ¬æ¦‚å¿µ<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å¼•å…¥" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="å¼•å…¥"><!---->å¼•å…¥<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜"><!---->ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹"><!---->æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#redis-sentinel-é«˜å¯ç”¨" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Redis Sentinel é«˜å¯ç”¨"><!---->Redis Sentinel é«˜å¯ç”¨<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#redis-sentinel-æ•…éšœè½¬ç§»æµç¨‹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Redis Sentinel æ•…éšœè½¬ç§»æµç¨‹"><!---->Redis Sentinel æ•…éšœè½¬ç§»æµç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å¯åŠ¨-sentinel-å‘½ä»¤" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="å¯åŠ¨ Sentinel å‘½ä»¤"><!---->å¯åŠ¨ Sentinel å‘½ä»¤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel é…ç½®æ–‡ä»¶"><!---->Sentinel é…ç½®æ–‡ä»¶<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§"><!---->è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-éƒ¨ç½²æ¡ˆä¾‹-å®˜ç½‘çš„æ¡ˆä¾‹-çœ‹çœ‹å°±è¡Œäº†" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel éƒ¨ç½²æ¡ˆä¾‹ï¼ˆå®˜ç½‘çš„æ¡ˆä¾‹ï¼Œçœ‹çœ‹å°±è¡Œäº†ï¼‰"><!---->Sentinel éƒ¨ç½²æ¡ˆä¾‹ï¼ˆå®˜ç½‘çš„æ¡ˆä¾‹ï¼Œçœ‹çœ‹å°±è¡Œäº†ï¼‰<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰"><!---->æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-1-ä»…æœ‰ä¸¤ä¸ª-sentinel-ä¸å»ºè®®" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Example 1:ä»…æœ‰ä¸¤ä¸ª Sentinelï¼ˆä¸å»ºè®®ï¼‰"><!---->Example 1:ä»…æœ‰ä¸¤ä¸ª Sentinelï¼ˆä¸å»ºè®®ï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-2-ä¸‰ä¸ª-sentinel" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Example 2:ä¸‰ä¸ª Sentinel"><!---->Example 2:ä¸‰ä¸ª Sentinel<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-3-å®¢æˆ·ç«¯ä¸­çš„-sentinel" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Example 3:å®¢æˆ·ç«¯ä¸­çš„ Sentinel"><!---->Example 3:å®¢æˆ·ç«¯ä¸­çš„ Sentinel<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-4-å°‘äº-3-ä¸ªå®¢æˆ·ç«¯çš„-sentinel-å®¢æˆ·ç«¯" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Example 4: å°‘äº 3 ä¸ªå®¢æˆ·ç«¯çš„ Sentinel å®¢æˆ·ç«¯"><!---->Example 4: å°‘äº 3 ä¸ªå®¢æˆ·ç«¯çš„ Sentinel å®¢æˆ·ç«¯<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#éƒ¨ç½²-sentinel-æ³¨æ„çš„åœ°æ–¹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="éƒ¨ç½² Sentinel æ³¨æ„çš„åœ°æ–¹"><!---->éƒ¨ç½² Sentinel æ³¨æ„çš„åœ°æ–¹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å®é™…éƒ¨ç½²æ¡ˆä¾‹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="å®é™…éƒ¨ç½²æ¡ˆä¾‹"><!---->å®é™…éƒ¨ç½²æ¡ˆä¾‹<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#éƒ¨ç½²-redis-æ•°æ®èŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="éƒ¨ç½² Redis æ•°æ®èŠ‚ç‚¹"><!---->éƒ¨ç½² Redis æ•°æ®èŠ‚ç‚¹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#éƒ¨ç½²-sentinel-èŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="éƒ¨ç½² Sentinel èŠ‚ç‚¹"><!---->éƒ¨ç½² Sentinel èŠ‚ç‚¹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ—¥å¿—åˆ†æ" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="æ—¥å¿—åˆ†æ"><!---->æ—¥å¿—åˆ†æ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-api" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel API"><!---->Sentinel API<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-ç®¡ç†å‘½ä»¤" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel ç®¡ç†å‘½ä»¤"><!---->Sentinel ç®¡ç†å‘½ä»¤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#åœ¨çº¿ä¿®æ”¹-sentinel-é…ç½®é¡¹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="åœ¨çº¿ä¿®æ”¹ Sentinel é…ç½®é¡¹"><!---->åœ¨çº¿ä¿®æ”¹ Sentinel é…ç½®é¡¹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ·»åŠ æˆ–åˆ é™¤-sentinel" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="æ·»åŠ æˆ–åˆ é™¤ Sentinel"><!---->æ·»åŠ æˆ–åˆ é™¤ Sentinel<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹"><!---->ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#pub-sub-messages" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Pub/Sub messages"><!---->Pub/Sub messages<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-å®¢æˆ·ç«¯" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel å®¢æˆ·ç«¯"><!---->Sentinel å®¢æˆ·ç«¯<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-å®¢æˆ·ç«¯å®ç°åŸç†" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel å®¢æˆ·ç«¯å®ç°åŸç†"><!---->Sentinel å®¢æˆ·ç«¯å®ç°åŸç†<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#jedis-çš„-jedissentinelpool-åŸç†" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Jedis çš„ JedisSentinelPool åŸç†"><!---->Jedis çš„ JedisSentinelPool åŸç†<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-å®ç°åŸç†" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel å®ç°åŸç†"><!---->Sentinel å®ç°åŸç†<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å®šæ—¶ä»»åŠ¡" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="å®šæ—¶ä»»åŠ¡"><!---->å®šæ—¶ä»»åŠ¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#ä¸»è§‚ä¸‹çº¿-sdown" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="ä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰"><!---->ä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å®¢è§‚ä¸‹çº¿-odown" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="å®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰"><!---->å®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„-sentinel" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„ Sentinel"><!---->é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„ Sentinel<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™"><!---->æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é…ç½®ç‰ˆæœ¬å·-configuration-epochs" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="é…ç½®ç‰ˆæœ¬å·ï¼ˆConfiguration epochsï¼‰"><!---->é…ç½®ç‰ˆæœ¬å·ï¼ˆConfiguration epochsï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é…ç½®ä¼ æ’­æ€§-configuration-propagation" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="é…ç½®ä¼ æ’­æ€§ï¼ˆConfiguration propagationï¼‰"><!---->é…ç½®ä¼ æ’­æ€§ï¼ˆConfiguration propagationï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§"><!---->åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-é…ç½®æŒä¹…åŒ–" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Sentinel é…ç½®æŒä¹…åŒ–"><!---->Sentinel é…ç½®æŒä¹…åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#è¿ç»´" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="è¿ç»´"><!---->è¿ç»´<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ¨¡æ‹Ÿæ•…éšœè½¬ç§»" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="æ¨¡æ‹Ÿæ•…éšœè½¬ç§»"><!---->æ¨¡æ‹Ÿæ•…éšœè½¬ç§»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é«˜å¯ç”¨è¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="é«˜å¯ç”¨è¯»å†™åˆ†ç¦»"><!---->é«˜å¯ç”¨è¯»å†™åˆ†ç¦»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/Redis/redis-cli%20%E4%BD%BF%E7%94%A8.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="redis-cliä½¿ç”¨"><!---->redis-cliä½¿ç”¨<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E4%BA%8B%E5%8A%A1.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redisäº‹åŠ¡"><!---->Redisäº‹åŠ¡<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Rediså†…å­˜æ·˜æ±°ç­–ç•¥"><!---->Rediså†…å­˜æ·˜æ±°ç­–ç•¥<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Rediså‘å¸ƒè®¢é˜…"><!---->Rediså‘å¸ƒè®¢é˜…<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E5%A4%8D%E5%88%B6.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Rediså¤åˆ¶"><!---->Rediså¤åˆ¶<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E5%A4%A7key%E5%92%8C%E7%83%ADkey%E9%97%AE%E9%A2%98.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Rediså¤§keyå’Œçƒ­keyé—®é¢˜"><!---->Rediså¤§keyå’Œçƒ­keyé—®é¢˜<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redisæ…¢æŸ¥è¯¢æ—¥å¿—"><!---->Redisæ…¢æŸ¥è¯¢æ—¥å¿—<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="RedisæŒä¹…åŒ–æœºåˆ¶"><!---->RedisæŒä¹…åŒ–æœºåˆ¶<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Redis/Redis%E9%94%AE%E7%A9%BA%E9%97%B4%E9%80%9A%E7%9F%A5(keyspace%20notification).html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="Redisé”®ç©ºé—´é€šçŸ¥"><!---->Redisé”®ç©ºé—´é€šçŸ¥<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redis Sentinelé«˜å¯ç”¨</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">è¶…å¨è“çŒ« Dylan Kwok</span></span><span property="author" content="è¶…å¨è“çŒ« Dylan Kwok"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-05-07T11:11:01.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 56 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT56M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-åŸºæœ¬æ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level2">Sentinel åŸºæœ¬æ¦‚å¿µ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å¼•å…¥" class="router-link-active router-link-exact-active toc-link level3">å¼•å…¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹" class="router-link-active router-link-exact-active toc-link level3">æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#redis-sentinel-é«˜å¯ç”¨" class="router-link-active router-link-exact-active toc-link level3">Redis Sentinel é«˜å¯ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#redis-sentinel-æ•…éšœè½¬ç§»æµç¨‹" class="router-link-active router-link-exact-active toc-link level3">Redis Sentinel æ•…éšœè½¬ç§»æµç¨‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å¯åŠ¨-sentinel-å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level2">å¯åŠ¨ Sentinel å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level2">Sentinel é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§" class="router-link-active router-link-exact-active toc-link level2">è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-éƒ¨ç½²æ¡ˆä¾‹-å®˜ç½‘çš„æ¡ˆä¾‹-çœ‹çœ‹å°±è¡Œäº†" class="router-link-active router-link-exact-active toc-link level2">Sentinel éƒ¨ç½²æ¡ˆä¾‹ï¼ˆå®˜ç½‘çš„æ¡ˆä¾‹ï¼Œçœ‹çœ‹å°±è¡Œäº†ï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰" class="router-link-active router-link-exact-active toc-link level3">æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-1-ä»…æœ‰ä¸¤ä¸ª-sentinel-ä¸å»ºè®®" class="router-link-active router-link-exact-active toc-link level3">Example 1:ä»…æœ‰ä¸¤ä¸ª Sentinelï¼ˆä¸å»ºè®®ï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-2-ä¸‰ä¸ª-sentinel" class="router-link-active router-link-exact-active toc-link level3">Example 2:ä¸‰ä¸ª Sentinel</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-3-å®¢æˆ·ç«¯ä¸­çš„-sentinel" class="router-link-active router-link-exact-active toc-link level3">Example 3:å®¢æˆ·ç«¯ä¸­çš„ Sentinel</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#example-4-å°‘äº-3-ä¸ªå®¢æˆ·ç«¯çš„-sentinel-å®¢æˆ·ç«¯" class="router-link-active router-link-exact-active toc-link level3">Example 4: å°‘äº 3 ä¸ªå®¢æˆ·ç«¯çš„ Sentinel å®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#éƒ¨ç½²-sentinel-æ³¨æ„çš„åœ°æ–¹" class="router-link-active router-link-exact-active toc-link level3">éƒ¨ç½² Sentinel æ³¨æ„çš„åœ°æ–¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å®é™…éƒ¨ç½²æ¡ˆä¾‹" class="router-link-active router-link-exact-active toc-link level2">å®é™…éƒ¨ç½²æ¡ˆä¾‹</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#éƒ¨ç½²-redis-æ•°æ®èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">éƒ¨ç½² Redis æ•°æ®èŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#éƒ¨ç½²-sentinel-èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">éƒ¨ç½² Sentinel èŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ—¥å¿—åˆ†æ" class="router-link-active router-link-exact-active toc-link level3">æ—¥å¿—åˆ†æ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-api" class="router-link-active router-link-exact-active toc-link level2">Sentinel API</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-ç®¡ç†å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level3">Sentinel ç®¡ç†å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#åœ¨çº¿ä¿®æ”¹-sentinel-é…ç½®é¡¹" class="router-link-active router-link-exact-active toc-link level3">åœ¨çº¿ä¿®æ”¹ Sentinel é…ç½®é¡¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ·»åŠ æˆ–åˆ é™¤-sentinel" class="router-link-active router-link-exact-active toc-link level3">æ·»åŠ æˆ–åˆ é™¤ Sentinel</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#pub-sub-messages" class="router-link-active router-link-exact-active toc-link level3">Pub/Sub messages</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-å®¢æˆ·ç«¯" class="router-link-active router-link-exact-active toc-link level2">Sentinel å®¢æˆ·ç«¯</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-å®¢æˆ·ç«¯å®ç°åŸç†" class="router-link-active router-link-exact-active toc-link level3">Sentinel å®¢æˆ·ç«¯å®ç°åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#jedis-çš„-jedissentinelpool-åŸç†" class="router-link-active router-link-exact-active toc-link level3">Jedis çš„ JedisSentinelPool åŸç†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-å®ç°åŸç†" class="router-link-active router-link-exact-active toc-link level2">Sentinel å®ç°åŸç†</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å®šæ—¶ä»»åŠ¡" class="router-link-active router-link-exact-active toc-link level3">å®šæ—¶ä»»åŠ¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#ä¸»è§‚ä¸‹çº¿-sdown" class="router-link-active router-link-exact-active toc-link level3">ä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#å®¢è§‚ä¸‹çº¿-odown" class="router-link-active router-link-exact-active toc-link level3">å®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„-sentinel" class="router-link-active router-link-exact-active toc-link level3">é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„ Sentinel</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™" class="router-link-active router-link-exact-active toc-link level3">æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é…ç½®ç‰ˆæœ¬å·-configuration-epochs" class="router-link-active router-link-exact-active toc-link level3">é…ç½®ç‰ˆæœ¬å·ï¼ˆConfiguration epochsï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é…ç½®ä¼ æ’­æ€§-configuration-propagation" class="router-link-active router-link-exact-active toc-link level3">é…ç½®ä¼ æ’­æ€§ï¼ˆConfiguration propagationï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§" class="router-link-active router-link-exact-active toc-link level3">åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#sentinel-é…ç½®æŒä¹…åŒ–" class="router-link-active router-link-exact-active toc-link level3">Sentinel é…ç½®æŒä¹…åŒ–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#è¿ç»´" class="router-link-active router-link-exact-active toc-link level2">è¿ç»´</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#æ¨¡æ‹Ÿæ•…éšœè½¬ç§»" class="router-link-active router-link-exact-active toc-link level3">æ¨¡æ‹Ÿæ•…éšœè½¬ç§»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html#é«˜å¯ç”¨è¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active toc-link level3">é«˜å¯ç”¨è¯»å†™åˆ†ç¦»</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><table><thead><tr><th>ç‰ˆæœ¬</th><th>å†…å®¹</th><th>æ—¶é—´</th></tr></thead><tbody><tr><td>V1</td><td>æ–°å»º</td><td>2023å¹´04æœˆ05æ—¥00:30:28</td></tr><tr><td>V2</td><td>æ–°å¢ Jedis çš„ JedisSentinelPool æºç åˆ†æ</td><td>2023å¹´04æœˆ11æ—¥22:47:21</td></tr></tbody></table><h2 id="sentinel-åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#sentinel-åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a> Sentinel åŸºæœ¬æ¦‚å¿µ</h2><h3 id="å¼•å…¥" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥" aria-hidden="true">#</a> å¼•å…¥</h3><p>åœ¨ Redis å¤åˆ¶æœºåˆ¶ï¼Œä¸€æ—¦ä¸»èŠ‚ç‚¹å› æ•…ä¸‹çº¿ï¼Œå¯ä»¥å°†å®ƒå…¶ä¸­çš„ä¸€ä¸ªä»èŠ‚ç‚¹è½¬æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œè®©æ–°çš„ä¸»èŠ‚ç‚¹ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œè¿™æ ·æ•´ä¸ªç³»ç»Ÿå°±å¯ä»¥ç»§ç»­è¿ä½œã€‚</p><p>ä½†æ˜¯è½¬æ¢çš„æ“ä½œéœ€è¦äººä¸ºæ¥æ“ä½œï¼Œä¸€èˆ¬çš„æ­¥éª¤å°±æ˜¯<strong>è®©ä¸€ä¸ªä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œç„¶åè¿˜è¦é€šçŸ¥å®¢æˆ·ç«¯æ›´æ¢ä¸»èŠ‚ç‚¹åœ°å€</strong>ã€‚è¿™æ ·æ“ä½œæ¯”è¾ƒéº»çƒ¦ï¼ŒRedis Sentinel å¯ä»¥é€šè¿‡å¿ƒè·³æ£€æµ‹çš„æ–¹å¼ç›‘è§†å¤šä¸ªä¸»èŠ‚ç‚¹ä»¥åŠå®ƒä»¬çš„ä»èŠ‚ç‚¹ï¼Œå¹¶åœ¨æŸä¸ªä¸»èŠ‚ç‚¹ä¸‹çº¿æ—¶è‡ªåŠ¨å¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦äººå·¥ä»‹å…¥ã€‚</p><h3 id="ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜" aria-hidden="true">#</a> ä¸»ä»å¤åˆ¶çš„ä½œç”¨å’Œé—®é¢˜</h3><p>Redis ä¸»ä»å¤åˆ¶çš„ä½œç”¨ï¼š</p><ol><li>ä¸»èŠ‚ç‚¹<strong>æ•…éšœè½¬ç§»</strong>ï¼›</li><li>å¯ä»¥<strong>æé«˜æ•´ä¸ªç³»ç»Ÿçš„è¯»èƒ½åŠ›</strong>ï¼›</li></ol><p>ä½†æ˜¯ Redis ä¸»ä»å¤åˆ¶ä¹Ÿå¸¦äº†é—®é¢˜ï¼š</p><ol><li>ä¸€æ—¦ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œéœ€è¦<strong>æ‰‹åŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹</strong>ï¼ŒåŒæ—¶<strong>éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„ä¸»èŠ‚ç‚¹çš„åœ°å€</strong>ï¼Œè¿˜éœ€å…¶å®ƒçš„ä»èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li><li>ä¸»èŠ‚ç‚¹çš„<strong>å†™èƒ½åŠ›</strong>å—åˆ°å•èŠ‚ç‚¹çš„é™åˆ¶ï¼›</li><li>ä¸»èŠ‚ç‚¹çš„<strong>å­˜å‚¨èƒ½åŠ›</strong>å—åˆ°å•èŠ‚ç‚¹çš„é™åˆ¶ï¼›â€˜</li></ol><p>ç¬¬ä¸€ä¸ªå¯ä»¥ç”¨ Sentinel è§£å†³ï¼Œåé¢ä¸¤ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨ Redis é›†ç¾¤è§£å†³ã€‚</p><h3 id="æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹" aria-hidden="true">#</a> æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„è¿‡ç¨‹</h3><ol><li>å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœåï¼Œå®¢æˆ·ç«¯è¿æ¥ä¸»èŠ‚ç‚¹å¤±è´¥ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ä¸ä¸»æœºè¿æ¥å¤±è´¥å¯¼è‡´å¤åˆ¶ä¸­æ–­ï¼›</li><li>å¦‚æœä¸»èŠ‚ç‚¹æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œéœ€è¦é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¯¹å…¶æ‰§è¡Œ slaveof no one / replicaof no one å‘½ä»¤ä½¿å…¶ç§°ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼›</li><li>åŸæ¥çš„ä»èŠ‚ç‚¹æˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹åï¼Œæ›´æ–°å®¢æˆ·ç«¯çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œé‡æ–°å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥ï¼›</li><li>å®¢æˆ·ç«¯å‘½ä»¤å¦ä¸€ä¸ªä»èŠ‚ç‚¹å»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ï¼›</li><li>ç­‰å¾…åŸæ¥çš„ä¸»èŠ‚ç‚¹æ¢å¤åï¼Œè®©å®ƒæˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li></ol><img src="/assets/image-20230403220225938-85877827.png" alt="image-20230403220225938" style="zoom:67%;"><p>å› ä¸ºä¸Šé¢çš„è¿‡ç¨‹æ˜¯äººå·¥æ‰‹åŠ¨ä»‹å…¥çš„ï¼Œæœ‰å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>åˆ¤æ–­èŠ‚ç‚¹ä¸å¯è¾¾çš„æœºåˆ¶æ˜¯å¦åˆç†ï¼›</li><li>å¦‚æœæœ‰å¤šä¸ªä»èŠ‚ç‚¹ï¼Œæ€ä¹ˆä¿è¯åªæœ‰ä¸€ä¸ªä»èŠ‚ç‚¹å˜æˆæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªèŠ‚ç‚¹æˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼›</li><li>é€šçŸ¥å®¢æˆ·ç«¯è¿æ¥æ–°çš„ä¸»èŠ‚ç‚¹çš„æœºåˆ¶æ˜¯å¦è¶³å¤Ÿå¥å£®ï¼›</li></ul><p>Redis Sentinel çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜çš„ã€‚</p><h3 id="redis-sentinel-é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#redis-sentinel-é«˜å¯ç”¨" aria-hidden="true">#</a> Redis Sentinel é«˜å¯ç”¨</h3><p>Redis Sentinel æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«è‹¥å¹²ä¸ª Sentinel èŠ‚ç‚¹å’Œ Redis æ•°æ®èŠ‚ç‚¹ï¼Œæä¾›çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>ç›‘æ§ï¼šSentinel ä¸æ–­æ£€æŸ¥ Redis çš„ä¸»ä»èŠ‚ç‚¹æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼Œè¿˜ä¼šç›‘æ§å…¶ä½™çš„ Sentinel èŠ‚ç‚¹ï¼›</li><li>é€šçŸ¥ï¼šå½“å…¶ä¸­ä¸€ä¸ªå—ç›‘æ§çš„ Redis èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼ŒSentinel å¯ä»¥é€šè¿‡ API é€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜æˆ–å…¶ä»–è®¡ç®—æœºç¨‹åºï¼›</li><li>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå¦‚æœä¸»èŠ‚ç‚¹æ²¡æœ‰æŒ‰é¢„æœŸå·¥ä½œï¼ŒSentinel å¯ä»¥å¯åŠ¨æ•…éšœè½¬ç§»è¿‡ç¨‹ï¼Œå°†æŸä¸ªä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶å®ƒçš„ä»èŠ‚ç‚¹è¢«é‡æ–°é…ç½®ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä½¿ç”¨ Redis æœåŠ¡çš„åº”ç”¨ç¨‹åºè¢«å‘ŠçŸ¥è¿æ¥æ—¶è¦ä½¿ç”¨çš„æ–°ä¸»èŠ‚ç‚¹åœ°å€ï¼›</li><li>é…ç½®æä¾›è€…ï¼šSentinel å……å½“å®¢æˆ·ç«¯æœåŠ¡å‘ç°çš„æƒå¨æ¥æºï¼šå®¢æˆ·ç«¯è¿æ¥åˆ° Sentinel ä»¥è¯¢é—®è´Ÿè´£ç»™å®šæœåŠ¡çš„å½“å‰ Redis ä¸»èŠ‚ç‚¹çš„åœ°å€ã€‚å¦‚æœå‘ç”Ÿæ•…éšœè½¬ç§»ï¼ŒSentinels å°†æŠ¥å‘Šæ–°åœ°å€ã€‚</li></ul><p>Redis Sentinel å’Œ Redis çš„ä¸»ä»å¤åˆ¶åªæ˜¯å¤šäº†ä¸€äº› Sentinel èŠ‚ç‚¹ï¼Œå¹¶æ²¡æœ‰å¯¹ Redis æ•°æ®èŠ‚ç‚¹åšç‰¹æ®Šå¤„ç†ã€‚</p><img src="/assets/Redisä¸»ä»å¤åˆ¶å’ŒSentinelæ¶æ„çš„åŒºåˆ«-660ace7e.png" alt="Redisä¸»ä»å¤åˆ¶å’ŒSentinelæ¶æ„çš„åŒºåˆ«" style="zoom:67%;"><h3 id="redis-sentinel-æ•…éšœè½¬ç§»æµç¨‹" tabindex="-1"><a class="header-anchor" href="#redis-sentinel-æ•…éšœè½¬ç§»æµç¨‹" aria-hidden="true">#</a> Redis Sentinel æ•…éšœè½¬ç§»æµç¨‹</h3><p>ä»¥ 1 ä¸ªä¸»èŠ‚ç‚¹ã€2 ä¸ªä»èŠ‚ç‚¹ã€3 ä¸ª Sentinel èŠ‚ç‚¹ç»„æˆçš„ Redis Sentinel ä¸ºä¾‹ï¼š</p><ol><li>ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œæ­¤æ—¶ä¸¤ä¸ªä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹å¤±å»è¿æ¥ï¼Œä¸»ä»å¤åˆ¶å¤±è´¥ï¼›</li><li>æ¯ä¸ª Sentinel èŠ‚ç‚¹é€šè¿‡å®šæ—¶ä»»åŠ¡ç›‘æ§å‘ç°ä¸»èŠ‚ç‚¹å‘ç”Ÿäº†æ•…éšœï¼›</li><li>å¤šä¸ª Sentinel èŠ‚ç‚¹å¯¹ä¸»èŠ‚ç‚¹çš„æ•…éšœè¾¾æˆä¸€è‡´ï¼Œé€‰ä¸¾å‡º Sentinel3 èŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…è´Ÿè´£æ•…éšœè½¬ç§»æ“ä½œï¼›</li><li>Sentinel é¢†å¯¼è€…èŠ‚ç‚¹æ‰§è¡Œäº†æ•…éšœè½¬ç§»ï¼Œæ•´ä¸ªè¿‡ç¨‹å’Œå‰é¢è¯´çš„æ‰‹åŠ¨æ•…éšœè½¬ç§»æ˜¯ä¸€æ ·çš„ï¼›</li></ol><img src="/assets/Redis-Sentinelçš„æ•…éšœè½¬ç§»æµç¨‹-34665bc8.png" alt="Redis Sentinelçš„æ•…éšœè½¬ç§»æµç¨‹" style="zoom:67%;"><h2 id="å¯åŠ¨-sentinel-å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨-sentinel-å‘½ä»¤" aria-hidden="true">#</a> å¯åŠ¨ Sentinel å‘½ä»¤</h2><p>Sentinel çš„å½“å‰ç‰ˆæœ¬ç§°ä¸º Sentinel 2ã€‚å®ƒæ˜¯å¯¹åˆå§‹ Sentinel å®ç°çš„é‡å†™ï¼Œä½¿ç”¨æ›´å¼ºå¤§ä¸”æ›´æ˜“äºé¢„æµ‹çš„ç®—æ³•ã€‚Redis Sentinel çš„ç¨³å®šç‰ˆæœ¬ä» Redis 2.8 å¼€å§‹å‘å¸ƒã€‚éš Redis 2.6 ä¸€èµ·æä¾›çš„ Redis Sentinel ç‰ˆæœ¬ 1 å·²ç»å¼ƒç”¨äº†ã€‚</p><p>å¯ä»¥ä½¿ç”¨</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>redis-sentinel /path/to/sentinel.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ–è€…</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>redis-server /path/to/sentinel.conf --sentinel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨è¿è¡Œ Sentinel æ—¶å¿…é¡»æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œå› ä¸ºç³»ç»Ÿå°†ä½¿ç”¨æ­¤æ–‡ä»¶æ¥ä¿å­˜å½“å‰çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨é‡æ–°å¯åŠ¨æ—¶é‡æ–°åŠ è½½ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šé…ç½®æ–‡ä»¶æˆ–è€…é…ç½®æ–‡ä»¶è·¯å¾„ä¸å¯å†™ï¼ŒSentinel å°†æ‹’ç»å¯åŠ¨ã€‚</p><blockquote><p><strong>å…³äº Redis Sentinel èŠ‚ç‚¹ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Redis èŠ‚ç‚¹ï¼Œåªä¸è¿‡å®ƒä¸å­˜å‚¨æ•°æ®ï¼Œåªæ”¯æŒéƒ¨åˆ†å‘½ä»¤ã€‚</strong></p></blockquote><h2 id="sentinel-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#sentinel-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> Sentinel é…ç½®æ–‡ä»¶</h2><p>åœ¨ä¸‹è½½çš„ Redis ä¸­æœ‰ä¸€ä¸ª sentinel.conf æ–‡ä»¶</p><p> sentinel.conf æ–‡ä»¶å†…ï¼ˆä»¥ Redis 5.0.14 çš„é…ç½®ä¸ºä¾‹ï¼‰çš„ä¸»è¦é…ç½®å¦‚ä¸‹ï¼ˆå…¶ä»–é…ç½®å»çœ‹å‘è¡Œç‰ˆçš„ sentinel.confï¼‰ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">port</span> <span class="token value attr-value">&lt;sentinel-port&gt;</span>
<span class="token key attr-name">logfile</span> <span class="token value attr-value">&lt;filename&gt;</span>
<span class="token key attr-name">dir</span> <span class="token value attr-value">&lt;working-directory&gt;</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">auth-pass &lt;master-name&gt; &lt;password&gt;</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">notification-script &lt;master-name&gt; &lt;script-path&gt;</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>port &lt;sentinel-port&gt;</code></p><p>ç»™ Sentinel æŒ‡å®šç«¯å£å·ï¼Œé»˜è®¤ 26379ï¼›</p></li><li><p><code>logfile &lt;filename&gt;</code></p><p>Sentinel æ—¥å¿—æ–‡ä»¶çš„åå­—ï¼›</p></li><li><p><code>dir &lt;working-directory&gt;</code></p><p>Sentinel çš„å·¥ä½œç›®å½•ï¼›</p></li><li><p><code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</code></p><ul><li>è¡¨ç¤ºè¦ç›‘è§†çš„ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯</li><li>mater-nameï¼šä¸»èŠ‚ç‚¹çš„åå­—ï¼›</li><li>ipï¼šä¸»èŠ‚ç‚¹çš„åœ°å€ï¼›</li><li>redis-portï¼šä¸»èŠ‚ç‚¹çš„ç«¯å£ï¼›</li><li>quorumï¼šç”¨äºæ•…éšœå‘ç°å’Œåˆ¤å®šã€‚æœ‰ä¸¤ç§å«ä¹‰ï¼Œä¸€ç§æ˜¯<strong>åˆ¤æ–­ master ä¸å¯è¾¾éœ€è¦çš„ Sentinels çš„æ•°é‡</strong>ï¼Œä¾‹å¦‚å°†quorum é…ç½®ä¸º 2ï¼Œè¡¨ç¤ºè‡³å°‘æœ‰ 2 ä¸ª Sentinel èŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œ é‚£ä¹ˆè¿™ä¸ªä¸å¯è¾¾çš„åˆ¤å®šæ‰æ˜¯å®¢è§‚çš„ã€‚ç¬¬äºŒç§å«ä¹‰æ˜¯<strong>åœ¨ Sentinel é¢†å¯¼è€…é€‰ä¸¾</strong>ä¸­ï¼Œè‡³å°‘è¦æœ‰ <code>max(quorum, num(sentinels) / 2 + 1)</code> ä¸ª Sentinel èŠ‚ç‚¹å‚ä¸é€‰ä¸¾ï¼Œ æ‰èƒ½é€‰å‡ºé¢†å¯¼è€… Sentinelï¼Œ ä»è€Œå®Œæˆæ•…éšœè½¬ç§»;</li></ul></li><li><p><code>sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</code></p><ul><li>master-nameï¼šä¸»èŠ‚ç‚¹çš„åå­—ï¼›</li><li>passwordï¼šé…ç½®ä¸»èŠ‚ç‚¹çš„å¯†ç ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è®¿é—®ä»èŠ‚ç‚¹çš„å¯†ç ä¹Ÿæ˜¯ä»è¿™é‡Œè·å–çš„ï¼›</li></ul></li><li><p><code>sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</code></p><ul><li>æ¯ä¸ª Sentinel èŠ‚ç‚¹éƒ½è¦é€šè¿‡å®šæœŸå‘é€ PING å‘½ä»¤æ¥åˆ¤æ–­ Redis æ•°æ®èŠ‚ç‚¹å’Œå…¶ä»–çš„ Sentinel èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ï¼Œå¦‚æœè¶…è¿‡äº†è¯¥æ—¶é—´ä¸”æ²¡æœ‰æœ‰æ•ˆçš„å›å¤ï¼ˆè¦ä¹ˆä¸å›å¤æˆ‘ä»¬çš„ PINGï¼Œè¦ä¹ˆå›å¤ä¸€ä¸ªé”™è¯¯ï¼‰ï¼Œåˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯è¾¾ã€‚ï¼ˆå•ä½æ¯«ç§’ï¼‰ï¼›</li><li>è¿™ä¸ªå€¼è®¾ç½®çš„è¶Šå¤§ï¼Œä¹Ÿå°±æ˜¯å¯¹ Sentinel èŠ‚ç‚¹å¯¹å…¶ä»–èŠ‚ç‚¹ä¸å¯è¾¾çš„åˆ¤æ–­æ¡ä»¶æ˜¯å®½æ¾çš„ã€‚åä¹‹è¶Šä¸¥æ ¼ã€‚<strong>å®½æ¾çš„æ¡ä»¶æœ‰å¯èƒ½å¸¦æ¥çš„é—®é¢˜æ˜¯èŠ‚ç‚¹ç¡®å®ä¸å¯è¾¾äº†ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºç­‰å¾…æ•…éšœè½¬ç§»çš„æ—¶é—´è¶Šé•¿</strong>ï¼Œä¹Ÿå°±æ„å‘³ç€åº”ç”¨æ–¹æ•…éšœçš„æ—¶é—´å¯èƒ½è¶Šé•¿ã€‚<strong>æ¡ä»¶ä¸¥æ ¼è™½ç„¶å¯ä»¥åŠæ—¶å‘ç°æ•…éšœå¹¶å®Œæˆæ•…éšœè½¬ç§»ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡</strong>ï¼›</li><li>è¯¥å‚æ•°<strong>å¯¹ Sentinel èŠ‚ç‚¹ã€ ä¸»èŠ‚ç‚¹ã€ ä»èŠ‚ç‚¹çš„æ•…éšœåˆ¤å®šåŒæ—¶æœ‰æ•ˆ</strong>ï¼›</li></ul></li><li><p><code>sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;</code></p><ul><li>å½“ Sentinel èŠ‚ç‚¹é›†åˆå¯¹ä¸»èŠ‚ç‚¹çš„æ•…éšœåˆ¤æ–­è¾¾æˆä¸€è‡´æ—¶ï¼Œé€‰ä¸¾å‡ºæ¥çš„ Sentinel é¢†å¯¼è€…èŠ‚ç‚¹å°±ä¼šå»åšæ•…éšœè½¬ç§»æ“ä½œï¼Œé€‰ä¸€ä¸ªä»èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå…¶å®ƒçš„ä»èŠ‚ç‚¹éœ€è¦å‘æ–°çš„ä¸»èŠ‚ç‚¹å‘èµ·å¤åˆ¶è¯·æ±‚ï¼Œ<strong>parallel-syncs é…ç½®é¡¹å°±æ˜¯é™åˆ¶ä¸€æ¬¡æ•…éšœè½¬ç§»ä¹‹åï¼Œæ¯æ¬¡å‘æ–°çš„ä¸»èŠ‚ç‚¹å‘èµ·å¤åˆ¶çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚</strong></li><li>è¿™ä¸ªå€¼æ•°å­—è¶Šä½ï¼Œå®Œæˆæ•…éšœè½¬ç§»è¿‡ç¨‹æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ã€‚è™½ç„¶ä»èŠ‚ç‚¹çš„å¤åˆ¶è¿‡ç¨‹å¤§éƒ¨åˆ†æ˜¯éé˜»å¡çš„ï¼Œä½†æ˜¯<strong>å‡å¦‚åŒæ—¶æœ‰å¾ˆå¤šä¸ªä»èŠ‚ç‚¹ç»™ä¸»èŠ‚ç‚¹å‘èµ·åŒæ­¥è¯·æ±‚æ—¶ï¼Œå°±ä¼šæ¶ˆè€—ä¸»èŠ‚ç‚¹çš„æ€§èƒ½</strong>ã€‚ä¸€èˆ¬è®¾ç½®æˆ 1 å°±å¥½äº†ï¼›</li></ul></li><li><p><code>sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</code></p><p>æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ï¼Œé€šå¸¸æœ‰ä¸‹é¢å‡ ä¸ªç”¨å¤„ï¼š</p><ul><li>å¦‚æœæŸä¸ª Sentinel å·²ç»å°è¯•è¿‡é’ˆå¯¹åŒä¸€ä¸»èŠ‚ç‚¹è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œåˆ™é‡æ–°å¯åŠ¨æ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´æ˜¯ä¸¤å€çš„æ•…éšœè½¬ç§»è¶…æ—¶æ—¶é—´ï¼›</li><li>å½“ Sentinel é€‰ä¸€ä¸ªä»èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹åï¼Œä»èŠ‚ç‚¹æ‰§è¡Œ SLAVEOF NO ONE å‘½ä»¤å¤±è´¥ï¼ˆå¯èƒ½æ˜¯æ•…éšœäº†ï¼‰ï¼Œå½“è¿™ä¸ªæ—¶é—´è¶…è¿‡ failover-timeout æ—¶é—´ï¼Œåˆ™è®¤ä¸ºæ•…éšœè½¬ç§»å¤±è´¥ï¼›</li><li>å‡å¦‚ä»èŠ‚ç‚¹æˆåŠŸæ™‹å‡ä¸ºä¸»èŠ‚ç‚¹åï¼Œå½“æŒ‰ç…§ Sentinel å½“å‰é…ç½®è¿›è¡Œå¤åˆ¶çš„ä»èŠ‚ç‚¹æ­£åœ¨é”™è¯¯çš„ä¸»èŠ‚ç‚¹ä¸Šå¤åˆ¶æ—¶ï¼Œå¼ºåˆ¶å…¶ä¸æ­£ç¡®çš„ã€æ–°çš„ä¸»èŠ‚ç‚¹è¿›è¡Œå¤åˆ¶æ‰€éœ€çš„æ—¶é—´æ­£å¥½æ˜¯æ•…éšœè½¬ç§»è¶…æ—¶æ—¶é—´ï¼ˆä» Sentinel æ£€æµ‹åˆ°é…ç½®é”™è¯¯çš„æ—¶åˆ»å¼€å§‹è®¡ç®—ï¼‰ï¼›</li><li>è¿›è¡Œä¸­çš„æ•…éšœè½¬ç§»ç­‰å¾…æ‰€æœ‰ä»èŠ‚ç‚¹è¢«é‡æ–°é…ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹çš„æœ€é•¿æ—¶é—´ã€‚æ³¨æ„å³ä½¿è¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œ Sentinel èŠ‚ç‚¹ä¹Ÿä¼šæœ€ç»ˆé…ç½®ä»èŠ‚ç‚¹å»åŒæ­¥æœ€æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä½†ä¸ä¼šæŒ‰ç…§æŒ‡å®šçš„å¹¶è¡ŒåŒæ­¥è¿›åº¦è¿›è¡Œï¼›</li></ul></li><li><p><code>sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</code></p><ul><li>åœ¨æ•…éšœè½¬ç§»æœŸé—´ï¼Œå½“ä¸€äº›è­¦å‘Šçº§åˆ«çš„ Sentinel äº‹ä»¶å‘ç”Ÿï¼ˆæŒ‡é‡è¦äº‹ä»¶ï¼Œä¾‹å¦‚ -sdownï¼šå®¢è§‚ä¸‹çº¿ã€-odownï¼šä¸»è§‚ä¸‹çº¿ï¼‰æ—¶ï¼Œä¼šè§¦å‘å¯¹åº”è·¯å¾„çš„è„šæœ¬ï¼Œå¹¶å‘è„šæœ¬å‘é€ç›¸åº”çš„äº‹ä»¶å‚æ•°ã€‚</li></ul></li><li><p><code>sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</code></p><ul><li>å½“ä¸»èŠ‚ç‚¹ç”±äºæ•…éšœè½¬ç§»è€Œæ›´æ”¹æ—¶ï¼Œå¯ä»¥è°ƒç”¨ä¸€ä¸ªè„šæœ¬æ¥æ‰§è¡Œåº”ç”¨ç¨‹åºç‰¹å®šçš„ä»»åŠ¡ï¼Œä»¥é€šçŸ¥å®¢æˆ·ç«¯é…ç½®å·²æ›´æ”¹ï¼Œä¸»èŠ‚ç‚¹å·²ç»ä½äºä¸åŒçš„åœ°å€ï¼›</li><li>å½“æ•…éšœè½¬ç§»ç»“æŸï¼Œ æ¯ä¸ªSentinelèŠ‚ç‚¹ä¼šå°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å¯¹åº”çš„è„šæœ¬ï¼Œ å…·ä½“å‚æ•°å¦‚ä¸‹</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>&lt;state&gt;</code> is currently always &quot;failover&quot;ï¼›</li><li><code>&lt;role&gt;</code> is either &quot;leader&quot; or &quot;observer&quot;</li><li>Redis è§„å®šè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ä¸èƒ½è¶…è¿‡ 60 ç§’ï¼Œ è¶…è¿‡åè„šæœ¬å°†è¢«æ€æ‰ï¼›</li></ul></li></ul><blockquote><p>ä¸Šé¢çš„éƒ¨åˆ†å‚æ•°å¯ä»¥åœ¨è¿è¡Œæ—¶é…ç½®ï¼Œåé¢è®²è§£å¦‚ä½•åœ¨è¿è¡Œæ—¶é…ç½®</p></blockquote><p>å…³äº parallel-syncs é…ç½®é¡¹çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><img src="/assets/parallel-syncsé…ç½®é¡¹çš„å«ä¹‰-78696e14.png" alt="parallel-syncsé…ç½®é¡¹çš„å«ä¹‰" style="zoom:67%;"><p>å…¸å‹çš„æœ€å°é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">sentinel</span> <span class="token value attr-value">monitor mymaster 127.0.0.1 6379 2</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">down-after-milliseconds mymaster 60000</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">failover-timeout mymaster 180000</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">parallel-syncs mymaster 1</span>

<span class="token key attr-name">sentinel</span> <span class="token value attr-value">monitor resque 192.168.1.3 6380 4</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">down-after-milliseconds resque 10000</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">failover-timeout resque 180000</span>
<span class="token key attr-name">sentinel</span> <span class="token value attr-value">parallel-syncs resque 5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸Šé¢çš„é…ç½®<strong>è¯´æ˜å½“å‰ Sentinel å®ä¾‹ç›‘æ§ä¸¤ä¸ªä¸»èŠ‚ç‚¹</strong>ã€‚</p><img src="/assets/Redis-Sentinelé›†åˆç›‘æ§å¤šä¸ªä¸»èŠ‚ç‚¹-e54f05e2.png" alt="Redis Sentinelé›†åˆç›‘æ§å¤šä¸ªä¸»èŠ‚ç‚¹" style="zoom:67%;"><h2 id="è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§" aria-hidden="true">#</a> è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§</h2><p>ç”¨æˆ·å¯ä»¥é€šè¿‡ replica-priority é…ç½®é¡¹æ¥è®¾ç½®å„ä¸ªä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„ä»èŠ‚ç‚¹åœ¨ Sentinel é€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹çš„æ—¶å€™ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚</p><p><strong>replica-priority é»˜è®¤å€¼æ˜¯ 100ï¼Œè¿™ä¸ªå€¼è¶Šå°è¡¨ç¤ºä»èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„ä¼˜å…ˆçº§è¶Šé«˜</strong>ã€‚</p><p>é€šè¿‡è¿™ä¸ªé…ç½®ï¼Œæˆ‘ä»¬<strong>å¯ä»¥ç»™æ€§èƒ½è¾ƒé«˜çš„ä»èŠ‚ç‚¹è®¾ç½®è¾ƒé«˜çš„ä¼˜å…ˆçº§æ¥å°½å¯èƒ½çš„ä¿è¯æ–°çš„ä¸»èŠ‚ç‚¹çš„æ€§èƒ½</strong>ï¼Œå› ä¸ºä¸»èŠ‚ç‚¹åœ¨ä¸‹çº¿å¹¶é‡æ–°ä¸Šçº¿ä¹‹åä¹Ÿä¼šå˜æˆä»èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬<strong>ä¹Ÿåº”è¯¥ç»™ä¸»èŠ‚ç‚¹è®¾ç½®ç›¸åº”çš„ä¼˜å…ˆçº§</strong>ã€‚</p><p><strong>replica-priority å€¼ä¸º 0 çš„ä»å‡ ç‚¹æ°¸è¿œä¸ä¼šè¢«é€‰ä¸ºä¸»èŠ‚ç‚¹</strong>ã€‚</p><h2 id="sentinel-éƒ¨ç½²æ¡ˆä¾‹-å®˜ç½‘çš„æ¡ˆä¾‹-çœ‹çœ‹å°±è¡Œäº†" tabindex="-1"><a class="header-anchor" href="#sentinel-éƒ¨ç½²æ¡ˆä¾‹-å®˜ç½‘çš„æ¡ˆä¾‹-çœ‹çœ‹å°±è¡Œäº†" aria-hidden="true">#</a> Sentinel éƒ¨ç½²æ¡ˆä¾‹ï¼ˆå®˜ç½‘çš„æ¡ˆä¾‹ï¼Œçœ‹çœ‹å°±è¡Œäº†ï¼‰</h2><h3 id="æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰" aria-hidden="true">#</a> æ¡ˆä¾‹çš„å›¾æ¡ˆçš„å«ä¹‰</h3><p>æŒ‰ç…§å®˜ç½‘çš„éƒ¨ç½²æ¡ˆä¾‹åˆ†æï¼Œéœ€è¦äº†è§£å®˜ç½‘çš„æ¡ˆä¾‹çš„ä¸€äº›å›¾æ¡ˆçš„å«ä¹‰</p><p>box è¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹çš„æœºå™¨ï¼›</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+--------------------+
| This is a computer |
| or VM that fails   |
| independently. We  |
| call it a &quot;box&quot;    |
+--------------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ¡†æ¡†é‡Œé¢å†™å®ƒé‡Œé¢è¿è¡Œçš„è¿›ç¨‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+-------------------+
| Redis master M1   |
| Redis Sentinel S1 |
+-------------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸åŒçš„ boxç”¨çº¿è¿æ¥èµ·æ¥ï¼Œè¡¨ç¤ºå®ƒä»¬ä¼šè¿›è¡Œé€šä¿¡ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+-------------+               +-------------+
| Sentinel S1 |---------------| Sentinel S2 |
+-------------+               +-------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨åŒæ–œçº¿è¡¨ç¤ºç½‘ç»œåˆ†åŒº</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+-------------+                +-------------+
| Sentinel S1 |------ // ------| Sentinel S2 |
+-------------+                +-------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦å¤–ï¼š</p><ul><li>Masters are called M1, M2, M3, ..., Mn.</li><li>Replicas are called R1, R2, R3, ..., Rn (R stands for <em>replica</em>).</li><li>Sentinels are called S1, S2, S3, ..., Sn.</li><li>Clients are called C1, C2, C3, ..., Cn.</li><li>å½“ä¸€ä¸ªå®ä¾‹å› ä¸º Sentinel çš„åŠ¨ä½œè€Œæ”¹å˜è§’è‰²æ—¶ï¼Œæˆ‘ä»¬å°†å…¶æ”¾åœ¨æ–¹æ‹¬å·å†…ï¼Œå› æ­¤ [M1] è¡¨ç¤ºä¸€ä¸ªå®ä¾‹ç”±äº Sentinel çš„å¹²é¢„åç°åœ¨æ˜¯ä¸»èŠ‚ç‚¹ï¼›</li></ul><h3 id="example-1-ä»…æœ‰ä¸¤ä¸ª-sentinel-ä¸å»ºè®®" tabindex="-1"><a class="header-anchor" href="#example-1-ä»…æœ‰ä¸¤ä¸ª-sentinel-ä¸å»ºè®®" aria-hidden="true">#</a> Example 1:ä»…æœ‰ä¸¤ä¸ª Sentinelï¼ˆä¸å»ºè®®ï¼‰</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+----+         +----+
| M1 |---------| R1 |
| S1 |         | S2 |
+----+         +----+

Configuration: quorum = 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤è®¾ç½®ä¸­ï¼Œå¦‚æœä¸» M1 å‘ç”Ÿæ•…éšœï¼ŒR1 å°†æ™‹å‡ï¼Œå› ä¸ºä¸¤ä¸ª Sentinels å¯ä»¥å°±æ•…éšœè¾¾æˆä¸€è‡´ï¼ˆæ˜¾ç„¶å°† quorum è®¾ç½®ä¸º 1ï¼‰å¹¶ä¸”è¿˜å¯ä»¥æˆæƒæ•…éšœè½¬ç§»ï¼Œå› ä¸ºå¤§å¤šæ•°æ˜¯ä¸¤ä¸ªã€‚</p><p>çœ‹èµ·æ¥å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¦‚æœè¿è¡Œ M1 çš„ box åœæ­¢å·¥ä½œï¼Œåˆ™ S1 ä¹Ÿåœæ­¢å·¥ä½œã€‚åœ¨å¦ä¸€ä¸ªbox çš„ S2 ä¸­è¿è¡Œçš„ Sentinel å°†æ— æ³•æˆæƒæ•…éšœè½¬ç§»ï¼Œå› æ­¤ç³»ç»Ÿå°†å˜å¾—ä¸å¯ç”¨</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>+----+           +------+
| M1 |----//-----| [M1] |
| S1 |           | S2   |
+----+           +------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºæŸç§åŸå› ï¼Œä¸¤ä¸ªæœºå™¨æ–­å¼€é“¾æ¥ï¼ŒS2 å°†åŒæœºå™¨çš„ R1 æå‡è§’è‰²ä¸º masterï¼Œè¿™æ ·é›†ç¾¤é‡Œï¼Œå‡ºç°äº†ä¸¤ä¸ª master åŒæ—¶å·¥ä½œ â€”â€” è„‘è£‚å‡ºç°äº†ã€‚ä¸åŒçš„ client é“¾æ¥åˆ°ä¸åŒçš„ redis è¿›è¡Œè¯»å†™ï¼Œé‚£ä¹ˆä¸¤å°æœºå™¨å°±å‡ºç°äº† redis æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ã€‚</p><p>å› æ­¤ï¼Œè¯·å§‹ç»ˆåœ¨ 3 ä¸ªä¸åŒçš„æ¡†ä¸­éƒ¨ç½²è‡³å°‘ 3 ä¸ªSentinelã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æœ‰ä¸€ä¸ªå¤šæ•°æ”¯æŒçš„å“¨å…µç¾¤ä½“æ¥ç›‘è§†å¹¶åè°ƒä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„åˆ‡æ¢ï¼Œä»è€Œé¿å…æ°¸ä¹…æ€§çš„è„‘è£‚æƒ…å†µã€‚</p><h3 id="example-2-ä¸‰ä¸ª-sentinel" tabindex="-1"><a class="header-anchor" href="#example-2-ä¸‰ä¸ª-sentinel" aria-hidden="true">#</a> Example 2:ä¸‰ä¸ª Sentinel</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„è®¾ç½®ï¼Œå…¶ä¼˜ç‚¹æ˜¯æ˜“äºè°ƒæ•´ä»¥æé«˜å®‰å…¨æ€§ã€‚å®ƒåŸºäºä¸‰ä¸ª boxï¼Œæ¯ä¸ª box éƒ½è¿è¡Œä¸€ä¸ª Redis è¿›ç¨‹å’Œä¸€ä¸ª Sentinel è¿›ç¨‹ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>   	   +----+
       | M1 |
       | S1 |
       +----+
          |
+----+    |    +----+
| R2 |----+----| R3 |
| S2 |         | S3 |
+----+         +----+

Configuration: quorum = 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸» M1 å‘ç”Ÿæ•…éšœï¼ŒS2 å’Œ S3 å°†å°±æ•…éšœè¾¾æˆä¸€è‡´ï¼Œå¹¶èƒ½å¤Ÿæˆæƒæ•…éšœè½¬ç§»ï¼Œä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿç»§ç»­ã€‚</p><p>åœ¨æ¯ä¸ª Sentinel è®¾ç½®ä¸­ï¼Œç”±äº Redis ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œå› æ­¤å§‹ç»ˆå­˜åœ¨ä¸¢å¤±æŸäº›å†™å…¥çš„é£é™©ï¼Œå› ä¸ºç»™å®šçš„å·²ç¡®è®¤å†™å…¥å¯èƒ½æ— æ³•åŠæ—¶åŒæ­¥åˆ°æ–°æ™‹å‡ä¸º master çš„ä»èŠ‚ç‚¹ã€‚ç„¶è€Œï¼Œåœ¨ä¸Šé¢çš„è®¾ç½®ä¸­ï¼Œç”±äºå®¢æˆ·ç«¯è¢«æ—§ master åˆ†åŒºï¼Œå› æ­¤å­˜åœ¨æ›´é«˜çš„é£é™©ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>         +----+
         | M1 |
         | S1 | &lt;- C1 (writes will be lost)
         +----+
            |
            /
            /
+------+    |    +----+
| [M2] |----+----| R3 |
| S2   |         | S3 |
+------+         +----+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç½‘ç»œåˆ†åŒºéš”ç¦»äº†æ—§çš„ä¸»èŠ‚ç‚¹ M1ï¼Œå› æ­¤ä»èŠ‚ç‚¹ R2 è¢«æå‡ä¸ºä¸»èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œä¸æ—§ master ä½äºåŒä¸€åˆ†åŒºä¸­çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ C1ï¼‰å¯èƒ½ä¼šç»§ç»­å‘æ—§ master å†™å…¥æ•°æ®ã€‚</p><p>å¯ä»¥åœ¨ redis.conf é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸‹é¢ä¸¤ä¸ªé…ç½®é¡¹ï¼ˆä¸‹é¢çš„é…ç½®ä¸­çš„ replicas å‡å¦‚æ˜¯æ—§ç‰ˆæœ¬åˆ™æ›¿æ¢æˆ salveï¼‰</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>min-replicas-to-write 1
min-replicas-max-lag 10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®è¿™ä¸¤ä¸ªé€‰é¡¹åï¼Œä¸»èŠ‚ç‚¹åªä¼šåœ¨ä»èŠ‚ç‚¹å¤§äºç­‰äº min-slaves-to-write çš„å€¼ï¼Œå¹¶ä¸”è¿™äº›ä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹æœ€åä¸€æ¬¡æˆåŠŸé€šä¿¡çš„æ—¶é—´é—´éš”ä¸è¶…è¿‡ min-slaves-max-lag çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œå†™å‘½ä»¤ã€‚</p><p>ä½¿ç”¨æ­¤é…ç½®ï¼Œä¸Šä¾‹ä¸­çš„æ—§ Redis ä¸»èŠ‚ç‚¹ M1 å°†åœ¨ 10 ç§’åå˜å¾—ä¸å¯ç”¨ã€‚å½“åˆ†åŒºæ¢å¤åï¼ŒSentinel é…ç½®å°†æ±‡èšåˆ°æ–°é…ç½®ï¼Œå®¢æˆ·ç«¯ C1 å°†èƒ½å¤Ÿè·å–æœ‰æ•ˆé…ç½®å¹¶ç»§ç»­ä½¿ç”¨æ–°çš„ masterã€‚ä½†æ˜¯è¿™æ ·ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸¤ä¸ªä»èŠ‚ç‚¹éƒ½å®•æœºäº†ï¼Œmaster å°†åœæ­¢æ¥å—å†™å…¥ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦æƒè¡¡åˆ©å¼Šçš„ç‚¹ã€‚</p><h3 id="example-3-å®¢æˆ·ç«¯ä¸­çš„-sentinel" tabindex="-1"><a class="header-anchor" href="#example-3-å®¢æˆ·ç«¯ä¸­çš„-sentinel" aria-hidden="true">#</a> Example 3:å®¢æˆ·ç«¯ä¸­çš„ Sentinel</h3><p>æœ‰æ—¶æˆ‘ä»¬åªæœ‰ä¸¤ä¸ª Redis box å¯ç”¨ï¼Œä¸€ä¸ªç”¨äº masterï¼Œä¸€ä¸ªç”¨äº replicaã€‚ç¤ºä¾‹ 2 ä¸­çš„é…ç½®åœ¨è¿™ç§æƒ…å†µä¸‹ä¸å¯è¡Œï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ±‚åŠ©äºä»¥ä¸‹å†…å®¹ï¼Œå°† Sentinels æ”¾ç½®åœ¨å®¢æˆ·ç«¯æ‰€åœ¨çš„ä½ç½®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>            +----+         +----+
            | M1 |----+----| R1 |
            |    |    |    |    |
            +----+    |    +----+
                      |
         +------------+------------+
         |            |            |
         |            |            |
      +----+        +----+      +----+
      | C1 |        | C2 |      | C3 |
      | S1 |        | S2 |      | S3 |
      +----+        +----+      +----+

      Configuration: quorum = 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¿è¡Œ M1 å’Œ S1 çš„æœºå™¨å‘ç”Ÿæ•…éšœï¼Œæ•…éšœè½¬ç§»å°†æ¯«æ— é—®é¢˜åœ°å‘ç”Ÿï¼Œä½†æ˜¯å¾ˆå®¹æ˜“çœ‹å‡ºä¸åŒçš„ç½‘ç»œåˆ†åŒºä¼šå¯¼è‡´ä¸åŒçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å’Œ Redis æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œæ–­å¼€è¿æ¥ï¼Œåˆ™ Sentinel å°†æ— æ³•è®¾ç½®ï¼Œå› ä¸º Redis ä¸»æœåŠ¡å™¨å’Œå‰¯æœ¬æœåŠ¡å™¨éƒ½å°†ä¸å¯ç”¨ã€‚</p><p>è¯·æ³¨æ„ï¼Œå¦‚æœ C3 ä¸ M1 åˆ†åŒºï¼ˆè™½ç„¶åœ¨ä¸Šè¿°æè¿°çš„ç½‘ç»œä¸­å¾ˆéš¾å‘ç”Ÿï¼Œä½†åœ¨ä¸åŒå¸ƒå±€æˆ–è½¯ä»¶å±‚é¢æ•…éšœçš„æƒ…å†µä¸‹å¯èƒ½æ›´å®¹æ˜“å‘ç”Ÿï¼‰ï¼Œæˆ‘ä»¬å°†é‡åˆ°ç±»ä¼¼äºç¤ºä¾‹ 2 ä¸­æ‰€æè¿°çš„é—®é¢˜ï¼Œä¸åŒä¹‹å¤„åœ¨äºè¿™é‡Œæ²¡æœ‰åŠæ³•æ‰“ç ´å¯¹ç§°æ€§ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ï¼Œæ‰€ä»¥å½“ä¸»èŠ‚ç‚¹ä¸å…¶ä»èŠ‚ç‚¹æ–­å¼€è¿æ¥æ—¶ï¼Œä¸»æœºæ— æ³•åœæ­¢æ¥å—æŸ¥è¯¢ï¼Œå¦åˆ™ä¸»æœºå°†æ°¸è¿œæ— æ³•åœ¨å‰¯æœ¬å‡ºç°æ•…éšœæ—¶å¯ç”¨ã€‚</p><h3 id="example-4-å°‘äº-3-ä¸ªå®¢æˆ·ç«¯çš„-sentinel-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#example-4-å°‘äº-3-ä¸ªå®¢æˆ·ç«¯çš„-sentinel-å®¢æˆ·ç«¯" aria-hidden="true">#</a> Example 4: å°‘äº 3 ä¸ªå®¢æˆ·ç«¯çš„ Sentinel å®¢æˆ·ç«¯</h3><p>å¦‚æœå®¢æˆ·ç«¯ä¸­çš„æ¡†å°‘äºä¸‰ä¸ªï¼ˆä¾‹å¦‚ä¸‰ä¸ª Web æœåŠ¡å™¨ï¼‰ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç¤ºä¾‹ 3 ä¸­æè¿°çš„è®¾ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨å¦‚ä¸‹æ··åˆè®¾ç½®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>            +----+         +----+
            | M1 |----+----| R1 |
            | S1 |    |    | S2 |
            +----+    |    +----+
                      |
               +------+-----+
               |            |
               |            |
            +----+        +----+
            | C1 |        | C2 |
            | S3 |        | S4 |
            +----+        +----+

      Configuration: quorum = 3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç±»ä¼¼äºç¤ºä¾‹ 3 ä¸­çš„è®¾ç½®ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬åœ¨å¯ç”¨çš„å››ä¸ªæ¡†ä¸­è¿è¡Œå››ä¸ª Sentinelã€‚å¦‚æœä¸» M1 å˜å¾—ä¸å¯ç”¨ï¼Œå…¶ä»–ä¸‰ä¸ª Sentinels å°†æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚</p><p>ä»ç†è®ºä¸Šè®²ï¼Œæ­¤è®¾ç½®å¯ä»¥åˆ é™¤è¿è¡Œ C2 å’Œ S4 çš„æ¡†ï¼Œå¹¶å°† quorum è®¾ç½®ä¸º 2ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå±‚æ²¡æœ‰é«˜å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¸å¤ªå¯èƒ½å¸Œæœ› Redis ç«¯å…·æœ‰é«˜å¯ç”¨æ€§ã€‚</p><h3 id="éƒ¨ç½²-sentinel-æ³¨æ„çš„åœ°æ–¹" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-sentinel-æ³¨æ„çš„åœ°æ–¹" aria-hidden="true">#</a> éƒ¨ç½² Sentinel æ³¨æ„çš„åœ°æ–¹</h3><p>å‰é¢å®˜ç½‘çš„ 4 ä¸ªæ¡ˆä¾‹ï¼Œéƒ½æ˜¯æŠŠ Sentinel èŠ‚ç‚¹å’Œ Redis æ•°æ®èŠ‚ç‚¹æˆ–è€…å®¢æˆ·ç«¯æ”¾åœ¨ä¸€èµ·ã€‚</p><p>æˆ‘è§‰å¾—åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥<strong>å°† Sentinel å’Œè¢«ç›‘è§†çš„ Redis æœåŠ¡å™¨æ”¾åˆ°ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å„ä¸ª Sentinel ä¹Ÿåº”è¯¥æ”¾åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œï¼Œè¿™æ ·æ•´ä¸ªç³»ç»Ÿæ‰èƒ½å¤Ÿæ›´å‡†ç¡®ã€æœ‰æ•ˆçš„åˆ¤æ–­å‡ºæœåŠ¡å™¨çš„å®é™…çŠ¶æ€</strong>ã€‚</p><ul><li>Sentinel èŠ‚ç‚¹åº”è¯¥éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼›</li><li><strong>è‡³å°‘éœ€è¦ 3 ä¸ª Sentinel å®ä¾‹æ‰èƒ½è¿›è¡Œå¯é çš„éƒ¨ç½²ï¼Œå°½é‡å¥‡æ•°ä¸ª Sentinel èŠ‚ç‚¹</strong>ï¼›</li><li>å› ä¸º Redis ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œæ‰€ä»¥ Redis Sentinel åˆ†å¸ƒå¼ç³»ç»Ÿ<strong>ä¸èƒ½ä¿è¯åœ¨æ•…éšœæœŸé—´çš„å†™å…¥å‘½ä»¤åŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´å¯èƒ½æœ‰ä¸¢æ•°æ®çš„é£é™©</strong>ï¼›</li><li>å®¢æˆ·ç«¯éœ€è¦æ”¯æŒ Sentinelã€‚ä¾‹å¦‚ Jedis å°±æ”¯æŒ Sentinelï¼›</li><li>Sentinelã€Dockeræˆ–å…¶ä»–å½¢å¼çš„ç½‘ç»œåœ°å€è½¬æ¢æˆ–ç«¯å£æ˜ å°„åº”å°å¿ƒæ··åˆï¼šDocker æ‰§è¡Œç«¯å£é‡æ–°æ˜ å°„æ—¶ï¼Œæ‰“ç ´Sentinel å¯¹å…¶ä»– Sentinel è¿›ç¨‹çš„è‡ªåŠ¨å‘ç°å’Œä»èŠ‚ç‚¹åˆ—è¡¨ï¼›</li></ul><h2 id="å®é™…éƒ¨ç½²æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…éƒ¨ç½²æ¡ˆä¾‹" aria-hidden="true">#</a> å®é™…éƒ¨ç½²æ¡ˆä¾‹</h2><p>æœ¬åœ°éƒ¨ç½²çš„ Redis ç‰ˆæœ¬ 6.2.6ã€‚</p><p>æˆ‘è¦éƒ¨ç½²ä¸€ä¸»ä¸¤ä»ï¼Œä¸‰ä¸ª Sentinel èŠ‚ç‚¹ç»„æˆçš„é›†åˆã€‚</p><img src="/assets/Redis-Sentinelå®é™…éƒ¨ç½²æ¡ˆä¾‹-f6a2a47f.png" alt="Redis Sentinelå®é™…éƒ¨ç½²æ¡ˆä¾‹" style="zoom:67%;"><h3 id="éƒ¨ç½²-redis-æ•°æ®èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-redis-æ•°æ®èŠ‚ç‚¹" aria-hidden="true">#</a> éƒ¨ç½² Redis æ•°æ®èŠ‚ç‚¹</h3><p>é…ç½®æ–‡ä»¶ redis-6379.confï¼Œå…¶å®ƒä¸¤ä¸ªæ”¹ä¸‹ç«¯å£å·å’Œæ–‡ä»¶åå°±è¡Œ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>port 6379
daemonize yes
# å·¥ä½œç›®å½• dir çš„ç›¸å¯¹è·¯å¾„
logfile &quot;./redis-6379.log&quot;
dbfilename dump-6379.rdb
dir &quot;../data/redis-sentinel-demo&quot;
# å¯†ç 
requirepass master123
masterauth master123
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éƒ¨ç½²ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./redis-server <span class="token punctuation">..</span>/conf/redis-sentinel-demo/redis-6379.conf
./redis-server <span class="token punctuation">..</span>/conf/redis-sentinel-demo/redis-6380.conf
./redis-server <span class="token punctuation">..</span>/conf/redis-sentinel-demo/redis-6381.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸»èŠ‚ç‚¹ä½¿ç”¨ info replication å‘½ä»¤ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; info replication
# Replication
role:master
connected_slaves:2
slave0:ip=127.0.0.1,port=6380,state=online,offset=98,lag=1
slave1:ip=127.0.0.1,port=6381,state=online,offset=98,lag=1
master_failover_state:no-failover
master_replid:1444b8ce1c3f903232525ecd278f0145080b1950
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:98
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:98
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ° master æœ‰ä¸¤ä¸ªä»èŠ‚ç‚¹äº†</p><h3 id="éƒ¨ç½²-sentinel-èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-sentinel-èŠ‚ç‚¹" aria-hidden="true">#</a> éƒ¨ç½² Sentinel èŠ‚ç‚¹</h3><p>é…ç½®æ–‡ä»¶ redis-sentinel-26379.confï¼Œå…¶å®ƒä¸¤ä¸ªæ”¹ä¸‹ç«¯å£å·å’Œæ–‡ä»¶åå°±è¡Œ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>port 26379
daemonize yes
logfile &quot;./sentinel-26379.log&quot;
dir &quot;../data/redis-sentinel-demo&quot;
sentinel monitor demomaster 127.0.0.1 6379 2
sentinel down-after-milliseconds demomaster 30000
sentinel parallel-syncs demomaster 1
sentinel failover-timeout demomaster 180000

# è®¾ç½®è¿æ¥ redis æ•°æ®èŠ‚ç‚¹çš„å¯†ç 
sentinel auth-pass demomaster master123
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éƒ¨ç½²ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./redis-sentinel ../conf/redis-sentinel-demo/redis-sentinel-26379.conf
./redis-sentinel ../conf/redis-sentinel-demo/redis-sentinel-26380.conf
./redis-sentinel ../conf/redis-sentinel-demo/redis-sentinel-26381.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ 26379 ç«¯å£çš„ Sentinel ä¸Šä½¿ç”¨ info sentinel å‘½ä»¤</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:26379&gt; info sentinel
# Sentinel
sentinel_masters:1
sentinel_tilt:0
sentinel_running_scripts:0
sentinel_scripts_queue_length:0
sentinel_simulate_failure_flags:0
master0:name=demomaster,status=ok,address=127.0.0.1:6379,slaves=2,sentinels=3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°æœ€åä¸€è¡Œçš„ä¿¡æ¯ï¼Œç›‘æ§äº†åå­—ä¸º demomaster çš„ä¸»èŠ‚ç‚¹ï¼Œæœ‰ 2 ä¸ªä»èŠ‚ç‚¹ï¼Œæ€»å…±æœ‰ 3 ä¸ª Sentinel ä¸€èµ·ç›‘æ§è¿™ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><h3 id="æ—¥å¿—åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åˆ†æ" aria-hidden="true">#</a> æ—¥å¿—åˆ†æ</h3><p>Redis ä¸»ä»å¤åˆ¶çš„æ—¥å¿—å‰é¢çš„æ–‡ç« åˆ†æè¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†åˆ†æäº†ã€‚</p><p>è¿™é‡Œåˆ†æç«¯å£ 26379 çš„ Sentinel çš„å¯åŠ¨æ—¥å¿—ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>75469:X 04 Apr 2023 16:34:21.827 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
75469:X 04 Apr 2023 16:34:21.827 # Redis version=6.2.11, bits=64, commit=720ea82e, modified=0, pid=75469, just started
75469:X 04 Apr 2023 16:34:21.827 # Configuration loaded
75469:X 04 Apr 2023 16:34:21.829 * Increased maximum number of open files to 10032 (it was originally set to 256).
75469:X 04 Apr 2023 16:34:21.829 * monotonic clock: POSIX clock_gettime
75469:X 04 Apr 2023 16:34:21.833 * Running mode=sentinel, port=26379.
75469:X 04 Apr 2023 16:34:21.835 # Sentinel ID is 12a27d10e3f1bdf445ae30dd1f4aba1af78234f6
75469:X 04 Apr 2023 16:34:21.835 # +monitor master demomaster 127.0.0.1 6379 quorum 2
75469:X 04 Apr 2023 16:34:21.838 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ demomaster 127.0.0.1 6379
75469:X 04 Apr 2023 16:34:21.838 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ demomaster 127.0.0.1 6379
75469:X 04 Apr 2023 16:34:23.868 * +sentinel sentinel 2b044ab85b5b93b8553baf65f8a40970ff4fbb9e 127.0.0.1 26381 @ demomaster 127.0.0.1 6379
75469:X 04 Apr 2023 16:34:23.871 * +sentinel sentinel 70668315c96c8bfb74520e4982f8378dcd564dfe 127.0.0.1 26380 @ demomaster 127.0.0.1 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‰æ­¥éª¤åˆ†æï¼š</p><p>ï¼ˆ1ï¼‰å½“ç«¯å£ 26379 çš„ Sentinel å¯åŠ¨åï¼Œä¼šæ‰“å°ä¸‹é¢çš„æ—¥å¿—ï¼Œè¡¨ç¤ºå½“å‰ç›‘å¬ä¸€ä¸ªåå­—ä¸º demomaster çš„ä¸»èŠ‚ç‚¹ã€‚è¿™æ˜¯ä¸€ä¸ª Sentinel äº‹ä»¶ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±è®¢é˜…åœ¨ Pub/Sub æ¶ˆæ¯éƒ¨åˆ†æŒ‡å®šçš„äº‹ä»¶åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Pub/Sub æ¥æ”¶æ­¤ç±»äº‹ä»¶ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>75469:X 04 Apr 2023 16:34:21.835 # +monitor master demomaster 127.0.0.1 6379 quorum 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ï¼ˆ2ï¼‰ç›‘å¬åˆ°äº†ä¸»èŠ‚ç‚¹æœ‰ä¸¤ä¸ªä»èŠ‚ç‚¹ï¼›</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>75469:X 04 Apr 2023 16:34:21.838 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ demomaster 127.0.0.1 6379
75469:X 04 Apr 2023 16:34:21.838 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ demomaster 127.0.0.1 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ3ï¼‰ç›‘å¬åˆ°äº†æœ‰å¦å¤–ä¸¤ä¸ª Sentinel ä¹Ÿåœ¨ç›‘è§†åŒä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼›</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>75469:X 04 Apr 2023 16:34:23.868 * +sentinel sentinel 2b044ab85b5b93b8553baf65f8a40970ff4fbb9e 127.0.0.1 26381 @ demomaster 127.0.0.1 6379
75469:X 04 Apr 2023 16:34:23.871 * +sentinel sentinel 70668315c96c8bfb74520e4982f8378dcd564dfe 127.0.0.1 26380 @ demomaster 127.0.0.1 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sentinel-api" tabindex="-1"><a class="header-anchor" href="#sentinel-api" aria-hidden="true">#</a> Sentinel API</h2><p>Sentinel æä¾› API ä»¥æ£€æŸ¥å…¶çŠ¶æ€ã€æ£€æŸ¥å—ç›‘æ§çš„ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µã€è®¢é˜…ä»¥æ¥æ”¶ç‰¹å®šé€šçŸ¥ä»¥åŠåœ¨è¿è¡Œæ—¶æ›´æ”¹ Sentinel é…ç½®ã€‚</p><h3 id="sentinel-ç®¡ç†å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#sentinel-ç®¡ç†å‘½ä»¤" aria-hidden="true">#</a> Sentinel ç®¡ç†å‘½ä»¤</h3><blockquote><p>è¯¦ç»†çš„è¯·çœ‹å®˜ç½‘ https://redis.io/docs/management/sentinel/#sentinel-api</p></blockquote><ul><li><p><strong>SENTINEL CKQUORUM <code>&lt;master name&gt;</code></strong> ï¼šæ£€æŸ¥å¯ç”¨çš„ Sentinel æ•°é‡</p><p>æ£€æŸ¥ Sentinel ç³»ç»Ÿä¸­å½“å‰å¯ç”¨çš„ Sentinel æ•°é‡æ˜¯å¦è¾¾åˆ°äº†åˆ¤æ–­ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿å¹¶å®æ–½æ•…éšœè½¬ç§»æ‰€éœ€çš„æ•°é‡ã€‚è¯¥å‘½ä»¤åº”ç”¨äºç›‘æ§ç³»ç»Ÿï¼Œä»¥æ£€æŸ¥ Sentinel éƒ¨ç½²æ˜¯å¦æ­£å¸¸ï¼›</p></li><li><p><strong>SENTINEL FLUSHCONFIG</strong>ï¼šå¼ºåˆ¶å†™å…¥é…ç½®æ–‡ä»¶</p><p>å°† Sentinel çš„é…ç½®æ–‡ä»¶é‡æ–°å†™å…¥ç£ç›˜ä¸­ã€‚å› ä¸º Sentinel åœ¨è¢«ç›‘è§†èŠ‚ç‚¹çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨é‡å†™é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨å°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ç”±äºæŸäº›åŸå› æˆ–è€…é”™è¯¯ä¸¢å¤±æ—¶ï¼Œç«‹å³ç”Ÿæˆä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œå½“ Sentinel çš„é…ç½®é€‰é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒSentinel å†…éƒ¨ä¹Ÿä¼šä½¿ç”¨è¿™ä¸ªå‘½ä»¤åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶æ¥æ›¿ä»£åŸæœ‰çš„é…ç½®æ–‡ä»¶ï¼›</p><p>åªæœ‰æ¥æ”¶åˆ°è¯¥å‘½ä»¤çš„ Sentinel æ‰ä¼šé‡å†™é…ç½®æ–‡ä»¶ï¼ŒSentinel é›†åˆä¸­çš„å…¶å®ƒ Sentinel å¹¶ä¸ä¼šå—åˆ°è¿™ä¸ªå‘½ä»¤çš„å½±å“ï¼›</p></li><li><p><strong>SENTINEL FAILOVER <code>&lt;master name&gt;</code></strong> ï¼šå¼ºåˆ¶æ‰§è¡Œæ•…éšœè½¬ç§»</p><p>æ¥æ”¶åˆ°è¿™ä¸ªå‘½ä»¤çš„ Sentinel å¼ºåˆ¶å¯¹æŒ‡å®šçš„ä¸»èŠ‚ç‚¹å®æ–½æ•…éšœè½¬ç§»ï¼Œæ— éœ€é€‰ä¸¾å‡ºä¸€ä¸ª Sentinel è¿›è¡Œæ•…éšœè½¬ç§»ï¼›</p></li><li><p><strong>SENTINEL GET-MASTER-ADDR-BY-NAME <code>&lt;master name&gt;</code></strong>ï¼šè·å–ç»™å®šä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£å·ï¼›</p><p>å¦‚æœ Sentinel æ­£åœ¨å¯¹ç»™å®šçš„ä¸»èŠ‚ç‚¹æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œæˆ–è€…åŸæœ¬çš„ä¸»èŠ‚ç‚¹å·²ç»å› ä¸ºæ•…éšœè½¬ç§»è€Œè¢«æ–°çš„ä¸»èŠ‚ç‚¹æ›¿æ¢æ‰äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘½ä»¤å°†ä¼šè¿”å›æ–°èŠ‚ç‚¹çš„ IP å’Œç«¯å£å·ï¼›</p></li><li><p><strong>SENTINEL INFO-CACHE</strong> (<code>&gt;= 3.2</code>) Return cached <a href="https://redis.io/commands/info" target="_blank" rel="noopener noreferrer"><code>INFO</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> output from masters and replicas.</p></li><li><p><strong>SENTINEL IS-MASTER-DOWN-BY-ADDR</strong>ï¼šä»å½“å‰ Sentinel çš„è§’åº¦æ£€æŸ¥ ip å’Œ port æŒ‡å®šçš„ä¸»æœºæ˜¯å¦å·²å…³é—­ã€‚æ­¤å‘½ä»¤ä¸»è¦ä¾›å†…éƒ¨ä½¿ç”¨ï¼›</p></li><li><p><strong>SENTINEL MASTER <code>&lt;master name&gt;</code></strong> ï¼šè·å–è¢«ç›‘è§†çš„ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ï¼›</p></li><li><p><strong>SENTINEL MASTERS</strong>ï¼šè·å–æ‰€æœ‰è¢«ç›‘è§†çš„ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ï¼›</p></li><li><p><strong>SENTINEL MYID</strong> (<code>&gt;= 6.2</code>) Return the ID of the Sentinel instance.</p></li><li><p><strong>SENTINEL PENDING-SCRIPTS</strong> This command returns information about pending scripts.</p></li><li><p><strong>SENTINEL REPLICAS <code>&lt;master name&gt;</code></strong> (<code>&gt;= 5.0</code>) æˆ–è€… <strong>SENTINEL SLAVES <code>&lt;master name&gt;</code></strong></p><p>è·å–è¢«ç›‘è§†ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹çš„ä¿¡æ¯</p></li><li><p><strong>SENTINEL SENTINELS <code>&lt;master name&gt;</code></strong> è·å–å…¶ä»– Sentinel çš„ç›¸å…³ä¿¡æ¯ï¼›</p></li><li><p><strong>SENTINEL SIMULATE-FAILURE (crash-after-election|crash-after-promotion|help)</strong> (<code>&gt;= 3.2</code>)ï¼šè¯¥å‘½ä»¤æ¨¡æ‹Ÿä¸åŒçš„Sentinelå´©æºƒåœºæ™¯ã€‚</p></li><li><p><strong>SENTINEL RESET <code>&lt;pattern&gt;</code></strong> é‡ç½®ä¸»èŠ‚ç‚¹çš„çŠ¶æ€</p><p>æ¥å—ä¸€ä¸ª glob é£æ ¼çš„æ¨¡å¼ä½œä¸ºå‚æ•°ï¼Œæ¥æ”¶åˆ°è¯¥å‘½ä»¤çš„ Sentinel å°†é‡ç½®æ‰€æœ‰ä¸ç»™å®šæ¨¡å¼ç›¸åŒ¹é…çš„ä¸»èŠ‚ç‚¹ã€‚</p><p>å‘½ä»¤å°†è¿”å›è¢«é‡ç½®çš„ä¸»èŠ‚ç‚¹çš„æ•°é‡ï¼›</p><p>æ¥æ”¶åˆ°è¯¥å‘½ä»¤çš„ Sentinel é™¤äº†ä¼šæ¸…ç†è¢«åŒ¹é…çš„ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜ä¼šé—å¿˜è¢«åŒ¹é…ä¸»èŠ‚ç‚¹ç›®å‰å·²æœ‰çš„æ‰€æœ‰ä»èŠ‚ç‚¹ï¼Œä»¥åŠæ­£åœ¨ç›‘è§†è¢«åŒ¹é…ä¸»èŠ‚ç‚¹çš„æ‰€æœ‰å…¶ä»– Sentinel èŠ‚ç‚¹ã€‚åœ¨æ­¤ä¹‹åï¼Œè¿™ä¸ª Sentinel å°†ä¼šé‡æ–°æœç´¢æ­£åœ¨ç›‘è§†è¢«åŒ¹é…ä¸»èŠ‚ç‚¹çš„å…¶ä»– Sentinelï¼Œä»¥åŠè¯¥èŠ‚ç‚¹ä¸‹çš„å„ä¸ªä»èŠ‚ç‚¹ï¼Œå¹¶ä¸å®ƒä»¬é‡æ–°å»ºç«‹è¿æ¥ï¼›</p></li></ul><h4 id="å…³äº-sentinel-master-çš„è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#å…³äº-sentinel-master-çš„è¿”å›å€¼" aria-hidden="true">#</a> å…³äº Sentinel master çš„è¿”å›å€¼</h4><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>name</td><td>æœåŠ¡å™¨çš„åç§°</td></tr><tr><td>ip</td><td>æœåŠ¡å™¨çš„ ip</td></tr><tr><td>port</td><td>æœåŠ¡å™¨çš„ç«¯å£</td></tr><tr><td>runid</td><td>æœåŠ¡å™¨çš„è¿è¡Œ ID</td></tr><tr><td>flags</td><td>æœåŠ¡å™¨çš„è§’è‰²å’ŒçŠ¶æ€</td></tr><tr><td>link-pending-commands</td><td>Sentinel å‘æœåŠ¡å™¨å‘é€äº†å‘½ä»¤ä¹‹åï¼Œä»ç„¶åœ¨ç­‰å¾…å›å¤çš„å‘½ä»¤æ•°é‡</td></tr><tr><td>link-refcount</td><td>Redis å®ä¾‹æ‹¥æœ‰è€…æ•°é‡ï¼Œç”¨äºå†…éƒ¨å®ç°</td></tr><tr><td>last-ping-sent</td><td>è·ç¦» Sentinel æœ€åä¸€æ¬¡å‘æœåŠ¡å™¨å‘é€çš„ PING ä¹‹åè¿‡çš„æ¯«ç§’æ•°</td></tr><tr><td>last-ok-ping-reply</td><td>æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘ Sentinel è¿”å›æœ‰æ•ˆ PING çš„å›å¤ä¹‹åè¿‡çš„æ¯«ç§’æ•°</td></tr><tr><td>last-ping-reply</td><td>æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘ Sentinel è¿”å› PING çš„å›å¤ä¹‹åè¿‡çš„æ¯«ç§’æ•°</td></tr><tr><td>down-after-milliseconds</td><td>Sentinel çš„ down-after-milliseconds é…ç½®é¡¹çš„å€¼</td></tr><tr><td>info-refresh</td><td>æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘ Sentinel è¿”å› INFO å‘½ä»¤å›å¤ä¹‹åè¿‡çš„æ¯«ç§’æ•°</td></tr><tr><td>role-reported</td><td>æœåŠ¡å™¨å‘ Sentinel æ±‡æŠ¥å®ƒè‡ªèº«çš„è§’è‰²</td></tr><tr><td>role-reported-time</td><td>æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘ Sentinel æ±‡æŠ¥å®ƒè‡ªèº«çš„è§’è‰²ä¹‹åè¿‡çš„æ¯«ç§’æ•°</td></tr><tr><td>config-epoch</td><td>å½“å‰ Sentienl ç½‘ç»œæ‰€å¤„çš„é…ç½®çºªå…ƒï¼Œç”¨äºå®ç°æŠ•ç¥¨æœºåˆ¶</td></tr><tr><td>num-slaves</td><td>ä¸»èŠ‚ç‚¹ä¸‹é¢çš„ä»èŠ‚ç‚¹æ•°é‡</td></tr><tr><td>num-other-sentinels</td><td>å…¶ä»–æ­£åœ¨ç›‘è§†è¿™ä¸€å°æœåŠ¡å™¨çš„ Sentinel çš„æ•°é‡</td></tr><tr><td>quorum</td><td>åˆ¤æ–­æœåŠ¡å™¨ä¸‹çº¿æ‰€éœ€è¦çš„ Sentinel çš„æ•°é‡</td></tr><tr><td>failover-timeout</td><td>Sentinel çš„ failover-time é…ç½®é€‰é¡¹çš„å€¼</td></tr><tr><td>parallel-syncs</td><td>Sentinel çš„ parallel-syncs é…ç½®é€‰é¡¹çš„å€¼</td></tr></tbody></table><h4 id="å…³äº-sentinel-slaves-è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#å…³äº-sentinel-slaves-è¿”å›å€¼" aria-hidden="true">#</a> å…³äº Sentinel slaves è¿”å›å€¼</h4><p>å¤§éƒ¨åˆ†å­—æ®µçš„åç§°å’Œå«ä¹‰ï¼Œå’Œ Sentinel master çš„è¿”å›å€¼ä¸€æ ·</p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>master-link-down-time</td><td>ä¸»ä»èŠ‚ç‚¹è¿æ¥æ–­å¼€çš„æ—¶é—´ï¼Œæ¯«ç§’</td></tr><tr><td>master-link-status</td><td>ä¸»ä»èŠ‚ç‚¹çš„è¿æ¥çŠ¶æ€</td></tr><tr><td>master-host</td><td>ä¸»èŠ‚ç‚¹çš„åœ°å€</td></tr><tr><td>master-port</td><td>ä¸»èŠ‚ç‚¹çš„ç«¯å£å·</td></tr><tr><td>slave-priority</td><td>ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§</td></tr><tr><td>slave-repl-offset</td><td>ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡</td></tr></tbody></table><h4 id="å…³äº-sentinel-sentinel-çš„è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#å…³äº-sentinel-sentinel-çš„è¿”å›å€¼" aria-hidden="true">#</a> å…³äº Sentinel sentinel çš„è¿”å›å€¼</h4><p>å¤§éƒ¨åˆ†å­—æ®µçš„åç§°å’Œå«ä¹‰ï¼Œå’Œ Sentinel master çš„è¿”å›å€¼ä¸€æ ·</p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>last-hello-message</td><td>è·ç¦»å½“å‰ Sentinel æœ€åä¸€æ¬¡ä»è¿™ä¸ª Sentinel æ”¶åˆ° HELLO æ¶ˆæ¯åè¿‡çš„æ¯«ç§’æ•°</td></tr><tr><td>voted-leader</td><td>Sentinel ç½‘ç»œå½“å‰é€‰ä¸¾å‡ºæ¥çš„ Sentinel é¢†å¯¼è€…ï¼Œ ï¼Ÿè¡¨ç¤ºå½“å‰æ²¡æœ‰é¢†å¯¼è€…</td></tr><tr><td>voted-leader-epoch</td><td>Sentinel é¢†å¯¼è€…å½“å‰æ‰€å¤„çš„é…ç½®çºªå…ƒ</td></tr></tbody></table><h3 id="åœ¨çº¿ä¿®æ”¹-sentinel-é…ç½®é¡¹" tabindex="-1"><a class="header-anchor" href="#åœ¨çº¿ä¿®æ”¹-sentinel-é…ç½®é¡¹" aria-hidden="true">#</a> åœ¨çº¿ä¿®æ”¹ Sentinel é…ç½®é¡¹</h3><p>åœ¨ Redis 2.8.4 ä¹‹å‰ï¼ŒRedis Sentinel åªèƒ½é€šè¿‡åŠ è½½é…ç½®æ–‡ä»¶çš„æ–¹å¼æ¥ä¿®æ”¹é…ç½®é¡¹ã€‚</p><p>ä» Redis 2.8.4 å¼€å§‹ï¼ŒSentinel æä¾›äº†ä¸€ç»„å­å‘½ä»¤ï¼Œè¿™äº›å­å‘½ä»¤å¯ä»¥åœ¨çº¿çš„ä¿®æ”¹ Sentinel å¯¹äºè¢«ç›‘è§†ä¸»èŠ‚ç‚¹çš„é…ç½®é€‰é¡¹ï¼Œå¹¶æŠŠä¿®æ”¹åçš„é…ç½®é€‰é¡¹ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦åœæ­¢ Sentinelï¼Œä¹Ÿä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p><strong>å¦‚æœæœ‰å¤šä¸ª Sentinelï¼Œåˆ™åº”å°†æ›´æ”¹åº”ç”¨äºæ‰€æœ‰ Sentinel å®ä¾‹ï¼Œè¿™æ„å‘³ç€æ›´æ”¹å•ä¸ª Sentinel çš„é…ç½®ä¸ä¼šè‡ªåŠ¨å°†æ›´æ”¹ä¼ æ’­åˆ°ç½‘ç»œä¸­çš„å…¶ä»– Sentinelã€‚</strong></p><p>ä»¥ä¸‹æ˜¯ç”¨äºæ›´æ–° Sentinel å®ä¾‹é…ç½®çš„ SENTINEL å­å‘½ä»¤åˆ—è¡¨ã€‚</p><ul><li><p><strong>SENTINEL MONITOR <code>&lt;name&gt;</code> <code>&lt;ip&gt;</code> <code>&lt;port&gt;</code> <code>&lt;quorum&gt;</code></strong> ï¼šç›‘è§†ç»™çš„ä¸»èŠ‚ç‚¹</p><p>å½“æƒ³è¦ Sentinel ç›‘è§†ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä½†æ˜¯åˆä¸æƒ³é‡å¯ Sentin å¹¶æ‰‹åŠ¨ä¿®æ”¹ Sentinel é…ç½®æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼›ï¼ˆè¿™é‡Œæ˜¯æ·»åŠ ä¸€ä¸ªç›‘è§†ä¸»èŠ‚ç‚¹ï¼Œä¹‹å‰çš„é‚£ä¸ªä¸»èŠ‚ç‚¹è¿˜åœ¨ç›‘è§†ç€ï¼‰</p></li><li><p><strong>SENTINEL REMOVE <code>&lt;name&gt;</code></strong> ï¼šå–æ¶ˆå¯¹ç»™å®šä¸»èŠ‚ç‚¹çš„ç›‘è§†</p><p>æ¥æ”¶åˆ°è¿™ä¸ªå‘½ä»¤çš„ Sentinel ä¼šåœæ­¢å¯¹ç»™å®šä¸»èŠ‚ç‚¹çš„ç›‘è§†ï¼Œå¹¶åˆ é™¤ Sentinel å†…éƒ¨ä»¥åŠ Sentinel é…ç½®æ–‡ä»¶ä¸­ä¸ç»™å®šä¸»èŠ‚ç‚¹æœ‰å…³çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¹¶è¿”å› OK è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼›</p></li><li><p><strong>SENTINEL SET <code>&lt;name&gt;</code> [<code>&lt;option&gt;</code> <code>&lt;value&gt;</code> ...]</strong> ï¼šä¿®æ”¹ Sentinel é…ç½®é€‰é¡¹çš„å€¼</p><p>åªè¦æ˜¯ Sentinel é…ç½®æ–‡ä»¶ä¸­ä¸ä¸»èŠ‚ç‚¹æœ‰å…³çš„é…ç½®é¡¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¿›è¡Œåœ¨çº¿æ›´æ–°ã€‚å‘½ä»¤åœ¨æˆåŠŸä¿®æ”¹ç»™å®šçš„é…ç½®é¡¹ä¹‹åéƒ½ä¼šè¿”å› OKï¼›</p><p>ä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SENTINEL SET demomaster down-after-milliseconds 1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>ä» Redis 6.2 ç‰ˆæœ¬å¼€å§‹ï¼ŒSentinel è¿˜å…è®¸è·å–å’Œè®¾ç½®å…¨å±€é…ç½®å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨ä¹‹å‰ä»…æ”¯æŒé…ç½®æ–‡ä»¶é…ç½®ã€‚</p><ul><li><strong>SENTINEL CONFIG GET <code>&lt;name&gt;</code></strong> (<code>&gt;= 6.2</code>) Get the current value of a global Sentinel configuration parameter. The specified name may be a wildcard, similar to the Redis <a href="https://redis.io/commands/config-get" target="_blank" rel="noopener noreferrer"><code>CONFIG GET</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> command.</li><li><strong>SENTINEL CONFIG SET <code>&lt;name&gt;</code> <code>&lt;value&gt;</code></strong> (<code>&gt;= 6.2</code>) Set the value of a global Sentinel configuration parameter.</li></ul><p>Global parameters that can be manipulated include:</p><ul><li><code>resolve-hostnames</code>, <code>announce-hostnames</code>. See <a href="https://redis.io/docs/management/sentinel/#ip-addresses-and-dns-names" target="_blank" rel="noopener noreferrer"><em>IP addresses and DNS names</em><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><code>announce-ip</code>, <code>announce-port</code>. See <a href="https://redis.io/docs/management/sentinel/#sentinel-docker-nat-and-possible-issues" target="_blank" rel="noopener noreferrer"><em>Sentinel, Docker, NAT, and possible issues</em><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><code>sentinel-user</code>, <code>sentinel-pass</code>. See <a href="https://redis.io/docs/management/sentinel/#configuring-sentinel-instances-with-authentication" target="_blank" rel="noopener noreferrer"><em>Configuring Sentinel instances with authentication</em><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li></ul><h3 id="æ·»åŠ æˆ–åˆ é™¤-sentinel" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ æˆ–åˆ é™¤-sentinel" aria-hidden="true">#</a> æ·»åŠ æˆ–åˆ é™¤ Sentinel</h3><p>ç”±äº Sentinel çš„è‡ªåŠ¨å‘ç°æœºåˆ¶ï¼Œä»…éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¦ç›‘è§†çš„ä¸»èŠ‚ç‚¹å¹¶å¯åŠ¨ Sentinelï¼Œåœ¨ 10 ç§’å†…ï¼ŒSentinel å°†è·å–å…¶ä»– Sentinel çš„é›†åˆå’Œé‚£äº›ä»èŠ‚ç‚¹ã€‚ä¸åˆ° 10 ç§’æ˜¯å› ä¸º Sentinel ä¸­ä¼šæœ‰ä¸€äº›å®šæ—¶ä»»åŠ¡å»è·å–ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œåé¢ä¼šè®²ã€‚</p><p>å¦‚æœ<strong>éœ€è¦ä¸€æ¬¡æ·»åŠ å¤šä¸ª Sentinelï¼Œå»ºè®®ä¸€ä¸ªæ¥ä¸€ä¸ªæ·»åŠ ï¼Œç­‰å¾…æ‰€æœ‰å…¶ä»– Sentinel éƒ½çŸ¥é“æ–°åŠ äº†ä¸€ä¸ª Sentinel ä¹‹åå†æ·»åŠ ä¸‹ä¸€ä¸ª</strong>ã€‚åœ¨å‘ä¸€ä¸ªåˆ†åŒºæ·»åŠ æ–°çš„ Sentinel æ—¶ï¼Œå¦‚æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‡ºç°äº†æ•…éšœï¼Œå°±å¯ä»¥ç¡®ä¿æ–°çš„ Sentinel åªä¼šè¢«åŠ å…¥åˆ°ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œè€Œä¸æ˜¯è¢«å¹³å‡åœ°åˆ†é…åˆ°å¤šä¸ªåˆ†åŒºã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿åœ¨æ¯ä¸ªåˆ†åŒºä¸­ä»ç„¶å­˜åœ¨å¤§å¤šæ•°çš„ Sentinel èŠ‚ç‚¹ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯é æ€§ã€‚</p><p>åœ¨å‘ä¸€ä¸ªåˆ†åŒºæ·»åŠ æ–°çš„ Sentinel æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªæ–° Sentinel çš„æ·»åŠ é—´éš”è®¾ç½®ä¸º30ç§’ï¼Œå¹¶ä¸”åªåœ¨æ²¡æœ‰ç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹è¿›è¡Œæ·»åŠ ã€‚è¿™æ ·åšå¯ä»¥ç®€å•åœ°å®ç°ç¡®ä¿æ¯ä¸ª Sentinel èŠ‚ç‚¹åªè¢«æ·»åŠ åˆ°ä¸€ä¸ªåˆ†åŒºä¸­çš„ç›®çš„ã€‚å½“æ•´ä¸ªæ·»åŠ è¿‡ç¨‹å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>SENTINEL MASTER mastername</code> æ¥æ£€æŸ¥æ‰€æœ‰ Sentinel èŠ‚ç‚¹æ˜¯å¦éƒ½åŒæ„ç›‘è§†è¯¥ä¸»èŠ‚ç‚¹çš„Sentinel æ€»æ•°ã€‚</p><p>ç§»é™¤ä¸€ä¸ª Sentinel èŠ‚ç‚¹æ¯”è¾ƒå¤æ‚ï¼šå³ä½¿æŸä¸ª Sentinel èŠ‚ç‚¹é•¿æ—¶é—´ä¸å¯ç”¨ï¼Œå…¶ä»– Sentinel èŠ‚ç‚¹ä¹Ÿä¸ä¼šå¿˜è®°å®ƒï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³åŠ¨æ€åœ°æ”¹å˜æˆæƒæ•…éšœè½¬ç§»å’Œåˆ›å»ºæ–°çš„é…ç½®ç¼–å·æ‰€éœ€çš„å¤§å¤šæ•°ã€‚å› æ­¤ï¼Œåœ¨æ²¡æœ‰ç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ‰èƒ½ç§»é™¤ä¸€ä¸ª Sentinel èŠ‚ç‚¹ï¼š</p><ol><li><strong>åœæ­¢è¦ç§»é™¤çš„ Sentinel èŠ‚ç‚¹è¿›ç¨‹</strong>ï¼›</li><li>å‘æ‰€æœ‰å…¶ä»– Sentinel èŠ‚ç‚¹å‘é€ <code>SENTINEL RESET *</code>å‘½ä»¤ï¼Œä»¥é‡ç½®å®ƒä»¬æ‰€è§åˆ°çš„å·²çŸ¥ Sentinel èŠ‚ç‚¹åˆ—è¡¨ï¼ˆå¦‚æœæ‚¨åªæƒ³é‡ç½®å•ä¸ªä¸»èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥ä¸»èŠ‚ç‚¹çš„åç§°ä»£æ›¿ *ï¼‰ã€‚ä¾æ¬¡å‘æ¯ä¸ª Sentinel èŠ‚ç‚¹å‘é€æ­¤å‘½ä»¤ï¼Œç­‰å¾…è‡³å°‘ 30 ç§’åå†å‘ä¸‹ä¸€ä¸ª Sentinel èŠ‚ç‚¹å‘é€ï¼›</li><li>ç¡®ä¿æ¯ä¸ª Sentinel èŠ‚ç‚¹éƒ½åŒæ„å½“å‰æ´»åŠ¨ Sentinel èŠ‚ç‚¹çš„æ•°é‡ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥æ¯ä¸ª Sentinel èŠ‚ç‚¹çš„<code>SENTINEL MASTER mastername</code>è¾“å‡ºæ¥å®Œæˆï¼›</li></ol><h3 id="ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹" aria-hidden="true">#</a> ç§»é™¤æ—§çš„ä¸»èŠ‚ç‚¹æˆ–è€…ä¸å¯è¾¾çš„ä»èŠ‚ç‚¹</h3><p><strong>åœ¨ Redis Sentinel ä¸­ï¼ŒSentinel ä¼šè¿½è¸ªä¸»èŠ‚ç‚¹çš„æ‰€æœ‰ä»èŠ‚ç‚¹ï¼Œå³ä½¿å®ƒä»¬é•¿æ—¶é—´æ— æ³•åˆ°è¾¾ï¼Œä¹Ÿä¼šè®°ä½å®ƒä»¬ã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºåœ¨ç½‘ç»œåˆ†åŒºæˆ–å‡ºç°æ•…éšœåï¼ŒSentinel åº”è¯¥èƒ½å¤Ÿæ­£ç¡®åœ°é‡æ–°é…ç½®æ¢å¤çš„ä»èŠ‚ç‚¹ã€‚</strong></p><p>æ­¤å¤–ï¼Œåœ¨è¿›è¡Œæ•…éšœè½¬ç§»åï¼Œè¢«æ›¿æ¢çš„ä¸»èŠ‚ç‚¹å®é™…ä¸Šä¼šè¢«æ·»åŠ å›æ–°ä¸»èŠ‚ç‚¹ä½œä¸ºå®ƒçš„ä»èŠ‚ç‚¹ï¼Œä»¥ä¾¿åœ¨æ–°ä¸»èŠ‚ç‚¹å†æ¬¡å¯ç”¨æ—¶å¯ä»¥é‡æ–°é…ç½®ã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦æ°¸ä¹…åœ°ä» Sentinel ç›‘è§†çš„ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­åˆ é™¤ä¸€ä¸ªä»èŠ‚ç‚¹ï¼ˆå¯èƒ½æ˜¯æ—§çš„ä¸»èŠ‚ç‚¹ï¼‰ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œ<strong>éœ€è¦å‘æ‰€æœ‰ Sentinel å‘é€ <code>SENTINEL RESET mastername</code> å‘½ä»¤ï¼Œè¿™å°†åˆ·æ–° Sentinel ä¸­çš„ä»èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¹¶ä»…æ·»åŠ å½“å‰ä¸»èŠ‚ç‚¹ INFO è¾“å‡ºä¸­åˆ—å‡ºçš„æ­£ç¡®å¤åˆ¶çš„ä»èŠ‚ç‚¹</strong>ã€‚</p><h3 id="pub-sub-messages" tabindex="-1"><a class="header-anchor" href="#pub-sub-messages" aria-hidden="true">#</a> Pub/Sub messages</h3><p>å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ Sentinel ä½œä¸º Redis å…¼å®¹çš„ Pub/Sub æœåŠ¡å™¨ï¼ˆä½†ä¸èƒ½ä½¿ç”¨ PUBLISHï¼‰ï¼Œä»¥ SUBSCRIBE æˆ– PSUBSCRIBE åˆ°é€šé“ï¼Œå¹¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ¥æ”¶é€šçŸ¥ã€‚</p><p><strong>é€šé“åç§°ä¸äº‹ä»¶åç§°ç›¸åŒã€‚ä¾‹å¦‚ï¼Œåä¸º +sdown çš„é€šé“å°†æ¥æ”¶æœ‰å…³è¿›å…¥ SDOWN çŠ¶æ€çš„å®ä¾‹çš„æ‰€æœ‰é€šçŸ¥ï¼ˆSDOWN è¡¨ç¤ºè¯¥å®ä¾‹ä»æ‚¨æŸ¥è¯¢çš„ Sentinel è§†è§’ä¸å†å¯è¾¾ï¼‰ã€‚</strong></p><p><strong>è¦è·å–æ‰€æœ‰æ¶ˆæ¯ï¼Œè¯·ä½¿ç”¨ PSUBSCRIBE * è¿›è¡Œè®¢é˜…ã€‚</strong></p><p>ä¸‹é¢æ˜¯é€šè¿‡æ­¤ API å¯ä»¥æ¥æ”¶çš„é€šé“å’Œæ¶ˆæ¯æ ¼å¼åˆ—è¡¨ã€‚ç¬¬ä¸€ä¸ªå•è¯æ˜¯é€šé“ / äº‹ä»¶åç§°ï¼Œå…¶ä½™éƒ¨åˆ†æ˜¯æ•°æ®æ ¼å¼ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœæŒ‡å®šäº†å®ä¾‹è¯¦ç»†ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºæä¾›ä»¥ä¸‹å‚æ•°ä»¥æ ‡è¯†ç›®æ ‡å®ä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;instance-type&gt; &lt;name&gt; &lt;ip&gt; &lt;port&gt; @ &lt;master-name&gt; &lt;master-ip&gt; &lt;master-port&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä» @ å‚æ•°åˆ°ç»“å°¾çš„æ ‡è¯†ä¸»èŠ‚ç‚¹çš„éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”ä»…åœ¨å®ä¾‹æœ¬èº«ä¸æ˜¯ä¸»èŠ‚ç‚¹æ—¶æ‰ä¼šæŒ‡å®šã€‚</p><p><img src="/assets/Redis-Sentinelè®¢é˜…é€šçŸ¥çš„é€šé“çš„å«ä¹‰-db01f142.png" alt="Redis Sentinel è®¢é˜…é€šçŸ¥çš„é€šé“çš„å«ä¹‰"></p><blockquote><p>å…·ä½“çš„çœ‹å®˜ç½‘çš„ https://redis.io/docs/management/sentinel/#pubsub-messages</p></blockquote><h2 id="sentinel-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#sentinel-å®¢æˆ·ç«¯" aria-hidden="true">#</a> Sentinel å®¢æˆ·ç«¯</h2><h3 id="sentinel-å®¢æˆ·ç«¯å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#sentinel-å®¢æˆ·ç«¯å®ç°åŸç†" aria-hidden="true">#</a> Sentinel å®¢æˆ·ç«¯å®ç°åŸç†</h3><p>å„ä¸ªè¯­è¨€éœ€è¦æ˜¾ç¤ºæ”¯æŒ Redis Sentinelã€‚ Redis Sentinel æ‰§è¡Œäº†æ•…éšœè½¬ç§»æ“ä½œï¼Œ å®¢æˆ·ç«¯éœ€è¦çŸ¥é“æœ€æ–°çš„ä¸»èŠ‚ç‚¹çš„åœ°å€æ˜¯å¤šå°‘ã€‚</p><p>å®ç°ä¸€ä¸ª Redis Sentinel å®¢æˆ·ç«¯çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>éå† Sentinel èŠ‚ç‚¹é›†åˆè·å–ä¸€ä¸ªå¯ç”¨çš„ Sentinel èŠ‚ç‚¹ï¼ŒSentinel èŠ‚ç‚¹ä¹‹åå¯ä»¥å…±äº«æ•°æ®ï¼Œæ‰€ä»¥ä»ä»»æ„ä¸€ä¸ª Sentinel èŠ‚ç‚¹è·å–ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯éƒ½æ˜¯å¯ä»¥çš„ï¼›</li><li>é€šè¿‡ SENTINEL GET-MASTER-ADDR-BY-NAME master-nameï¼Œè·å–å¯¹åº”çš„ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼›</li><li>éªŒè¯å½“å‰è·å–çš„â€œä¸»èŠ‚ç‚¹â€æ˜¯å¦æ˜¯çœŸæ­£çš„ä¸»èŠ‚ç‚¹ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ•…éšœè½¬ç§»æœŸé—´çš„ä¸»èŠ‚ç‚¹çš„å˜åŒ–ï¼›</li><li>ä¿æŒå’Œ Sentinel èŠ‚ç‚¹é›†åˆçš„â€œè”ç³»â€ï¼Œæ—¶åˆ»è·å–å…³äºä¸»èŠ‚ç‚¹çš„ç›¸å…³â€œä¿¡æ¯â€ï¼›</li></ol><img src="/assets/Redis-Sentinelå®¢æˆ·ç«¯è®¾è®¡æ€è·¯-72f1fd10.png" alt="Redis Sentinel å®¢æˆ·ç«¯è®¾è®¡æ€è·¯" style="zoom:67%;"><p>ä»ä¸Šé¢çš„æ¨¡å‹å¯ä»¥çœ‹å‡ºï¼ŒRedis Sentinel å®¢æˆ·ç«¯åªæœ‰åœ¨åˆå§‹åŒ–å’Œåˆ‡æ¢ä¸»èŠ‚ç‚¹æ—¶éœ€è¦å’Œ Sentinel èŠ‚ç‚¹é›†åˆè¿›è¡Œäº¤äº’è·å–ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨è®¾è®¡å®¢æˆ·ç«¯æ—¶éœ€è¦å°† Sentinel èŠ‚ç‚¹è€ƒè™‘æˆé…ç½®å‘ç°æœåŠ¡ï¼›</p><h3 id="jedis-çš„-jedissentinelpool-åŸç†" tabindex="-1"><a class="header-anchor" href="#jedis-çš„-jedissentinelpool-åŸç†" aria-hidden="true">#</a> Jedis çš„ JedisSentinelPool åŸç†</h3><p>JedisSentinelPool æ˜¯ Jedis è¿æ¥ Redis Sentinel çš„ä¸€ä¸ªå®ç°ã€‚</p><p>æœ¬æ¬¡åˆ†æçš„æºç æ˜¯ jedis-4.3.0</p><p><strong>ï¼ˆ1ï¼‰é¦–å…ˆçœ‹ JedisSentinelPool çš„æ„é€ æ–¹æ³•</strong></p><p>å…¶ä¸­ masterName è¡¨ç¤º Sentinel ç›‘è§†çš„ä¸»èŠ‚ç‚¹çš„åç§°ï¼Œsentinels æ˜¯ Sentinel å®ä¾‹çš„é›†åˆã€‚</p><ul><li>é¦–å…ˆä¼šè°ƒç”¨ initSentinels æ–¹æ³•è·å–ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£ï¼›</li><li>æ‹¿åˆ°ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£åè°ƒç”¨ initMaster æ–¹æ³•èµ‹å€¼ç»™ä¸€äº›å­—æ®µï¼›</li></ul><p>å½“ç„¶ initSentinels æ–¹æ³•ä¸ä»…ä»…æ˜¯è·å–ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£é‚£ä¹ˆç®€å•ï¼Œè¿˜åšäº†å…¶ä»–æ“ä½œï¼Œæ¥ç€çœ‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *
 * <span class="token keyword">@param</span> <span class="token parameter">masterName</span> ä¸»èŠ‚ç‚¹åç§°
 * <span class="token keyword">@param</span> <span class="token parameter">sentinels</span> Sentinel èŠ‚ç‚¹çš„é›†åˆ
 * <span class="token keyword">@param</span> <span class="token parameter">poolConfig</span> è¿æ¥æ± é…ç½®
 * <span class="token keyword">@param</span> <span class="token parameter">factory</span> ä¸»èŠ‚ç‚¹çš„é…ç½®
 * <span class="token keyword">@param</span> <span class="token parameter">sentinelClientConfig</span> Sentinel å®¢æˆ·ç«¯é…ç½®
 */</span>
<span class="token keyword">public</span> <span class="token class-name">JedisSentinelPool</span><span class="token punctuation">(</span><span class="token class-name">String</span> masterName<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span> sentinels<span class="token punctuation">,</span>
                         <span class="token keyword">final</span> <span class="token class-name">GenericObjectPoolConfig</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Jedis</span><span class="token punctuation">&gt;</span></span> poolConfig<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">JedisFactory</span> factory<span class="token punctuation">,</span>
                         <span class="token keyword">final</span> <span class="token class-name">JedisClientConfig</span> sentinelClientConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>poolConfig<span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>factory <span class="token operator">=</span> factory<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sentinelClientConfig <span class="token operator">=</span> sentinelClientConfig<span class="token punctuation">;</span>

    <span class="token comment">// éå† Sentinel èŠ‚ç‚¹é›†åˆï¼Œè·å–å½“å‰ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£</span>
    <span class="token comment">// å¼€å¯å¤šä¸ªçº¿ç¨‹ç›‘å¬æ¯ä¸ª Sentinel çš„ Pub/Sub çš„ +switch-master äº‹ä»¶</span>
    <span class="token comment">// å½“å‡ºç°æ•…éšœè½¬ç§»æ—¶ï¼Œä¼šæ›´æ–°æœ€æ–°çš„ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£</span>
    <span class="token class-name">HostAndPort</span> master <span class="token operator">=</span> <span class="token function">initSentinels</span><span class="token punctuation">(</span>sentinels<span class="token punctuation">,</span> masterName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆå§‹åŒ–ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£</span>
    <span class="token function">initMaster</span><span class="token punctuation">(</span>master<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ2ï¼‰initSentinels æ–¹æ³• â€” éå† Sentinel é›†åˆè·å–ä¸»èŠ‚ç‚¹ IP å’Œç«¯å£</strong></p><p>è¿™éƒ¨åˆ†ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯éå† Sentinel é›†åˆï¼Œè°ƒç”¨ GET-MASTER-ADDR-BY-NAME å‘½ä»¤è·å–ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£ï¼Œåªè¦è·å–åˆ°äº†å°±é€€å‡ºå¾ªç¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
   * åˆå§‹åŒ– Sentinel
   *
   * <span class="token keyword">@param</span> <span class="token parameter">sentinels</span> Sentinel é›†åˆ
   * <span class="token keyword">@param</span> <span class="token parameter">masterName</span> ä¸»èŠ‚ç‚¹åç§°
   * <span class="token keyword">@return</span> è¿”å›ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£
   */</span>
<span class="token keyword">private</span> <span class="token class-name">HostAndPort</span> <span class="token function">initSentinels</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span> sentinels<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> masterName<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£</span>
    <span class="token class-name">HostAndPort</span> master <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> sentinelAvailable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Trying to find master from available Sentinels...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// éå†æ‰€æœ‰çš„ Sentinel å®ä¾‹</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HostAndPort</span> sentinel <span class="token operator">:</span> sentinels<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Connecting to Sentinel {}&quot;</span><span class="token punctuation">,</span> sentinel<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–ä¸€ä¸ªè¿æ¥</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span>sentinel<span class="token punctuation">,</span> sentinelClientConfig<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// é€šè¿‡ GET-MASTER-ADDR-BY-NAME å‘½ä»¤è·å–ç»™å®šä¸»èŠ‚ç‚¹çš„åç§°çš„ IP åœ°å€å’Œç«¯å£å·</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> masterAddr <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">sentinelGetMasterAddrByName</span><span class="token punctuation">(</span>masterName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// connected to sentinel...</span>
            sentinelAvailable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>masterAddr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> masterAddr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// GET-MASTER-ADDR-BY-NAME å‘½ä»¤æ­£å¸¸è¿”å›çš„æ˜¯ 2 ä¸ªå…ƒç´ ï¼Œå‡å¦‚ä¸æ˜¯å°±è¯´æ˜ä¸æ­£å¸¸ï¼Œé‡è¯•</span>
                <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Can not get master addr, master name: {}. Sentinel: {}&quot;</span><span class="token punctuation">,</span> masterName<span class="token punctuation">,</span> sentinel<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// è§£æç«¯å£å·å’Œ IPï¼Œè§£ææˆåŠŸå°±é€€å‡ºå¾ªç¯</span>
            master <span class="token operator">=</span> <span class="token function">toHostAndPort</span><span class="token punctuation">(</span>masterAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Found Redis master at {}&quot;</span><span class="token punctuation">,</span> master<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JedisException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// resolves #1036, it should handle JedisException there&#39;s another chance</span>
            <span class="token comment">// of raising JedisDataException</span>
            <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Cannot get master address from sentinel running @ {}. Reason: {}. Trying next one.&quot;</span><span class="token punctuation">,</span> sentinel<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¦‚æœä»ä¸Šé¢çš„ Sentinel é›†åˆä¸­è¿˜æ˜¯æ²¡æœ‰è·å–åˆ°ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>master <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sentinelAvailable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// can connect to sentinel, but master name seems to not monitored</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">JedisException</span><span class="token punctuation">(</span><span class="token string">&quot;Can connect to sentinel, but &quot;</span> <span class="token operator">+</span> masterName
                                     <span class="token operator">+</span> <span class="token string">&quot; seems to be not monitored...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">JedisConnectionException</span><span class="token punctuation">(</span><span class="token string">&quot;All sentinels down, cannot determine where is &quot;</span>
                                               <span class="token operator">+</span> masterName <span class="token operator">+</span> <span class="token string">&quot; master is running...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ......</span>
    <span class="token comment">// çœç•¥äº†ç›‘å¬ä»£ç ï¼Œä¸‹é¢å†åˆ†æ</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ3ï¼‰initSentinels æ–¹æ³• â€” å¼€å¯ç›‘å¬çº¿ç¨‹ç›‘å¬ä¸»èŠ‚ç‚¹åœ°å€å˜åŒ–</strong></p><p>è¿™é‡Œå°±æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ª Sentinel å®ä¾‹éƒ½å¼€å¯äº†ä¸€ä¸ª MasterListener çº¿ç¨‹å»ç›‘å¬ä¸»èŠ‚ç‚¹çš„å˜åŒ–ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">HostAndPort</span> <span class="token function">initSentinels</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span> sentinels<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> masterName<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£</span>
    <span class="token class-name">HostAndPort</span> master <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> sentinelAvailable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Trying to find master from available Sentinels...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ......</span>
    <span class="token comment">// çœç•¥äº†è·å–ä¸»èŠ‚ç‚¹ IP å’Œç«¯å£çš„ä»£ç </span>
    <span class="token comment">// å‰é¢å·²ç»åˆ†æäº†</span>
    <span class="token comment">// ......</span>

    <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Redis master running at {}, starting Sentinel listeners...&quot;</span><span class="token punctuation">,</span> master<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å†æ¬¡éå† Sentinel é›†åˆï¼Œåˆ›å»ºç›‘å¬çº¿ç¨‹å¹¶å¯åŠ¨</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HostAndPort</span> sentinel <span class="token operator">:</span> sentinels<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// MasterListener ç»§æ‰¿äº† Thread</span>
        <span class="token class-name">MasterListener</span> masterListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MasterListener</span><span class="token punctuation">(</span>masterName<span class="token punctuation">,</span> sentinel<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sentinel<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// whether MasterListener threads are alive or not, process can be stopped</span>
        masterListener<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        masterListeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>masterListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        masterListener<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> master<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ4ï¼‰MasterListener#run æ–¹æ³•</strong></p><p>å› ä¸º MasterListener æ˜¯ Thread å­ç±»ï¼Œä¸»è¦è§‚å¯Ÿå®ƒçš„ run æ–¹æ³•å³å¯ã€‚è¯¥æ–¹æ³•ä¸»è¦æ˜¯ä½¿ç”¨ Pub/Sub è®¢é˜…äº† <code>+switch-master</code> é€šé“ï¼Œå½“ä¸»èŠ‚ç‚¹çš„åœ°å€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šç»™è®¢é˜…äº†è¿™ä¸ªé€šé“çš„å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ã€‚å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>demomaster 127.0.0.1 6379 127.0.0.1 6380
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>ä½ç½® 1ï¼šä¸»èŠ‚ç‚¹çš„åç§°ï¼›</li><li>ä½ç½® 2 å’Œ 3ï¼šæ—§çš„ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£ï¼›</li><li>ä½ç½® 4 å’Œ 5ï¼šæ–°çš„ä¸»èŠ‚ç‚¹çš„ IP å’Œç«¯å£ï¼›</li></ul><p>æ¥ä¸‹æ¥çœ‹ MasterListener#run æ–¹æ³•çš„ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    running<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// double check that it is not being shutdown</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>running<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// è·å–è¿æ¥åˆ° Sentinel å®ä¾‹çš„è¿æ¥</span>
            <span class="token keyword">final</span> <span class="token class-name">HostAndPort</span> hostPort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
            j <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span>hostPort<span class="token punctuation">,</span> sentinelClientConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// code for active refresh</span>
            <span class="token comment">// è·å–ä¸»èŠ‚ç‚¹çš„åœ°å€ GET-MASTER-ADDR-BY-NAME</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> masterAddr <span class="token operator">=</span> j<span class="token punctuation">.</span><span class="token function">sentinelGetMasterAddrByName</span><span class="token punctuation">(</span>masterName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>masterAddr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> masterAddr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Can not get master addr, master name: {}. Sentinel: {}.&quot;</span><span class="token punctuation">,</span> masterName<span class="token punctuation">,</span>
                         hostPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">initMaster</span><span class="token punctuation">(</span><span class="token function">toHostAndPort</span><span class="token punctuation">(</span>masterAddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// ç›‘å¬ +switch-master é€šé“</span>
            <span class="token comment">// +switch-master demomaster 127.0.0.1 6379 127.0.0.1 6380</span>
            j<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JedisPubSub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> channel<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Sentinel {} published: {}.&quot;</span><span class="token punctuation">,</span> hostPort<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> switchMasterMsg <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>switchMasterMsg<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                        <span class="token comment">// æ ¡éªŒä¸»èŠ‚ç‚¹çš„åç§°</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>masterName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>switchMasterMsg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// åˆå§‹åŒ–æ–°çš„ä¸»èŠ‚ç‚¹çš„åœ°å€</span>
                            <span class="token function">initMaster</span><span class="token punctuation">(</span><span class="token function">toHostAndPort</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>switchMasterMsg<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> switchMasterMsg<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;Ignoring message on +switch-master for master name {}, our master name is {}&quot;</span><span class="token punctuation">,</span>
                                switchMasterMsg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> masterName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid message received on Sentinel {} on channel +switch-master: {}&quot;</span><span class="token punctuation">,</span>
                                  hostPort<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;+switch-master&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JedisException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// çœç•¥......</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ²¡åˆ°ç›‘å¬åˆ°ä¸»èŠ‚ç‚¹çš„åœ°å€å‘ç”Ÿå˜åŒ–åï¼Œå°±ä¼šè°ƒç”¨ initMaster æ–¹æ³•å»æ›´æ–°ä¸€äº›å­—æ®µã€‚</p><h2 id="sentinel-å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#sentinel-å®ç°åŸç†" aria-hidden="true">#</a> Sentinel å®ç°åŸç†</h2><h3 id="å®šæ—¶ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#å®šæ—¶ä»»åŠ¡" aria-hidden="true">#</a> å®šæ—¶ä»»åŠ¡</h3><p>Sentinel åœ¨å†…éƒ¨æœ‰3ä¸ªå®šæ—¶ä»»åŠ¡å®Œæˆå¯¹å„ä¸ªèŠ‚ç‚¹å‘ç°å’Œç›‘æ§ï¼š</p><ol><li><strong>æ¯ 10 ç§’æ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€ info å‘½ä»¤</strong>ï¼Œè¿™ä¸ªä»»åŠ¡è¾¾åˆ°ä¸¤ä¸ªç›®çš„ï¼š <ol><li><strong>å‘ç°ä»èŠ‚ç‚¹</strong>ï¼›ï¼ˆè¿™ä¹Ÿæ˜¯ Sentinel èŠ‚ç‚¹ä¸éœ€è¦æ˜¾ç¤ºé…ç½®ç›‘æ§ä»èŠ‚ç‚¹çš„åŸå› ï¼‰</li><li><strong>å½“æœ‰æ–°çš„ä»èŠ‚ç‚¹åŠ å…¥æ—¶å„ä¸ª Sentinel å¯ä»¥æ„ŸçŸ¥</strong>ï¼›</li><li><strong>å½“èŠ‚ç‚¹ä¸å¯è¾¾æˆ–è€…æ•…éšœè½¬ç§»åï¼Œå¯ä»¥é€šè¿‡ info å‘½ä»¤å®æ—¶æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯</strong>ï¼›</li></ol></li><li>æ­¤åŠŸèƒ½æ˜¯é€šè¿‡å°† HELLO æ¶ˆæ¯å‘é€åˆ°åä¸º<code> __sentinel__:hello</code> çš„é€šé“æ¥å®ç°çš„ã€‚<strong>æ¯ 2 ç§’</strong>æ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ <strong>Redis æ•°æ®èŠ‚ç‚¹</strong>ï¼ˆä¸»ä»ï¼‰çš„<code> __sentinel__:hello</code> é€šé“ä¸Šï¼ˆpub/subï¼‰<strong>å‘é€å½“å‰ Sentinel å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ä»¥åŠå½“å‰ Sentinel èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚åŒæ—¶æ¯ä¸ª Sentinel èŠ‚ç‚¹ä¹Ÿä¼šè®¢é˜…è¿™ä¸ªé€šé“ï¼Œè¿›è¡Œä¿¡æ¯äº¤æ¢</strong>ï¼ˆå¯¹èŠ‚ç‚¹çš„&quot;çœ‹æ³•&quot;å’Œè‡ªèº«çš„ä¿¡æ¯ï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªå®šæ—¶ä»»åŠ¡çš„ä½œç”¨æ˜¯ï¼š <ol><li><strong>å‘ç°æ–°çš„ Sentinel èŠ‚ç‚¹</strong>ï¼Œé€šè¿‡è®¢é˜…æ•°æ®èŠ‚ç‚¹çš„<code> __sentinel__:hello</code>é€šé“äº†è§£å…¶å®ƒçš„ Sentinel èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚æœæ˜¯æ–°åŠ å…¥çš„ Sentinel èŠ‚ç‚¹ï¼Œå°†è¿™ä¸ª Sentinel èŠ‚ç‚¹ä¿å­˜èµ·æ¥ï¼Œå¹¶ä¸è¿™ä¸ª Sentinel èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼›</li><li>S<strong>entinel èŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¸»èŠ‚ç‚¹çš„çŠ¶æ€</strong>ï¼Œä½œä¸ºåé¢å®¢è§‚ä¸‹çº¿ä»¥åŠé¢†å¯¼è€…é€‰ä¸¾çš„ä¾æ®ï¼›</li><li><strong>Hello æ¶ˆæ¯è¿˜åŒ…æ‹¬ä¸»èŠ‚ç‚¹å½“å‰å®Œæ•´çš„é…ç½®</strong>ã€‚å¦‚æœæ¥æ”¶ Sentinel çš„ç»™å®šä¸»èŠ‚ç‚¹çš„é…ç½®æ¯”æ”¶åˆ°çš„è¦æ—§ï¼Œå®ƒä¼šç«‹å³æ›´æ–°ä¸ºæ–°é…ç½®ï¼›</li></ol></li><li>æ¯ 1 ç§’æ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ã€å…¶å®ƒ Sentinel èŠ‚ç‚¹å‘é€ä¸€æ¡ PING å‘½ä»¤æ¥åšä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼Œæ¥ç¡®è®¤è¿™äº›èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ã€‚è¿™æ˜¯ Sentinel åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿çš„æ¡ä»¶ã€‚</li></ol><img src="/assets/Redis-Sentinelçš„ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡-9b225d5c.png" alt="Redis Sentinel çš„ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡" style="zoom:67%;"><h3 id="ä¸»è§‚ä¸‹çº¿-sdown" tabindex="-1"><a class="header-anchor" href="#ä¸»è§‚ä¸‹çº¿-sdown" aria-hidden="true">#</a> ä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰</h3><p>ä¸»è§‚ä¸‹çº¿ï¼ˆSubjectively Downï¼Œ ç®€ç§° SDOWNï¼‰æŒ‡çš„æ˜¯å•ä¸ªSentinelå®ä¾‹å¯¹æœåŠ¡å™¨åšå‡ºçš„ä¸‹çº¿åˆ¤æ–­ï¼Œå³<strong>å•ä¸ªsentinelè®¤ä¸ºæŸä¸ªæœåŠ¡ä¸‹çº¿ï¼ˆæœ‰å¯èƒ½æ˜¯æ¥æ”¶ä¸åˆ°è®¢é˜…ï¼Œä¹‹é—´çš„ç½‘ç»œä¸é€šç­‰ç­‰åŸå› ï¼‰</strong>ã€‚</p><p><strong>Sentinel ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘æ‰€æœ‰ä¸å…¶å»ºç«‹äº†è¿æ¥çš„å®ä¾‹ï¼ˆä¸»ä»èŠ‚ç‚¹å’Œå…¶ä»–sentinelï¼‰å‘é€ PING å‘½ä»¤ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨ down-after-milliseconds ç»™å®šçš„æ¯«ç§’æ•°ä¹‹å†…ï¼Œ æ²¡æœ‰è¿”å› Sentinel å‘é€çš„ PING å‘½ä»¤çš„å›å¤ï¼Œ æˆ–è€…è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œ é‚£ä¹ˆ Sentinel å°†è¿™ä¸ªæœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWN ï¼‰</strong>ã€‚</p><p>Sentinel é…ç½®æ–‡ä»¶ä¸­çš„ down-after-milliseconds è®¾ç½®äº†åˆ¤æ–­ä¸»è§‚ä¸‹çº¿çš„æ—¶é—´é™åˆ¶ï¼Œå¦‚æœå®ä¾‹åœ¨ down-after-milliseconds æ¯«ç§’å†…ï¼Œè¿”å›çš„å“åº”éƒ½æ˜¯æ— æ•ˆå›å¤ï¼Œé‚£ä¹ˆ Sentinel ä¼šè®¤ä¸ºè¯¥å®ä¾‹å·²ï¼ˆä¸»è§‚ï¼‰ä¸‹çº¿ï¼Œä¿®æ”¹å…¶ flags çŠ¶æ€ä¸º SRI_S_DOWNã€‚å¦‚æœå¤šä¸ª Sentinel ç›‘è§†ä¸€ä¸ªæœåŠ¡ï¼Œæœ‰å¯èƒ½å­˜åœ¨å¤šä¸ª Sentinel çš„ down-after-milliseconds é…ç½®ä¸åŒï¼Œè¿™ä¸ªåœ¨å®é™…ç”Ÿäº§ä¸­è¦æ³¨æ„ã€‚</p><p><strong>å¯¹äº PING çš„å¯èƒ½çš„å›å¤æœ‰ï¼š</strong></p><ul><li>PING replied with +PONG.</li><li>PING replied with -LOADING error.</li><li>PING replied with -MASTERDOWN error.</li></ul><p>ä»»ä½•å…¶ä»–å›å¤ï¼ˆæˆ–æ ¹æœ¬ä¸å›å¤ï¼‰å‡è¢«è§†ä¸ºæ— æ•ˆã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ªé€»è¾‘ä¸»èŠ‚ç‚¹åœ¨ INFO è¾“å‡ºä¸­æ ‡è¯†è‡ªå·±ä¸ºå‰¯æœ¬ï¼Œé‚£ä¹ˆå®ƒè¢«è®¤ä¸ºæ˜¯å¤„äºç¦»çº¿çŠ¶æ€ã€‚</p><img src="/assets/Redis-Sentinelä¸»è§‚ä¸‹çº¿-991b339b.png" alt="Redis Sentinel ä¸»è§‚ä¸‹çº¿" style="zoom:67%;"><h3 id="å®¢è§‚ä¸‹çº¿-odown" tabindex="-1"><a class="header-anchor" href="#å®¢è§‚ä¸‹çº¿-odown" aria-hidden="true">#</a> å®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰</h3><p>å®¢è§‚ä¸‹çº¿ï¼ˆObjectively Downï¼Œ ç®€ç§° ODOWNï¼‰æŒ‡çš„æ˜¯<strong>å¤šä¸ª Sentinel å®ä¾‹åœ¨å¯¹ä¸»èŠ‚ç‚¹åšå‡º SDOWN åˆ¤æ–­ï¼Œ å¹¶ä¸”é€šè¿‡ SENTINEL IS-MASTER-DOWN-BY-ADDR å‘å…¶ä»– Sentinel èŠ‚ç‚¹è¯¢é—®å…¶å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œ å½“è¶…è¿‡é…ç½®çš„ quorum ä¸ªæ•°çš„ Sentinel è®¤ä¸ºä¸»èŠ‚ç‚¹ä¸å¯è¾¾åï¼Œå°±è®¤ä¸»èŠ‚ç‚¹æ˜¯å®¢è§‚ä¸‹çº¿äº†ã€‚</strong></p><p>è¯·æ³¨æ„ï¼Œ**SDOWN çŠ¶æ€åªè¡¨ç¤ºä¸€ä¸ª Sentinel è®¤ä¸º Redis å®ä¾‹ä¸å¯ç”¨ï¼Œå¹¶ä¸è¶³ä»¥è§¦å‘æ•…éšœè½¬ç§»ã€‚åªæœ‰åˆ°è¾¾ ODOWN çŠ¶æ€æ‰èƒ½çœŸæ­£å¼€å§‹æ•…éšœè½¬ç§»ã€‚**SDOWN è¦æ±‚åœ¨é…ç½®çš„æ—¶é—´é—´éš”å†…æ²¡æœ‰æ”¶åˆ°å¯æ¥å—çš„å›å¤ï¼Œå› æ­¤ä¾‹å¦‚ï¼Œå¦‚æœæ—¶é—´é—´éš”ä¸º30000 æ¯«ç§’(30ç§’)ï¼Œè€Œæˆ‘ä»¬æ¯ 29 ç§’æ”¶åˆ°ä¸€ä¸ªå¯æ¥å—çš„ PING å“åº”ï¼Œé‚£ä¹ˆè¯¥å®ä¾‹è¢«è®¤ä¸ºæ˜¯å·¥ä½œæ­£å¸¸çš„ã€‚</p><p><strong>SENTINEL IS-MASTER-DOWN-BY-ADDR</strong> å‘½ä»¤</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SENTINEL IS-MASTER-DOWN-BY-ADDR  &lt;ip&gt; &lt;port&gt; &lt;current_epoch&gt; &lt;runid&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li>ipï¼šä¸»èŠ‚ç‚¹ ipï¼›</li><li>portï¼šä¸»èŠ‚ç‚¹ç«¯å£ï¼›</li><li>current_epochï¼šå½“å‰é…ç½®çºªå…ƒï¼›</li><li>runidï¼šä¸¤ç§ <ol><li>ç­‰äºæ˜Ÿå· *ï¼šè¡¨ç¤º Sentinel èŠ‚ç‚¹ç›´æ¥äº¤æ¢å¯¹ä¸»èŠ‚ç‚¹çš„ä¸‹çº¿çš„åˆ¤å®šã€‚</li><li>ç­‰äºå½“å‰ Sentinel èŠ‚ç‚¹çš„ runid æ—¶ï¼Œè¡¨ç¤ºå½“å‰ Sentinel èŠ‚ç‚¹å¸Œæœ›ç›®æ ‡èŠ‚ç‚¹åŒæ„è‡ªå·±ç§°ä¸ºæ•…éšœè½¬ç§»çš„é¢†å¯¼è€…ï¼›</li></ol></li></ol><p>ä¾‹å¦‚æŸä¸ª Sentinel å¯¹ä¸»èŠ‚ç‚¹åšä¸»è§‚ä¸‹çº¿åï¼Œä¼šå‘å…¶å®ƒ Sentinel èŠ‚ç‚¹å‘é€ä¸‹é¢çš„å‘½ä»¤</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SENTINEL IS-MASTER-DOWN-BY-ADDR 127.0.0.1 6379 0 *
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸€ä¸ª Sentinel æ¥æ”¶å¦ä¸€ä¸ª Sentinel å‘æ¥çš„ IS-MASTER-DOWN-BY-ADDR åï¼Œæ ¹æ® ip å’Œç«¯å£ï¼Œæ£€æµ‹å¯¹åº”çš„èŠ‚ç‚¹åœ¨è¯¥Sentinel æ˜¯å¦å¯è¾¾ï¼Œå¹¶ä¸”å›å¤ IS-MASTER-DOWN-BY-ADDRï¼Œè¿”å›å€¼æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p><ol><li>down_stateï¼šç›®æ ‡ Sentinel èŠ‚ç‚¹å¯¹äºä¸»èŠ‚ç‚¹çš„ä¸‹çº¿åˆ¤æ–­ï¼Œ1 æ˜¯ä¸‹çº¿ï¼Œ0 æ˜¯åœ¨çº¿ï¼›</li><li>leader_runidï¼šå½“ lead_runid ç­‰äºæ˜Ÿå· * æ—¶ï¼Œè¡¨ç¤ºè¿”å›ç»“æœæ˜¯ç”¨æ¥åšä¸»èŠ‚ç‚¹æ˜¯å¦å¯è¾¾çš„ã€‚å½“ leader_runid ç­‰äºå…·ä½“çš„ runid æ—¶ï¼Œè¡¨ç¤ºç›®æ ‡èŠ‚ç‚¹åŒæ„ runid ç§°ä¸ºæ•…éšœè½¬ç§»çš„é¢†å¯¼è€…ï¼›</li><li>leader_epochï¼šé¢†å¯¼è€…çºªå…ƒï¼›</li></ol><p>Sentinel æ¥æ”¶åˆ°å›å¤åï¼Œæ ¹æ®é…ç½®è®¾ç½®çš„ä¸‹çº¿æœ€å°æ•°é‡ï¼Œè¾¾åˆ°è¿™ä¸ªå€¼ï¼Œæ—¢è®¤ä¸ºè¯¥æœåŠ¡å®¢è§‚ä¸‹çº¿ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>ODOWN çŠ¶æ€ä»…é€‚ç”¨äºä¸»èŠ‚ç‚¹</strong>ã€‚å¯¹äºå…¶ä»–ç±»å‹çš„å®ä¾‹ï¼ŒSentinel ä¸éœ€è¦é‡‡å–æªæ–½ï¼Œ**å› æ­¤ä»èŠ‚ç‚¹å’Œå…¶ä»– Sentinel æ°¸è¿œä¸ä¼šè¾¾åˆ° ODOWN çŠ¶æ€ï¼Œåªä¼šå¤„äº SDOWN çŠ¶æ€ã€‚**ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼ŒSDOWN çŠ¶æ€è¿˜å…·æœ‰è¯­ä¹‰ä¸Šçš„å½±å“ã€‚ä¾‹å¦‚ï¼Œ<strong>å¤„äº SDOWN çŠ¶æ€çš„å‰¯ä»èŠ‚ç‚¹ä¼šè¢« Sentinel é€‰ä¸­è¿›è¡Œæ•…éšœè½¬ç§»ã€‚</strong></p><h3 id="é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„-sentinel" tabindex="-1"><a class="header-anchor" href="#é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„-sentinel" aria-hidden="true">#</a> é€‰ä¸¾æ‰§è¡Œæ•…éšœè½¬ç§»çš„ Sentinel</h3><p>å½“æ•´ä¸ª Sentinel ç³»ç»Ÿè®¤ä¸ºä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿åï¼Œéœ€è¦é€‰ä¸¾ä¸€ä¸ª Sentinel èŠ‚ç‚¹åšæ•…éšœè½¬ç§»æ“ä½œã€‚</p><p>Redis ä½¿ç”¨äº† Raft ç®—æ³•å®ç°é¢†å¯¼è€…é€‰ä¸¾ã€‚å®˜ç½‘ï¼šhttps://raft.github.io/ã€‚ç®€å•è¯´ä¸‹å¦‚ä½•é€‰ä¸¾å‡ºä¸€ä¸ª Sentinelã€‚</p><ul><li>æ¯ä¸ªåœ¨çº¿çš„ Sentinel èŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼ç§°ä¸ºé¢†å¯¼è€…ï¼Œ<strong>å½“æŸä¸ª Sentinel ç¡®è®¤ä¸»èŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿çš„æ—¶å€™ï¼Œä¼šå‘å…¶å®ƒ Sentinel èŠ‚ç‚¹å‘é€ SENTINEL IS-MASTER-DOWN-BY-ADDR å‘½ä»¤ï¼Œè¯·æ±‚å°†è‡ªå·±è®¾ç½®ä¸ºé¢†å¯¼è€…</strong>ï¼›</li><li>æ”¶åˆ°å‘½ä»¤çš„ Sentinel èŠ‚ç‚¹ï¼Œå¦‚æœ<strong>æ²¡æœ‰åŒæ„å…¶å®ƒçš„ Sentinel èŠ‚ç‚¹çš„ SENTINEL IS-MASTER-DOWN-BY-ADDR å‘½ä»¤ï¼Œå°±ä¼šåŒæ„è¿™ä¸ªè¯·æ±‚</strong>ï¼Œå¦åˆ™æ‹’ç»ï¼›</li><li>å¦‚æœè¯¥ Sentinel èŠ‚ç‚¹å‘ç°è‡ªå·±çš„ç¥¨æ•°å·²ç»å¤§äºç­‰äº <code>max(quorum, num(sentinels) / 2 + 1)</code>ï¼Œé‚£ä¹ˆå®ƒå°†æˆä¸ºé¢†å¯¼è€…ï¼›</li><li>å¦‚æœæ­¤æ¬¡æ²¡æœ‰é€‰å‡ºé¢†å¯¼è€…ï¼Œå°†è¿›å…¥ä¸‹ä¸€æ¬¡é€‰ä¸¾ï¼›</li></ul><img src="/assets/Redis-Sentinelé€‰ä¸¾é¢†å¯¼è€…-872a54e5.png" alt="Redis Sentinel é€‰ä¸¾é¢†å¯¼è€…" style="zoom:67%;"><h3 id="æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™" aria-hidden="true">#</a> æ–°çš„ä¸»èŠ‚ç‚¹çš„æŒ‘é€‰è§„åˆ™</h3><p>å½“ Sentinel éœ€è¦åœ¨å¤šä¸ªä»èŠ‚ç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®ä¸‹é¢çš„è§„åˆ™ä»å€™é€‰çš„ä»èŠ‚ç‚¹ä¸­å‰”é™¤ä¸ç¬¦åˆæ¡ä»¶çš„ä»èŠ‚ç‚¹ï¼š</p><ul><li>å¦å†³æ‰€æœ‰å·²ç»ä¸‹çº¿ä»¥åŠé•¿æ—¶é—´æ²¡æœ‰å¿ƒè·³æ¢å¤çš„ç–‘ä¼¼å·²ä¸‹çº¿çš„ä»èŠ‚ç‚¹ï¼›</li><li>å¦å†³æ‰€æœ‰é•¿æ—¶é—´æ²¡æœ‰å’Œä¸»èŠ‚ç‚¹é€šä¿¡ï¼Œæ•°æ®çŠ¶æ€è¿‡æ—¶çš„ä»èŠ‚ç‚¹ï¼›</li><li>å¦å†³æ‰€æœ‰ä¼˜å…ˆçº§ä¸º 0 çš„ä»æœåŠ¡å™¨ï¼›</li></ul><p>ç„¶åæ ¹æ®ä¸‹é¢çš„è§„åˆ™ï¼Œåœ¨å‰©ä½™çš„å€™é€‰çš„ä»èŠ‚ç‚¹é€‰å‡ºæ–°çš„èŠ‚ç‚¹</p><ul><li>é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ä»èŠ‚ç‚¹ï¼›</li><li>å¦‚æœä¼˜å…ˆçº§æœ€é«˜çš„ä»èŠ‚ç‚¹æœ‰ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šï¼Œé‚£ä¹ˆé€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼›</li><li>å¦‚æœç¬¦åˆä¸Šé¢ä¸¤ä¸ªæ¡ä»¶çš„ä»èŠ‚ç‚¹è¿˜æ˜¯æœ‰ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šï¼Œé‚£ä¹ˆé€‰å‡ºå®ƒä»¬ä¸­è¿è¡Œ ID æœ€å°çš„é‚£ä¸ªï¼›</li></ul><h3 id="é…ç½®ç‰ˆæœ¬å·-configuration-epochs" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç‰ˆæœ¬å·-configuration-epochs" aria-hidden="true">#</a> é…ç½®ç‰ˆæœ¬å·ï¼ˆConfiguration epochsï¼‰</h3><p>å‡ºäºä»¥ä¸‹å‡ ä¸ªé‡è¦åŸå› ï¼Œå“¨å…µéœ€è¦è·å¾—å¤šæ•°äººçš„æˆæƒæ‰èƒ½å¼€å§‹æ•…éšœè½¬ç§»ï¼š</p><p>è¿™æ˜¯å› ä¸ºè¢«æˆæƒçš„ Sentinel ä¼šè·å¾—ä¸€ä¸ªå”¯ä¸€çš„é…ç½®ç‰ˆæœ¬å·ï¼Œåœ¨æ•…éšœè½¬ç§»å®Œæˆåç”¨äºç‰ˆæœ¬æ§åˆ¶ã€‚ç”±äºå…¶ä»– Sentinel æ— æ³•ä½¿ç”¨æ­¤ç‰ˆæœ¬å·ï¼Œå› æ­¤æ¯ä¸ªæ•…éšœè½¬ç§»çš„é…ç½®éƒ½å…·æœ‰å”¯ä¸€çš„ç‰ˆæœ¬å·ã€‚</p><p>æ­¤å¤–ï¼ŒSentinel è¿˜æœ‰ä¸€ä¸ªè§„åˆ™ï¼šå¦‚æœä¸€ä¸ª Sentinel æŠ•ç¥¨æ”¯æŒå¦ä¸€ä¸ª Sentinel æ‰§è¡Œä¸»èŠ‚ç‚¹çš„æ•…éšœè½¬ç§»ï¼Œåˆ™å®ƒå°†ç­‰å¾…ä¸€æ®µæ—¶é—´å†å°è¯•è¿›è¡Œæ•…éšœè½¬ç§»ã€‚è¿™ä¸ªç­‰å¾…æ—¶é—´æ˜¯åœ¨ sentinel.conf ä¸­é…ç½®çš„ 2 å€ failover-timeoutã€‚è¿™æ„å‘³ç€ä¸ä¼šå‡ºç°å¤šä¸ª Sentinel åŒæ—¶å°è¯•å¯¹åŒä¸€ä¸»æœåŠ¡å™¨æ‰§è¡Œæ•…éšœè½¬ç§»çš„æƒ…å†µã€‚</p><p>åªè¦å¤§å¤šæ•° Sentinel ä»ç„¶èƒ½å¤Ÿé€šä¿¡ï¼Œæœ€ç»ˆå¿…å®šä¼šæœ‰ä¸€ä¸ª Sentinel è¢«æˆæƒæ‰§è¡Œæ•…éšœè½¬ç§»ã€‚åŒæ—¶ï¼ŒRedis Sentinelè¿˜ä¿è¯äº†å®‰å…¨å±æ€§ï¼Œå³æ¯ä¸ª Sentinel éƒ½ä¼šä½¿ç”¨ç‹¬ç‰¹çš„é…ç½®ç‰ˆæœ¬å·æ¥æ‰§è¡Œç›¸åŒä¸»ä¸»èŠ‚ç‚¹çš„æ•…éšœè½¬ç§»ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</p><h3 id="é…ç½®ä¼ æ’­æ€§-configuration-propagation" tabindex="-1"><a class="header-anchor" href="#é…ç½®ä¼ æ’­æ€§-configuration-propagation" aria-hidden="true">#</a> é…ç½®ä¼ æ’­æ€§ï¼ˆConfiguration propagationï¼‰</h3><p>å½“ä¸€ä¸ª Sentinel æˆåŠŸåœ°è¿›è¡Œäº†ä¸»æœåŠ¡å™¨çš„æ•…éšœè½¬ç§»åï¼Œå®ƒä¼šå‘å…¶ä»– Sentinel å¹¿æ’­æ–°çš„é…ç½®ä¿¡æ¯ï¼Œä»¥ä¾¿å…¶ä»– Sentinel èƒ½å¤Ÿæ›´æ–°æœ‰å…³è¯¥ä¸»æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚</p><p>å¯¹äºæ•…éšœè½¬ç§»çš„æˆåŠŸä¸å¦ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼šSentinel å¿…é¡»èƒ½å¤Ÿå‘æ‰€é€‰çš„ä»èŠ‚ç‚¹å‘é€ REPLICAOF NO ONE å‘½ä»¤ï¼Œå¹¶ä¸”åœ¨ä¸»èŠ‚ç‚¹çš„ INFO è¾“å‡ºä¸­è§‚å¯Ÿåˆ°åˆ‡æ¢åˆ°ä¸»èŠ‚ç‚¹ã€‚</p><p>å³ä½¿ä»èŠ‚ç‚¹çš„é‡æ–°é…ç½®è¿˜æ²¡æœ‰å®Œæˆï¼Œæ•…éšœè½¬ç§»ä¹Ÿè¢«è§†ä¸ºæ˜¯æˆåŠŸçš„ã€‚æ‰€æœ‰çš„ Sentinel éƒ½å¿…é¡»å¼€å§‹æŠ¥å‘Šæ–°çš„é…ç½®ä¿¡æ¯ã€‚</p><p>æ¯ä¸ª Sentinel éƒ½ä¼šä½¿ç”¨ Redis Pub/Sub æ¶ˆæ¯è¿ç»­å¹¿æ’­ä¸»èŠ‚ç‚¹çš„é…ç½®ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ä¸»èŠ‚ç‚¹å’Œæ‰€æœ‰ä»èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œæ‰€æœ‰ Sentinel éƒ½ç­‰å¾…æ¶ˆæ¯ä»¥æŸ¥çœ‹å…¶ä»– Sentinel å¹¿æ’­çš„é…ç½®ã€‚è¿™äº›é…ç½®è¢«å¹¿æ’­åœ¨<code>__sentinel__:hello </code> Pub/Sub é€šé“ä¸­ã€‚</p><p>ç”±äºæ¯ä¸ªé…ç½®å…·æœ‰ä¸åŒçš„ç‰ˆæœ¬å·ï¼Œè¾ƒé«˜ç‰ˆæœ¬å§‹ç»ˆä¼˜å…ˆäºè¾ƒå°ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œåœ¨æ•…éšœè½¬ç§»å®Œæˆåï¼Œè·å¾—æˆæƒçš„ Sentinel å°†ä½¿ç”¨ä¸åŒçš„ç‰ˆæœ¬å·æ¥å¹¿æ’­æ–°çš„é…ç½®ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾åŸå§‹é…ç½®æ˜¯ä¸»èŠ‚ç‚¹ IP åœ°å€ä¸º 192.168.1.50:6379ï¼Œç‰ˆæœ¬ä¸º 1ã€‚ä¸€æ®µæ—¶é—´åï¼Œä¸€ä¸ª Sentinel è¢«æˆæƒæ‰§è¡Œæ•…éšœè½¬ç§»ï¼Œä½¿ç”¨ç‰ˆæœ¬ 2ã€‚å¦‚æœæ•…éšœè½¬ç§»æˆåŠŸï¼Œå®ƒå°†å¼€å§‹å‘å…¶ä»– Sentinel å¹¿æ’­æ–°çš„é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚æ–°çš„èŠ‚ç‚¹ IP åœ°å€ä¸º192.168.1.50:9000ï¼Œç‰ˆæœ¬ä¸º 2ã€‚ç”±äºæ–°é…ç½®å…·æœ‰æ›´é«˜çš„ç‰ˆæœ¬å·ï¼Œæ‰€æœ‰å…¶ä»– Sentinel éƒ½å°†æ›´æ–°å…¶é…ç½®ä¿¡æ¯ã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Sentinel éœ€è¦ä¿è¯æ¯ä¸ªæ•…éšœè½¬ç§»ä½¿ç”¨ä¸åŒç‰ˆæœ¬å·çš„åŸå› ã€‚åªè¦èƒ½å¤Ÿé€šä¿¡ï¼Œæ‰€æœ‰ Sentinel éƒ½ä¼šæ±‡èšåˆ°å…·æœ‰è¾ƒé«˜ç‰ˆæœ¬å·çš„ç›¸åŒé…ç½®ã€‚å¦‚æœå‡ºç°äº†ç½‘ç»œåˆ†åŒºï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å°†æ±‡èšåˆ°å…·æœ‰æœ€é«˜æœ¬åœ°é…ç½®çš„ä½ç½®ã€‚åœ¨æ²¡æœ‰åˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ Sentinel éƒ½å°†è¾¾æˆä¸€è‡´æ„è§ï¼Œä½¿ç”¨ç›¸åŒçš„é…ç½®ä¿¡æ¯ã€‚</p><h3 id="åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§" aria-hidden="true">#</a> åˆ†åŒºä¸‹çš„ä¸€è‡´æ€§</h3><p>Redis Sentinel é…ç½®æœ€ç»ˆæ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤æ¯ä¸ªåˆ†åŒºéƒ½ä¼šæ”¶æ•›åˆ°å¯ç”¨çš„æ›´é«˜é…ç½®ã€‚</p><ul><li>Redis instances.</li><li>Sentinel instances.</li><li>Clients.</li></ul><p>ä¸ºäº†å®šä¹‰ç³»ç»Ÿçš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘æ‰€æœ‰è¿™ä¸‰ä¸ªæ–¹é¢ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘ç»œï¼Œå…¶ä¸­æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ª Redis å®ä¾‹å’Œä¸€ä¸ª Sentinel å®ä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>            +-------------+
            | Sentinel 1  |----- Client A
            | Redis 1 (M) |
            +-------------+
                    |
                    |
+-------------+     |          +------------+
| Sentinel 2  |-----+-- // ----| Sentinel 3 |----- Client B
| Redis 2 (S) |                | Redis 3 (M)|
+-------------+                +------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼ŒåŸå§‹çŠ¶æ€æ˜¯ Redis 3 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œè€Œ Redis 1 å’Œ 2 æ˜¯ä»èŠ‚ç‚¹ã€‚æŸä¸ªæ—¶åˆ»å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºï¼Œéš”ç¦»äº†æ—§çš„ä¸»èŠ‚ç‚¹ã€‚ Sentinel 1 å’Œ 2 å¼€å§‹æ•…éšœè½¬ç§»ï¼Œå°† Sentinel 1 æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</p><p>Sentinel å±æ€§ä¿è¯ Sentinel 1 å’Œ 2 ç°åœ¨å…·æœ‰ä¸»èŠ‚ç‚¹çš„æ–°é…ç½®ã€‚ä½†æ˜¯ Sentinel 3 ä»ç„¶å…·æœ‰æ—§é…ç½®ï¼Œå› ä¸ºå®ƒä½äºä¸åŒçš„åˆ†åŒºä¸­ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ Sentinel 3 å°†åœ¨ç½‘ç»œåˆ†åŒºä¿®å¤æ—¶æ›´æ–°å…¶é…ç½®ï¼Œä½†æ˜¯å¦‚æœæœ‰å®¢æˆ·ç«¯ä¸æ—§ä¸»èŠ‚ç‚¹åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œåœ¨åˆ†åŒºæœŸé—´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥å‘æ—§çš„ä¸»èŠ‚ç‚¹ Redis 3 å†™å…¥æ•°æ®ã€‚å½“ç½‘ç»œåˆ†åŒºæ¢å¤æ—¶ï¼ŒRedis 3 å°†å˜æˆ Redis 1 çš„ä»èŠ‚ç‚¹ï¼Œåˆ†åŒºæœŸé—´å†™å…¥çš„æ‰€æœ‰æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚</p><ul><li>å¦‚æœ Redis ä»…ä»…ä½œä¸ºç¼“å­˜æ¥ä½¿ç”¨ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ B å†™å…¥æ—§çš„ä¸»èŠ‚ç‚¹ï¼Œå³ä½¿æ•°æ®ä¸¢å¤±å¯èƒ½ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼›</li><li>å¦‚æœ Redis ç”¨ä½œæŒä¹…å­˜å‚¨æ•°æ®ï¼Œå‡ºç°æ•°æ®ä¸¢å¤±é—®é¢˜å°±å¤§äº†ï¼Œéœ€è¦é…ç½®ç³»ç»Ÿä»¥éƒ¨åˆ†é˜²æ­¢æ­¤é—®é¢˜ï¼›</li></ul><p>ç”±äº Redis æ˜¯å¼‚æ­¥å¤åˆ¶çš„ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹æ— æ³•å®Œå…¨é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Redis é…ç½®é€‰é¡¹é™åˆ¶ Redis 3 å’Œ Redis 1 ä¹‹é—´çš„å·®å¼‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>min-replicas-to-write 1
min-replicas-max-lag 10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œæ­¤é…ç½®ï¼Œä¸Šä¾‹ä¸­çš„ Redis 3 å°†åœ¨ 10 ç§’åå˜å¾—ä¸å¯ç”¨ã€‚å½“ç½‘ç»œåˆ†åŒºæ¢å¤åï¼ŒSentinel 3 é…ç½®å°†æ±‡èšåˆ°æ–°é…ç½®ï¼Œå®¢æˆ·ç«¯ B å°†èƒ½å¤Ÿè·å–æœ‰æ•ˆé…ç½®å¹¶ç»§ç»­ã€‚</p><p>Redis + Sentinel æ˜¯ä¸€ä¸ªæœ€ç»ˆä¸€è‡´æ€§ç³»ç»Ÿï¼Œæ—§ä¸»èŠ‚ç‚¹çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒï¼Œæ—§ä¸»èŠ‚ç‚¹å¤åˆ¶å½“å‰ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚è¿™æ„å‘³ç€åœ¨æ•…éšœè½¬ç§»æœŸé—´å†™å…¥çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¢å¤±çš„æ•°æ®å¹¶ä¸æ˜¯ Sentinel æœ¬èº«çš„é™åˆ¶ã€‚å¦‚æœä½¿ç”¨å¼ºä¸€è‡´çš„å¤åˆ¶çŠ¶æ€æœºç¼–æ’æ•…éšœè½¬ç§»ï¼Œåˆ™ä»å°†å…·æœ‰ç›¸åŒçš„å±æ€§ã€‚ä½†æ˜¯ä¸ºäº†é¿å…ç¡®è®¤å†™å…¥çš„ä¸¢å¤±ï¼Œåªæœ‰ä¸¤ç§æ–¹æ³•å¯ç”¨ï¼š</p><ul><li>ä½¿ç”¨åŒæ­¥å¤åˆ¶ï¼ˆå’Œé€‚å½“çš„å…±è¯†ç®—æ³•æ¥è¿è¡Œå¤åˆ¶çŠ¶æ€æœºï¼‰ã€‚</li><li>ä½¿ç”¨æœ€ç»ˆä¸€è‡´çš„ç³»ç»Ÿï¼Œå¯ä»¥åˆå¹¶åŒä¸€å¯¹è±¡çš„ä¸åŒç‰ˆæœ¬ã€‚</li></ul><p>Redis ç›®å‰æ— æ³•ä½¿ç”¨ä»¥ä¸Šä»»ä½•ä¸€ä¸ªç³»ç»Ÿï¼Œç›®å‰å¹¶ä¸æ˜¯å¼€å‘ç›®æ ‡ã€‚</p><h3 id="sentinel-é…ç½®æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#sentinel-é…ç½®æŒä¹…åŒ–" aria-hidden="true">#</a> Sentinel é…ç½®æŒä¹…åŒ–</h3><p>Sentinel çŠ¶æ€è¢«ä¿å­˜åœ¨ Sentinel é…ç½®æ–‡ä»¶ä¸­ã€‚</p><p>æ¯å½“ä¸€ä¸ªä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°æˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®ï¼ˆç”± leader Sentinel è´Ÿè´£ï¼‰ï¼Œè¯¥é…ç½®éƒ½ä¼šä¸é…ç½®çºªå…ƒï¼ˆconfiguration epochï¼‰ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚è¿™æ„å‘³ç€åœ¨åœæ­¢å’Œé‡æ–°å¯åŠ¨ Sentinel è¿›ç¨‹æ—¶ï¼Œä¸å¿…æ‹…å¿ƒæ•°æ®ä¸¢å¤±ã€‚</p><p>è¿˜æ˜¯çœ‹å‰é¢éƒ¨ç½²çš„æ¡ˆä¾‹ï¼Œæ‰€æœ‰ Sentinel éƒ½èµ·æ¥ä¹‹åï¼Œå®ƒä»¬çš„é…ç½®æ–‡ä»¶ä¼šæ”¹å˜</p><p>åŸå§‹çš„æ˜¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>port 26379
daemonize yes
logfile &quot;./sentinel-26379.log&quot;
dir &quot;../data/redis-sentinel-demo&quot;
sentinel monitor demomaster 127.0.0.1 6379 2
sentinel down-after-milliseconds demomaster 30000
sentinel parallel-syncs demomaster 1
sentinel failover-timeout demomaster 180000

# è®¾ç½®è¿æ¥ redis æ•°æ®èŠ‚ç‚¹çš„å¯†ç 
sentinel auth-pass demomaster master123
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€æœ‰ Sentinel éƒ½èµ·æ¥ä¹‹åï¼Œé…ç½®æ–‡ä»¶å˜æˆä¸‹é¢è¿™æ ·</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>port 26379
daemonize yes
logfile &quot;./sentinel-26379.log&quot;
dir &quot;../data/redis-sentinel-demo&quot;
sentinel monitor demomaster 127.0.0.1 6379 2

# è®¾ç½®è¿æ¥ redis æ•°æ®èŠ‚ç‚¹çš„å¯†ç 
sentinel auth-pass demomaster master123
# Generated by CONFIG REWRITE
protected-mode no
pidfile &quot;/var/run/redis.pid&quot;
user default on nopass ~* &amp;* +@all
sentinel myid 12a27d10e3f1bdf445ae30dd1f4aba1af78234f6
sentinel config-epoch demomaster 0
sentinel leader-epoch demomaster 0
sentinel current-epoch 0
sentinel known-replica demomaster 127.0.0.1 6380
sentinel known-replica demomaster 127.0.0.1 6381
sentinel known-sentinel demomaster 127.0.0.1 26381 2b044ab85b5b93b8553baf65f8a40970ff4fbb9e
sentinel known-sentinel demomaster 127.0.0.1 26380 70668315c96c8bfb74520e4982f8378dcd564dfe
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ª # Generated by CONFIG REWRITE çš„æ³¨é‡Šä¸‹é¢çš„ä¸œè¥¿</p><h2 id="è¿ç»´" tabindex="-1"><a class="header-anchor" href="#è¿ç»´" aria-hidden="true">#</a> è¿ç»´</h2><h3 id="æ¨¡æ‹Ÿæ•…éšœè½¬ç§»" tabindex="-1"><a class="header-anchor" href="#æ¨¡æ‹Ÿæ•…éšœè½¬ç§»" aria-hidden="true">#</a> æ¨¡æ‹Ÿæ•…éšœè½¬ç§»</h3><p>è¿˜æ˜¯ä»¥å‰é¢çš„éƒ¨ç½²æ¡ˆä¾‹ä¸ºåŸºç¡€æ¥æ¨¡æ‹Ÿæ•…éšœè½¬ç§»ã€‚ä¸€ä¸»ä¸¤ä»ï¼Œä¸‰ä¸ª Sentinel èŠ‚ç‚¹ç»„æˆçš„é›†åˆã€‚</p><blockquote><p>https://redis.io/docs/management/sentinel/#testing-the-failover</p></blockquote><p>æ¨¡æ‹Ÿæ•…éšœæœ‰ä¸‹é¢çš„æ–¹å¼ï¼š</p><ul><li>å¼ºåˆ¶æ€æ‰å¯¹åº”èŠ‚ç‚¹çš„è¿›ç¨‹ï¼›</li><li>ä½¿ç”¨ DEBUG sleep å‘½ä»¤ï¼Œè®©èŠ‚ç‚¹è¿›å…¥ç¡çœ çŠ¶æ€ï¼›</li><li>ä½¿ç”¨ SHUTDOWN å‘½ä»¤ï¼Œæ¨¡æ‹Ÿæ­£å¸¸åœæ‰ Redisï¼›</li></ul><p>æœ¬æ¬¡ä½¿ç”¨æ€æ‰ä¸»èŠ‚ç‚¹ 6379 çš„è¿›ç¨‹ï¼Œè¿‡äº†ä¸€ä¼šå„¿ 6380 å˜æˆæ–°çš„ä¸»èŠ‚ç‚¹ã€6381 å˜æˆ 6380 çš„ä»èŠ‚ç‚¹ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6380&gt; role
1) &quot;master&quot;
2) (integer) 74870
3) 1) 1) &quot;127.0.0.1&quot;
      2) &quot;6381&quot;
      3) &quot;74870&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ1ï¼‰6380 çš„æ—¥å¿—</strong></p><p>2023-04-05 13:57:14 kill æ‰äº† 6379 çš„è¿›ç¨‹ï¼Œæ­¤æ—¶ 6380 çš„æ—¥å¿—å¦‚ä¸‹ï¼Œå‘ç°æ— æ³•è¿æ¥ master 6379ï¼Œå¹¶åœ¨å°è¯•é‡è¿ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4317:S 05 Apr 2023 13:57:14.593 # Connection with master lost.
4317:S 05 Apr 2023 13:57:14.594 * Caching the disconnected master state.
4317:S 05 Apr 2023 13:57:14.594 * Reconnecting to MASTER 127.0.0.1:6379
4317:S 05 Apr 2023 13:57:14.595 * MASTER &lt;-&gt; REPLICA sync started
4317:S 05 Apr 2023 13:57:14.595 # Error condition on socket for SYNC: Connection refused
4317:S 05 Apr 2023 13:57:14.984 * Connecting to MASTER 127.0.0.1:6379
4317:S 05 Apr 2023 13:57:14.985 * MASTER &lt;-&gt; REPLICA sync started
4317:S 05 Apr 2023 13:57:14.986 # Error condition on socket for SYNC: Connection refused
4317:S 05 Apr 2023 13:57:16.001 * Connecting to MASTER 127.0.0.1:6379
4317:S 05 Apr 2023 13:57:16.003 * MASTER &lt;-&gt; REPLICA sync started
4317:S 05 Apr 2023 13:57:16.004 # Error condition on socket for SYNC: Connection refused
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2023-04-05 13:57:44 æ”¶åˆ°äº†æ¥è‡ª Sentinel èŠ‚ç‚¹çš„å‘½ä»¤</p><ul><li>æ¸…ç†åŸæ¥ç¼“å­˜çš„ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ï¼›</li><li>è®¾ç½®è¾…åŠ©çš„å¤åˆ¶ idï¼›</li><li>Sentinel å°† 6380 è®¾ç½®ä¸ºä¸»èŠ‚ç‚¹ï¼›</li><li>é‡å†™æœ¬åœ°é…ç½®ï¼ˆsentinel å’Œ redis æ•°æ®èŠ‚ç‚¹çš„é…ç½®éƒ½ä¼šé‡å†™ï¼‰ï¼›</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4317:M 05 Apr 2023 13:57:44.943 * Discarding previously cached master state.
4317:M 05 Apr 2023 13:57:44.943 # Setting secondary replication ID to 3cf3ed60210bf62584c2e1ba68962ed3bb6ca4ad, valid up to offset: 45762. New replication ID is e1294507d971988f7d2d458fac63d85233767635
4317:M 05 Apr 2023 13:57:44.944 * MASTER MODE enabled (user request from &#39;id=7 addr=127.0.0.1:57902 laddr=127.0.0.1:6380 fd=11 name=sentinel-34aebf20-cmd age=259 idle=0 flags=x db=0 sub=0 psub=0 multi=4 qbuf=188 qbuf-free=65342 argv-mem=4 obl=45 oll=0 omem=0 tot-mem=82980 events=r cmd=exec user=default redir=-1&#39;)
4317:M 05 Apr 2023 13:57:44.947 # CONFIG REWRITE executed with success.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2023-04-05 13:57:45 æ—¶å€™ï¼Œ6381 èŠ‚ç‚¹å‘æ¥äº†å¤åˆ¶çš„è¯·æ±‚ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4317:M 05 Apr 2023 13:57:45.495 * Replica 127.0.0.1:6381 asks for synchronization
4317:M 05 Apr 2023 13:57:45.496 * Partial resynchronization request from 127.0.0.1:6381 accepted. Sending 158 bytes of backlog starting from offset 45762.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ2ï¼‰6381 æ—¥å¿—</strong></p><p>åŒæ ·åœ¨ 2023-04-05 13:57:14 å‘ç°å’Œ 6379 èŠ‚ç‚¹çš„è¿æ¥æ–­å¼€äº†</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4320:S 05 Apr 2023 13:57:14.593 # Connection with master lost.
4320:S 05 Apr 2023 13:57:14.594 * Caching the disconnected master state.
4320:S 05 Apr 2023 13:57:14.594 * Reconnecting to MASTER 127.0.0.1:6379
4320:S 05 Apr 2023 13:57:14.595 * MASTER &lt;-&gt; REPLICA sync started
4320:S 05 Apr 2023 13:57:14.595 # Error condition on socket for SYNC: Connection refused
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2023-04-05 13:57:14 æ—¶æ¥åˆ° Sentinel çš„å‘½ä»¤ï¼Œå°†è‡ªå·±å˜æˆäº† 6380 èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œç„¶åé‡å†™é…ç½®</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4320:S 05 Apr 2023 13:57:45.491 * Connecting to MASTER 127.0.0.1:6380
4320:S 05 Apr 2023 13:57:45.492 * MASTER &lt;-&gt; REPLICA sync started
4320:S 05 Apr 2023 13:57:45.492 * REPLICAOF 127.0.0.1:6380 enabled (user request from &#39;id=7 addr=127.0.0.1:57900 laddr=127.0.0.1:6381 fd=11 name=sentinel-34aebf20-cmd age=260 idle=0 flags=x db=0 sub=0 psub=0 multi=4 qbuf=331 qbuf-free=65199 argv-mem=4 obl=45 oll=0 omem=0 tot-mem=82980 events=r cmd=exec user=default redir=-1&#39;)
4320:S 05 Apr 2023 13:57:45.494 # CONFIG REWRITE executed with success.
4320:S 05 Apr 2023 13:57:45.494 * Non blocking connect for SYNC fired the event.
4320:S 05 Apr 2023 13:57:45.495 * Master replied to PING, replication can continue...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2023-04-05 13:57:45 å’Œæ–°çš„ä¸»èŠ‚ç‚¹å»ºç«‹è¿æ¥åï¼Œå°è¯•å‘èµ·ä¸€ä¸ªéƒ¨åˆ†åŒæ­¥çš„æ“ä½œ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4320:S 05 Apr 2023 13:57:45.495 * Trying a partial resynchronization (request 3cf3ed60210bf62584c2e1ba68962ed3bb6ca4ad:45762).
4320:S 05 Apr 2023 13:57:45.496 * Successful partial resynchronization with master.
4320:S 05 Apr 2023 13:57:45.496 # Master replication ID changed to e1294507d971988f7d2d458fac63d85233767635
4320:S 05 Apr 2023 13:57:45.496 * MASTER &lt;-&gt; REPLICA sync: Master accepted a Partial Resynchronization.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ3ï¼‰Sentinel 26379 æ—¥å¿—</strong></p><p>2023-04-05 13:57:44 å¯¹ 6379 åšäº†ä¸»è§‚ä¸‹çº¿ï¼ˆ+sdownï¼‰ï¼Œè¿™ä¸ªæ—¶é—´æ­£å¥½æ˜¯æ€æ‰ 6379 è¿›ç¨‹åçš„ 30 ç§’ï¼Œä¹Ÿå°±æ˜¯ down-after-milliseconds çš„é…ç½®æ˜¯ä¸€æ ·çš„ã€‚Sentinel èŠ‚ç‚¹æ›´æ–°è‡ªå·±çš„é…ç½®çºªå…ƒï¼ˆnew-epochï¼‰</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4449:X 05 Apr 2023 13:57:44.693 # +sdown master demomaster 127.0.0.1 6379
4449:X 05 Apr 2023 13:57:44.777 # +new-epoch 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»™ Sentinel 23681 èŠ‚ç‚¹æŠ•ç¥¨ï¼Œ 23681 çš„ runid æ˜¯ 34aebf207b22c742b6fdab45667158681077e36aã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4449:X 05 Apr 2023 13:57:44.779 # +vote-for-leader 34aebf207b22c742b6fdab45667158681077e36a 1
4449:X 05 Apr 2023 13:57:44.784 # +odown master demomaster 127.0.0.1 6379 #quorum 2/2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Sentinel 26381 èŠ‚ç‚¹è®© 6380 ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶å‘ç°äº†ä¸¤ä¸ªä»èŠ‚ç‚¹ 6381 å’Œ 6379ï¼Œå¹¶åœ¨ 30 ç§’åå¯¹ 6379 åšäº†ä¸»è§‚ä¸‹çº¿ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4449:X 05 Apr 2023 13:57:44.785 # Next failover delay: I will not start a failover before Wed Apr  5 14:03:45 2023
4449:X 05 Apr 2023 13:57:45.491 # +config-update-from sentinel 34aebf207b22c742b6fdab45667158681077e36a 127.0.0.1 26381 @ demomaster 127.0.0.1 6379
4449:X 05 Apr 2023 13:57:45.492 # +switch-master demomaster 127.0.0.1 6379 127.0.0.1 6380
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ4ï¼‰Sentinel 26380 æ—¥å¿—</strong></p><p>å’Œ Sentinel 26379 æ—¥å¿—ä¸€æ ·ã€‚</p><p><strong>ï¼ˆ5ï¼‰Sentinel 26381 æ—¥å¿—</strong></p><p>Sentinel 26381 æ˜¯é¢†å¯¼è€…ï¼Œè¾¾åˆ°äº†å®¢è§‚ä¸‹çº¿çš„æ¡ä»¶</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4453:X 05 Apr 2023 13:57:44.704 # +sdown master demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:44.771 # +odown master demomaster 127.0.0.1 6379 #quorum 3/2
4453:X 05 Apr 2023 13:57:44.772 # +new-epoch 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sentinel 26381 è¢«é€‰ä¸ºé¢†å¯¼è€…ï¼Œ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4453:X 05 Apr 2023 13:57:44.772 # +try-failover master demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:44.775 # +vote-for-leader 34aebf207b22c742b6fdab45667158681077e36a 1
4453:X 05 Apr 2023 13:57:44.779 # bfa7c7f8595957cc13ab5ee46522f5a4fd9d6627 voted for 34aebf207b22c742b6fdab45667158681077e36a 1
4453:X 05 Apr 2023 13:57:44.779 # 3dbe53a318a49cc2b2faea534737f41fea2f75d4 voted for 34aebf207b22c742b6fdab45667158681077e36a 1
4453:X 05 Apr 2023 13:57:44.834 # +elected-leader master demomaster 127.0.0.1 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼€å§‹æ•…éšœè½¬ç§»</p><ol><li>å¯»æ‰¾åˆé€‚çš„ä»èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼›</li><li>é€‰å‡ºäº†åˆé€‚çš„ä»èŠ‚ç‚¹ï¼ˆ6380ï¼‰ï¼›</li><li>å‘½ä»¤ 6380 èŠ‚ç‚¹æ‰§è¡Œ slaveof no one å‘½ä»¤ï¼Œè®©å®ƒç§°ä¸ºä¸»èŠ‚ç‚¹ï¼›</li><li>ç­‰å¾… 6380 æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼›</li><li>ç¡®è®¤ 6380 èŠ‚ç‚¹å·²ç»æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼›</li><li>æ•…éšœè½¬ç§»è¿›å…¥é‡æ–°é…ç½®ä»èŠ‚ç‚¹é˜¶æ®µï¼›</li><li>å‘½ä»¤ 6381 èŠ‚ç‚¹å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ï¼›</li><li>6381 èŠ‚ç‚¹æ­£åœ¨é‡æ–°é…ç½®ç§°ä¸º 6380 èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œä½†æ˜¯åŒæ­¥è¿‡ç¨‹å°šæœªå®Œæˆï¼›</li><li>æ•…éšœè½¬ç§»é¡ºåˆ©å®Œæˆï¼›</li><li>æ•…éšœè½¬ç§»æˆåŠŸåï¼Œå‘å¸ƒä¸»èŠ‚ç‚¹çš„åˆ‡æ¢æ¶ˆæ¯ï¼›</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4453:X 05 Apr 2023 13:57:44.834 # +failover-state-select-slave master demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:44.888 # +selected-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:44.888 * +failover-state-send-slaveof-noone slave 127.0.0.1:6380 127.0.0.1 6380 @ demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:44.942 * +failover-state-wait-promotion slave 127.0.0.1:6380 127.0.0.1 6380 @ demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:45.438 # +promoted-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:45.438 # +failover-state-reconf-slaves master demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:45.491 * +slave-reconf-sent slave 127.0.0.1:6381 127.0.0.1 6381 @ demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:45.870 # -odown master demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:46.450 * +slave-reconf-inprog slave 127.0.0.1:6381 127.0.0.1 6381 @ demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:46.450 * +slave-reconf-done slave 127.0.0.1:6381 127.0.0.1 6381 @ demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:46.550 # +failover-end master demomaster 127.0.0.1 6379
4453:X 05 Apr 2023 13:57:46.551 # +switch-master demomaster 127.0.0.1 6379 127.0.0.1 6380
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡æ–°å¯åŠ¨åŸæ¥çš„ 6379 èŠ‚ç‚¹</p><p><strong>ï¼ˆ1ï¼‰6379 çš„æ—¥å¿—ï¼Œå‘æ–°çš„ä¸»èŠ‚ç‚¹ 6380 å‘èµ·å¤åˆ¶è¯·æ±‚</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>8297:C 05 Apr 2023 14:42:21.524 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
8297:C 05 Apr 2023 14:42:21.524 # Redis version=6.2.11, bits=64, commit=720ea82e, modified=0, pid=8297, just started
8297:C 05 Apr 2023 14:42:21.525 # Configuration loaded
8297:S 05 Apr 2023 14:42:21.527 * Increased maximum number of open files to 10032 (it was originally set to 256).
8297:S 05 Apr 2023 14:42:21.527 * monotonic clock: POSIX clock_gettime
8297:S 05 Apr 2023 14:42:21.530 * Running mode=standalone, port=6379.
8297:S 05 Apr 2023 14:42:21.530 # Server initialized
8297:S 05 Apr 2023 14:42:21.531 * Loading RDB produced by version 6.2.11
8297:S 05 Apr 2023 14:42:21.531 * RDB age 2985 seconds
8297:S 05 Apr 2023 14:42:21.531 * RDB memory usage when created 2.06 Mb
8297:S 05 Apr 2023 14:42:21.531 # Done loading RDB, keys loaded: 0, keys expired: 0.
8297:S 05 Apr 2023 14:42:21.531 * DB loaded from disk: 0.001 seconds
8297:S 05 Apr 2023 14:42:21.531 * Before turning into a replica, using my own master parameters to synthesize a cached master: I may be able to synchronize with the new master with just a partial transfer.
8297:S 05 Apr 2023 14:42:21.531 * Ready to accept connections
8297:S 05 Apr 2023 14:42:21.532 * Connecting to MASTER 127.0.0.1:6380
8297:S 05 Apr 2023 14:42:21.532 * MASTER &lt;-&gt; REPLICA sync started
8297:S 05 Apr 2023 14:42:21.532 * Non blocking connect for SYNC fired the event.
8297:S 05 Apr 2023 14:42:21.532 * Master replied to PING, replication can continue...
8297:S 05 Apr 2023 14:42:21.533 * Trying a partial resynchronization (request 3cf3ed60210bf62584c2e1ba68962ed3bb6ca4ad:1).
8297:S 05 Apr 2023 14:42:21.533 * Successful partial resynchronization with master.
8297:S 05 Apr 2023 14:42:21.533 # Master replication ID changed to e1294507d971988f7d2d458fac63d85233767635
8297:S 05 Apr 2023 14:42:21.533 * MASTER &lt;-&gt; REPLICA sync: Master accepted a Partial Resynchronization.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ2ï¼‰6380 çš„æ—¥å¿—</strong></p><p>æ¥æ”¶å¤åˆ¶è¯·æ±‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4317:M 05 Apr 2023 14:42:21.533 * Replica 127.0.0.1:6379 asks for synchronization
4317:M 05 Apr 2023 14:42:21.534 * Partial resynchronization request from 127.0.0.1:6379 accepted. Sending 582055 bytes of backlog starting from offset 1.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ3ï¼‰Sentinel 26379 çš„æ—¥å¿—</strong></p><p>æ’¤é”€å¯¹ 6379 èŠ‚ç‚¹çš„ä¸»è§‚ä¸‹çº¿å†³å®š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>49:X 05 Apr 2023 14:42:22.445 * +reboot slave 127.0.0.1:6379 127.0.0.1 6379 @ demomaster 127.0.0.1 6380
4449:X 05 Apr 2023 14:42:22.536 # -sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ demomaster 127.0.0.1 638
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ4ï¼‰Sentinel 26380 çš„æ—¥å¿—</strong></p><p>æ’¤é”€å¯¹ 6379 èŠ‚ç‚¹çš„ä¸»è§‚ä¸‹çº¿å†³å®š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4453:X 05 Apr 2023 14:42:21.611 * +reboot slave 127.0.0.1:6379 127.0.0.1 6379 @ demomaster 127.0.0.1 6380
4453:X 05 Apr 2023 14:42:21.670 # -sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ demomaster 127.0.0.1 6380
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ5ï¼‰Sentinel 26381 çš„æ—¥å¿—</strong></p><p>æ’¤é”€å¯¹ 6379 èŠ‚ç‚¹çš„ä¸»è§‚ä¸‹çº¿å†³å®šï¼Œæ›´æ–° Sentinel èŠ‚ç‚¹çš„é…ç½®</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4451:X 05 Apr 2023 14:42:21.611 # -sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ demomaster 127.0.0.1 6380
4451:X 05 Apr 2023 114:42:21.612 * +convert-to-slave slave 127.0.0.1:6379 127.0.0.1 6379 @ demomaster 127.0.0.1 6380
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é«˜å¯ç”¨è¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#é«˜å¯ç”¨è¯»å†™åˆ†ç¦»" aria-hidden="true">#</a> é«˜å¯ç”¨è¯»å†™åˆ†ç¦»</h3><p>ä»èŠ‚ç‚¹ä¸€èˆ¬æœ‰ä¸¤ä¸ªä½œç”¨</p><ul><li>å½“ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œä½œä¸ºä¸»èŠ‚ç‚¹çš„å¤‡ä»½èŠ‚ç‚¹æ¥å®ç°æ•…éšœè½¬ç§»ï¼ŒRedis Sentinel å·²ç»å®ç°äº†å¯¹è¯¥åŠŸèƒ½çš„è‡ªåŠ¨åŒ–ï¼Œå®ç°äº†çœŸæ­£çš„é«˜å¯ç”¨ï¼›</li><li>æ‰©å±•ä¸»èŠ‚ç‚¹çš„è¯»èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯éå¸¸é€‚ç”¨ï¼›</li></ul><img src="/assets/Redis-Sentinelçš„è¯»å†™åˆ†ç¦»æ¶æ„å›¾-add5d0ca.png" alt="Redis-Sentinelçš„è¯»å†™åˆ†ç¦»æ¶æ„å›¾" style="zoom:67%;"><p>ä½†æ˜¯ä¸Šé¢çš„æ¶æ„å­˜åœ¨é—®é¢˜ï¼Œä»èŠ‚ç‚¹ä¸æ˜¯é«˜å¯ç”¨çš„ï¼Œå¦‚æœ Slave-1 èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œå®¢æˆ·ç«¯ Clint-1 å°†ä¼šä¸å…¶å¤±è”ï¼Œå…¶æ¬¡ Sentinel èŠ‚ç‚¹åªä¼šå¯¹è¯¥èŠ‚ç‚¹åšä¸»è§‚ä¸‹çº¿ï¼Œå› ä¸º Redis çš„æ•…éšœè½¬ç§»æ˜¯é’ˆå¯¹ä¸»èŠ‚ç‚¹çš„ã€‚</p><p>å‰é¢è¯´è¿‡ Sentinel å¯¹å„ä¸ªèŠ‚ç‚¹çš„ç›‘æ§ï¼Œå¦‚æœæœ‰å¯¹åº”çš„äº‹ä»¶å‘ç”Ÿï¼Œéƒ½ä¼šå‘å‡ºå¯¹åº”çš„äº‹ä»¶æ¶ˆæ¯ï¼Œå…¶ä¸­å’Œä»èŠ‚ç‚¹å˜åŠ¨çš„äº‹ä»¶æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p><ul><li><code>+switch-master</code>ï¼šå°†åŸæ¥çš„ä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œè¯´æ˜å‡å°‘äº†æŸä¸ªä»èŠ‚ç‚¹ï¼›</li><li><code>+convert-to-slave</code>ï¼šå°†åŸæ¥çš„ä¸»èŠ‚ç‚¹é™çº§ä¸ºä»èŠ‚ç‚¹ï¼Œè¯´æ˜æ·»åŠ äº†æŸä¸ªä»èŠ‚ç‚¹ï¼›</li><li><code>+slown</code>ï¼šä¸»è§‚ä¸‹çº¿ï¼Œè¯´æ˜å¯èƒ½æŸä¸ªä»èŠ‚ç‚¹å¯èƒ½ä¸å¯ç”¨ï¼ˆå› ä¸ºå¯¹ä»èŠ‚ç‚¹ä¸ä¼šåšå®¢è§‚ä¸‹çº¿ï¼‰ï¼Œæ‰€ä»¥å®ç°å®¢æˆ·ç«¯æ—¶å¯ä»¥é‡‡ç”¨è‡ªèº«ç­–ç•¥æ¥å®ç°ç±»ä¼¼ä¸»è§‚ä¸‹çº¿çš„åŠŸèƒ½ï¼›</li><li><code>+reboot</code>ï¼šé‡å¯äº†æŸä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå®ƒçš„è§’è‰²æ˜¯ Slaveï¼Œé‚£ä¹ˆè¯´æ˜æ·»åŠ äº†æŸä¸ªä»èŠ‚ç‚¹ï¼›</li></ul><p>æ‰€ä»¥åœ¨è®¾è®¡ Redis Sentinel çš„ä»èŠ‚ç‚¹çš„é«˜å¯ç”¨æ—¶ï¼Œåªè¦èƒ½å¤Ÿå®æ—¶æŒæ¡æ‰€æœ‰ä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼ŒæŠŠæ‰€æœ‰çš„ä»èŠ‚ç‚¹éƒ½çœ‹åšæˆä¸€ä¸ªèµ„æºæ± ï¼Œæ— è®ºæ˜¯ä¸Šçº¿è¿˜æ˜¯ä¸‹çº¿ä»èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯éƒ½èƒ½åŠæ—¶æ„Ÿåº”åˆ°ï¼ˆå°†å…¶ä»èµ„æºæ± ä¸­æ·»åŠ æˆ–è€…åˆ é™¤ï¼‰ï¼Œè¿™æ ·ä»èŠ‚ç‚¹çš„é«˜å¯ç”¨çš„ç›®æ ‡å°±è¾¾åˆ°äº†ã€‚</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: guosgbin@163.com">Dylan Kwok</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a href="/Redis/Redis_Pipeline%E4%BC%98%E5%8C%96RTT.html" class="nav-link prev" aria-label="Redis Pipelineä¼˜åŒ–RTT"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Redis Pipelineä¼˜åŒ–RTT</div></a><a href="/Redis/redis-cli%20%E4%BD%BF%E7%94%A8.html" class="nav-link next" aria-label="redis-cliä½¿ç”¨"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">redis-cliä½¿ç”¨<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-3c76045a.js" defer></script>
  </body>
</html>
