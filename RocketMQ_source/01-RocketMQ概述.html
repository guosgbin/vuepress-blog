<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://blog.guosgbin.cn/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html"><meta property="og:title" content="01-RocketMQ概述"><meta property="og:description" content="版本 内容 时间 ---- ------------------- ---------------------- V1 RocketMQ 整体架构 2023年06月07日23:40:43 V2 RocetMQ网络通信原理 2023年06月16日13:44:32 本次分析的 RocketMQ 的版本是 4.9.3 RocketMQ 整体架构（来自官网） ..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-06-18T10:37:06.000Z"><meta property="article:author" content="超威蓝猫 Dylan Kwok"><meta property="article:modified_time" content="2023-06-18T10:37:06.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"01-RocketMQ概述","image":[""],"dateModified":"2023-06-18T10:37:06.000Z","author":[{"@type":"Person","name":"超威蓝猫 Dylan Kwok","url":"","email":"guosgbin@163.com"}]}</script><link rel="icon" href="/小熊猫.svg"><title>01-RocketMQ概述</title><meta name="description" content="版本 内容 时间 ---- ------------------- ---------------------- V1 RocketMQ 整体架构 2023年06月07日23:40:43 V2 RocetMQ网络通信原理 2023年06月16日13:44:32 本次分析的 RocketMQ 的版本是 4.9.3 RocketMQ 整体架构（来自官网） ...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-219a40be.css" as="style"><link rel="stylesheet" href="/assets/style-219a40be.css">
    <link rel="modulepreload" href="/assets/app-2cb45ef8.js"><link rel="modulepreload" href="/assets/01-RocketMQ概述.html-c1615127.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/01-RocketMQ概述.html-25463efe.js"><link rel="prefetch" href="/assets/index.html-f838ce4f.js" as="script"><link rel="prefetch" href="/assets/01-CAS和Unsafe的API分析.html-612c4d6a.js" as="script"><link rel="prefetch" href="/assets/02-基本类型原子类AtomicLong.html-4083b8fd.js" as="script"><link rel="prefetch" href="/assets/03-引用类型原子类AtomicReference.html-8442553d.js" as="script"><link rel="prefetch" href="/assets/04-原子数组类AtomicLongArray.html-74e4c741.js" as="script"><link rel="prefetch" href="/assets/05-原子操作类AtomicReferenceFieldUpdater.html-d0310b2a.js" as="script"><link rel="prefetch" href="/assets/06-高性能原子类LongAdder.html-d6e3da8b.js" as="script"><link rel="prefetch" href="/assets/07-LockSupport分析.html-8117dd17.js" as="script"><link rel="prefetch" href="/assets/08-AQS简单介绍.html-f6f424de.js" as="script"><link rel="prefetch" href="/assets/09-基于ReentrantLock分析AQS的独占模式.html-2423c430.js" as="script"><link rel="prefetch" href="/assets/10-基于CountDownLatch分析AQS的共享模式.html-91ef4833.js" as="script"><link rel="prefetch" href="/assets/11-AQS的Condition机制.html-836364af.js" as="script"><link rel="prefetch" href="/assets/12-信号量Semaphore.html-3509682c.js" as="script"><link rel="prefetch" href="/assets/13-循环栏栅CyclicBarrier.html-812d137d.js" as="script"><link rel="prefetch" href="/assets/14-阶段Phaser.html-d684f4a1.js" as="script"><link rel="prefetch" href="/assets/15-交换Exchanger.html-b9bf24f3.js" as="script"><link rel="prefetch" href="/assets/16-读写锁ReentrantReadWriteLock.html-de44a1d3.js" as="script"><link rel="prefetch" href="/assets/17-Future模式-FutureTask.html-641c6250.js" as="script"><link rel="prefetch" href="/assets/18-线程池体系概述.html-dbcc52e5.js" as="script"><link rel="prefetch" href="/assets/19-线程池体系-AbstractExecutorService.html-fbd70afb.js" as="script"><link rel="prefetch" href="/assets/20-线程池体系-ThreadPoolExecutor.html-a274637a.js" as="script"><link rel="prefetch" href="/assets/21-线程池体系-ScheduledThreadPoolExecutor.html-707ffd40.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayList写时复制.html-914977b9.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySet写时复制.html-6c9c3cf6.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMap跳表.html-6cff54bf.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSet跳表.html-36cf4f7d.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMap源码分析.html-a3bba8a9.js" as="script"><link rel="prefetch" href="/assets/27-阻塞队列ArrayBlockingQueue.html-cd091357.js" as="script"><link rel="prefetch" href="/assets/28-阻塞队列LinkedBlockingQueue.html-d3579ee7.js" as="script"><link rel="prefetch" href="/assets/29-阻塞队列LinkedBlockingDeque.html-32c13680.js" as="script"><link rel="prefetch" href="/assets/30-阻塞队列PriorityBlockingQueue.html-b5455c77.js" as="script"><link rel="prefetch" href="/assets/31-阻塞队列DelayQueue.html-7759c195.js" as="script"><link rel="prefetch" href="/assets/32-阻塞队列SynchronousQueue.html-97ed879a.js" as="script"><link rel="prefetch" href="/assets/33-阻塞队列LinkedTransferQueue.html-3281c1b4.js" as="script"><link rel="prefetch" href="/assets/index.html-f5239cf3.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis01：myabtis的整体架构.html-f25c0705.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis02：入门案例.html-30e68cd3.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis03：解析全局配置文件.html-2db85266.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis04：解析Mapper映射文件.html-60756a5b.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis05：解析Statement操作节点.html-31e11b60.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis06：解析SQL语句.html-a9181b56.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis07：Java方法和SQL语句绑定.html-9bfa3db6.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis08：获得SqlSession.html-e2a92940.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis09：Executor执行器.html-ad701715.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis10：缓存机制.html-f2daa10c.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis11：StatementHandler.html-95b30d9b.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis12：参数解析和赋值.html-5778c0ea.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis13：结果集处理.html-2ff72779.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis14：插件.html-76cc6bf8.js" as="script"><link rel="prefetch" href="/assets/01-服务端启动流程.html-d2fc1f19.js" as="script"><link rel="prefetch" href="/assets/02-服务端启动添加ChannelInitializer到管道.html-86cb5d6a.js" as="script"><link rel="prefetch" href="/assets/03-客户端启动流程.html-becc83be.js" as="script"><link rel="prefetch" href="/assets/04-线程体系-NioEventLoopGroup.html-700e797e.js" as="script"><link rel="prefetch" href="/assets/05-线程体系-NioEventLoop相关父接口分析.html-754320bc.js" as="script"><link rel="prefetch" href="/assets/06-线程体系-AbstractEventExecutor.html-5250cd42.js" as="script"><link rel="prefetch" href="/assets/07-线程体系-AbstractScheduledEventExecutor-优先队列.html-e7bbaf32.js" as="script"><link rel="prefetch" href="/assets/08-线程体系-NioEventLoop概述.html-fce3fb2c.js" as="script"><link rel="prefetch" href="/assets/09-线程体系-NioEventLoop开启Selector及优化.html-6d8230cf.js" as="script"><link rel="prefetch" href="/assets/10-线程体系-NioEventLoop绑定线程.html-db947821.js" as="script"><link rel="prefetch" href="/assets/11-线程体系-NioEventLoop的run方法.html-def4cc31.js" as="script"><link rel="prefetch" href="/assets/12-线程体系-NioEventLoop规避JDK的NIO空循环bug.html-16ecaf4e.js" as="script"><link rel="prefetch" href="/assets/13-线程体系-NioEventLoop的优雅关闭.html-912d668d.js" as="script"><link rel="prefetch" href="/assets/14-服务端处理客户端的连接(ACCEPT).html-63afdec1.js" as="script"><link rel="prefetch" href="/assets/15-客户端处理READ事件概述.html-b35daeb8.js" as="script"><link rel="prefetch" href="/assets/16-客户端处理READ事件详解及RecvByteBufAllocator.html-a9faccfa.js" as="script"><link rel="prefetch" href="/assets/17-Netty管道机制.html-ba70b238.js" as="script"><link rel="prefetch" href="/assets/18-Netty发送数据流程及出站缓冲区.html-223d04a7.js" as="script"><link rel="prefetch" href="/assets/index.html-b475d8b0.js" as="script"><link rel="prefetch" href="/assets/Redis_Benchmark基准测试.html-dbf21951.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群和槽管理命令.html-2b4a1244.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群基本特性和集群搭建.html-42be726b.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群管理工具redis-cli.html-fc4f1503.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipeline优化RTT.html-8a4aa041.js" as="script"><link rel="prefetch" href="/assets/Redis_Sentinel高可用.html-6bcdb34a.js" as="script"><link rel="prefetch" href="/assets/Redis_key设计规范.html-ab90a7dc.js" as="script"><link rel="prefetch" href="/assets/Redis事务.html-e43061e1.js" as="script"><link rel="prefetch" href="/assets/Redis内存淘汰策略.html-feabd314.js" as="script"><link rel="prefetch" href="/assets/Redis发布订阅.html-68771977.js" as="script"><link rel="prefetch" href="/assets/Redis复制.html-33b20d6f.js" as="script"><link rel="prefetch" href="/assets/Redis大key和热key问题.html-394d194e.js" as="script"><link rel="prefetch" href="/assets/Redis慢查询日志.html-7fb06db0.js" as="script"><link rel="prefetch" href="/assets/Redis持久化机制.html-53af3f7a.js" as="script"><link rel="prefetch" href="/assets/Redis键空间通知(keyspace notification).html-012bd277.js" as="script"><link rel="prefetch" href="/assets/redis-cli 使用.html-f7ab22db.js" as="script"><link rel="prefetch" href="/assets/02-NameServer启动流程.html-a514999f.js" as="script"><link rel="prefetch" href="/assets/03-Broker启动流程.html-43c84806.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQ网络通信原理.html-ac88de8d.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ 服务端和客户端的启动.html-ef7f1888.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQ网络通信源码.html-b8e0bf43.js" as="script"><link rel="prefetch" href="/assets/07-NameServer作用和路由元信息.html-82a23869.js" as="script"><link rel="prefetch" href="/assets/08-NameServer路由管理源码分析.html-8da2bd72.js" as="script"><link rel="prefetch" href="/assets/09-生产者相关类分析.html-08f6e840.js" as="script"><link rel="prefetch" href="/assets/10-生产者启动流程.html-d761cf07.js" as="script"><link rel="prefetch" href="/assets/11-生产者发送消息.html-743328bc.js" as="script"><link rel="prefetch" href="/assets/resume.html-bdbd207a.js" as="script"><link rel="prefetch" href="/assets/404.html-f3795607.js" as="script"><link rel="prefetch" href="/assets/index.html-10b45510.js" as="script"><link rel="prefetch" href="/assets/index.html-dfd17ea5.js" as="script"><link rel="prefetch" href="/assets/index.html-2f392b9e.js" as="script"><link rel="prefetch" href="/assets/index.html-0efbdc5e.js" as="script"><link rel="prefetch" href="/assets/index.html-afae43e5.js" as="script"><link rel="prefetch" href="/assets/01-CAS和Unsafe的API分析.html-2c3142d5.js" as="script"><link rel="prefetch" href="/assets/02-基本类型原子类AtomicLong.html-91336710.js" as="script"><link rel="prefetch" href="/assets/03-引用类型原子类AtomicReference.html-27e62dbe.js" as="script"><link rel="prefetch" href="/assets/04-原子数组类AtomicLongArray.html-f1875363.js" as="script"><link rel="prefetch" href="/assets/05-原子操作类AtomicReferenceFieldUpdater.html-e561360f.js" as="script"><link rel="prefetch" href="/assets/06-高性能原子类LongAdder.html-9362c27b.js" as="script"><link rel="prefetch" href="/assets/07-LockSupport分析.html-77a05650.js" as="script"><link rel="prefetch" href="/assets/08-AQS简单介绍.html-2194cd16.js" as="script"><link rel="prefetch" href="/assets/09-基于ReentrantLock分析AQS的独占模式.html-0c237005.js" as="script"><link rel="prefetch" href="/assets/10-基于CountDownLatch分析AQS的共享模式.html-827f4fb8.js" as="script"><link rel="prefetch" href="/assets/11-AQS的Condition机制.html-14efa24b.js" as="script"><link rel="prefetch" href="/assets/12-信号量Semaphore.html-df1fb67b.js" as="script"><link rel="prefetch" href="/assets/13-循环栏栅CyclicBarrier.html-98d386a6.js" as="script"><link rel="prefetch" href="/assets/14-阶段Phaser.html-027c8f2d.js" as="script"><link rel="prefetch" href="/assets/15-交换Exchanger.html-edc08917.js" as="script"><link rel="prefetch" href="/assets/16-读写锁ReentrantReadWriteLock.html-69b3d38d.js" as="script"><link rel="prefetch" href="/assets/17-Future模式-FutureTask.html-b641bef0.js" as="script"><link rel="prefetch" href="/assets/18-线程池体系概述.html-648e558a.js" as="script"><link rel="prefetch" href="/assets/19-线程池体系-AbstractExecutorService.html-3ca0ec23.js" as="script"><link rel="prefetch" href="/assets/20-线程池体系-ThreadPoolExecutor.html-aedf2fed.js" as="script"><link rel="prefetch" href="/assets/21-线程池体系-ScheduledThreadPoolExecutor.html-c05ac11a.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayList写时复制.html-4e1455dd.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySet写时复制.html-8d61cb50.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMap跳表.html-6ac841d7.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSet跳表.html-9b199e19.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMap源码分析.html-afbad552.js" as="script"><link rel="prefetch" href="/assets/27-阻塞队列ArrayBlockingQueue.html-c3f44929.js" as="script"><link rel="prefetch" href="/assets/28-阻塞队列LinkedBlockingQueue.html-a43a9600.js" as="script"><link rel="prefetch" href="/assets/29-阻塞队列LinkedBlockingDeque.html-ccc4544b.js" as="script"><link rel="prefetch" href="/assets/30-阻塞队列PriorityBlockingQueue.html-5342158e.js" as="script"><link rel="prefetch" href="/assets/31-阻塞队列DelayQueue.html-658723ae.js" as="script"><link rel="prefetch" href="/assets/32-阻塞队列SynchronousQueue.html-6b3867d4.js" as="script"><link rel="prefetch" href="/assets/33-阻塞队列LinkedTransferQueue.html-f7d1870a.js" as="script"><link rel="prefetch" href="/assets/index.html-9bbca0d4.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis01：myabtis的整体架构.html-763ed330.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis02：入门案例.html-2bf82ca5.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis03：解析全局配置文件.html-25d04e4c.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis04：解析Mapper映射文件.html-4ac8b6b9.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis05：解析Statement操作节点.html-a7b1446c.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis06：解析SQL语句.html-017b3d2d.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis07：Java方法和SQL语句绑定.html-a670eae3.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis08：获得SqlSession.html-05d18c1a.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis09：Executor执行器.html-449b53a1.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis10：缓存机制.html-67217d2f.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis11：StatementHandler.html-14d1196a.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis12：参数解析和赋值.html-352f622d.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis13：结果集处理.html-8df532f0.js" as="script"><link rel="prefetch" href="/assets/深入浅出Mybatis14：插件.html-0af33833.js" as="script"><link rel="prefetch" href="/assets/01-服务端启动流程.html-c09ef4f4.js" as="script"><link rel="prefetch" href="/assets/02-服务端启动添加ChannelInitializer到管道.html-a29efda8.js" as="script"><link rel="prefetch" href="/assets/03-客户端启动流程.html-cd8f0e43.js" as="script"><link rel="prefetch" href="/assets/04-线程体系-NioEventLoopGroup.html-630b3a66.js" as="script"><link rel="prefetch" href="/assets/05-线程体系-NioEventLoop相关父接口分析.html-67f6a450.js" as="script"><link rel="prefetch" href="/assets/06-线程体系-AbstractEventExecutor.html-195128d3.js" as="script"><link rel="prefetch" href="/assets/07-线程体系-AbstractScheduledEventExecutor-优先队列.html-22637f35.js" as="script"><link rel="prefetch" href="/assets/08-线程体系-NioEventLoop概述.html-dad65215.js" as="script"><link rel="prefetch" href="/assets/09-线程体系-NioEventLoop开启Selector及优化.html-2d190970.js" as="script"><link rel="prefetch" href="/assets/10-线程体系-NioEventLoop绑定线程.html-26823359.js" as="script"><link rel="prefetch" href="/assets/11-线程体系-NioEventLoop的run方法.html-76b9b529.js" as="script"><link rel="prefetch" href="/assets/12-线程体系-NioEventLoop规避JDK的NIO空循环bug.html-228fda8d.js" as="script"><link rel="prefetch" href="/assets/13-线程体系-NioEventLoop的优雅关闭.html-a02e537d.js" as="script"><link rel="prefetch" href="/assets/14-服务端处理客户端的连接(ACCEPT).html-2c6be77b.js" as="script"><link rel="prefetch" href="/assets/15-客户端处理READ事件概述.html-e7e64535.js" as="script"><link rel="prefetch" href="/assets/16-客户端处理READ事件详解及RecvByteBufAllocator.html-054ed752.js" as="script"><link rel="prefetch" href="/assets/17-Netty管道机制.html-4dbfe367.js" as="script"><link rel="prefetch" href="/assets/18-Netty发送数据流程及出站缓冲区.html-2ef79d3e.js" as="script"><link rel="prefetch" href="/assets/index.html-96d90440.js" as="script"><link rel="prefetch" href="/assets/Redis_Benchmark基准测试.html-775c16b9.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群和槽管理命令.html-f0af9833.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群基本特性和集群搭建.html-b4e0d6d8.js" as="script"><link rel="prefetch" href="/assets/Redis_Cluster集群管理工具redis-cli.html-3e3ee963.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipeline优化RTT.html-171efbd0.js" as="script"><link rel="prefetch" href="/assets/Redis_Sentinel高可用.html-39835d50.js" as="script"><link rel="prefetch" href="/assets/Redis_key设计规范.html-3d6d415e.js" as="script"><link rel="prefetch" href="/assets/Redis事务.html-cc09366e.js" as="script"><link rel="prefetch" href="/assets/Redis内存淘汰策略.html-3dbb16ba.js" as="script"><link rel="prefetch" href="/assets/Redis发布订阅.html-bada3d2c.js" as="script"><link rel="prefetch" href="/assets/Redis复制.html-78fa1134.js" as="script"><link rel="prefetch" href="/assets/Redis大key和热key问题.html-32f6f188.js" as="script"><link rel="prefetch" href="/assets/Redis慢查询日志.html-6227a318.js" as="script"><link rel="prefetch" href="/assets/Redis持久化机制.html-48575945.js" as="script"><link rel="prefetch" href="/assets/Redis键空间通知(keyspace notification).html-2e026f17.js" as="script"><link rel="prefetch" href="/assets/redis-cli 使用.html-826c1b37.js" as="script"><link rel="prefetch" href="/assets/02-NameServer启动流程.html-95824d5e.js" as="script"><link rel="prefetch" href="/assets/03-Broker启动流程.html-7159bee1.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQ网络通信原理.html-8edb9116.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ 服务端和客户端的启动.html-5a02142a.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQ网络通信源码.html-2871ef19.js" as="script"><link rel="prefetch" href="/assets/07-NameServer作用和路由元信息.html-58b9d561.js" as="script"><link rel="prefetch" href="/assets/08-NameServer路由管理源码分析.html-0766adef.js" as="script"><link rel="prefetch" href="/assets/09-生产者相关类分析.html-c5c7dd3c.js" as="script"><link rel="prefetch" href="/assets/10-生产者启动流程.html-3171375c.js" as="script"><link rel="prefetch" href="/assets/11-生产者发送消息.html-78d7df3c.js" as="script"><link rel="prefetch" href="/assets/resume.html-62d81f00.js" as="script"><link rel="prefetch" href="/assets/404.html-58add583.js" as="script"><link rel="prefetch" href="/assets/index.html-aea8a7d8.js" as="script"><link rel="prefetch" href="/assets/index.html-2952f9e7.js" as="script"><link rel="prefetch" href="/assets/index.html-bb6783d5.js" as="script"><link rel="prefetch" href="/assets/index.html-f3233053.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-2450701e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="vp-brand"><img class="vp-nav-logo" src="/小熊猫.png" alt><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html" class="router-link-active router-link-exact-active nav-link active vp-sidebar-link vp-sidebar-page active" aria-label="01-RocketMQ概述"><!---->01-RocketMQ概述<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#rocketmq-整体架构-来自官网" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="RocketMQ 整体架构（来自官网）"><!---->RocketMQ 整体架构（来自官网）<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#producer" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Producer"><!---->Producer<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#consumer" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Consumer"><!---->Consumer<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#nameserver" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="NameServer"><!---->NameServer<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#brokerserver" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="BrokerServer"><!---->BrokerServer<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#源码包" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="源码包"><!---->源码包<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#rocketmq-网络通信原理" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="RocketMQ 网络通信原理"><!---->RocketMQ 网络通信原理<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#通信角色-来自官网" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="通信角色（来自官网）"><!---->通信角色（来自官网）<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#netty-服务端的设计" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Netty 服务端的设计"><!---->Netty 服务端的设计<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#协议设计" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="协议设计"><!---->协议设计<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#reactor-多线程设计" class="router-link-active router-link-exact-active nav-link vp-sidebar-link vp-heading" aria-label="Reactor 多线程设计"><!---->Reactor 多线程设计<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/02-NameServer%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="02-NameServer启动流程"><!---->02-NameServer启动流程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/03-Broker%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="03-Broker启动流程"><!---->03-Broker启动流程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/04-RocketMQ%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="04-RocketMQ网络通信原理"><!---->04-RocketMQ网络通信原理<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/05-RocketMQ%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E5%90%AF%E5%8A%A8.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="05-RocketMQ 服务端和客户端的启动"><!---->05-RocketMQ 服务端和客户端的启动<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/06-RocketMQ%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%BA%90%E7%A0%81.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="06-RocketMQ网络通信源码"><!---->06-RocketMQ网络通信源码<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/07-NameServer%E4%BD%9C%E7%94%A8%E5%92%8C%E8%B7%AF%E7%94%B1%E5%85%83%E4%BF%A1%E6%81%AF.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="07-NameServer路由元信息和broker注册"><!---->07-NameServer路由元信息和broker注册<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/08-NameServer%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="08-NameServer路由管理源码分析"><!---->08-NameServer路由管理源码分析<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/09-%E7%94%9F%E4%BA%A7%E8%80%85%E7%9B%B8%E5%85%B3%E7%B1%BB%E5%88%86%E6%9E%90.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="09-生产者相关概念和类分析"><!---->09-生产者相关概念和类分析<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/10-%E7%94%9F%E4%BA%A7%E8%80%85%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="10-生产者启动流程"><!---->10-生产者启动流程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/RocketMQ_source/11-%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF.html" class="nav-link vp-sidebar-link vp-sidebar-page" aria-label="11-生产者发送消息"><!---->11-生产者发送消息<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->01-RocketMQ概述</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">超威蓝猫 Dylan Kwok</span></span><span property="author" content="超威蓝猫 Dylan Kwok"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-06-18T10:37:06.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 7 分钟</span><meta property="timeRequired" content="PT7M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#rocketmq-整体架构-来自官网" class="router-link-active router-link-exact-active toc-link level2">RocketMQ 整体架构（来自官网）</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#producer" class="router-link-active router-link-exact-active toc-link level3">Producer</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#consumer" class="router-link-active router-link-exact-active toc-link level3">Consumer</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#nameserver" class="router-link-active router-link-exact-active toc-link level3">NameServer</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#brokerserver" class="router-link-active router-link-exact-active toc-link level3">BrokerServer</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#源码包" class="router-link-active router-link-exact-active toc-link level2">源码包</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#rocketmq-网络通信原理" class="router-link-active router-link-exact-active toc-link level2">RocketMQ 网络通信原理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#通信角色-来自官网" class="router-link-active router-link-exact-active toc-link level3">通信角色（来自官网）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#netty-服务端的设计" class="router-link-active router-link-exact-active toc-link level3">Netty 服务端的设计</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#协议设计" class="router-link-active router-link-exact-active toc-link level3">协议设计</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/RocketMQ_source/01-RocketMQ%E6%A6%82%E8%BF%B0.html#reactor-多线程设计" class="router-link-active router-link-exact-active toc-link level3">Reactor 多线程设计</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><table><thead><tr><th>版本</th><th>内容</th><th>时间</th></tr></thead><tbody><tr><td>V1</td><td>RocketMQ 整体架构</td><td>2023年06月07日23:40:43</td></tr><tr><td>V2</td><td>RocetMQ网络通信原理</td><td>2023年06月16日13:44:32</td></tr></tbody></table><p><strong>本次分析的 RocketMQ 的版本是 4.9.3</strong></p><h2 id="rocketmq-整体架构-来自官网" tabindex="-1"><a class="header-anchor" href="#rocketmq-整体架构-来自官网" aria-hidden="true">#</a> RocketMQ 整体架构（来自官网）</h2><p><img src="/assets/rocketmq_architecture_1-53765968.png" alt="img"></p><p>RocketMQ架构上主要分为四部分，如上图所示。</p><ul><li>每个 <strong>Broker</strong> 与 <strong>NameServer</strong> 集群中的所有节点建立长连接，定时注册 Topic 信息到所有 NameServer；</li><li><strong>Producer</strong> 与 <strong>NameServer</strong> 集群中的其中一个节点建立长连接，定期从 NameServer 获取 Topic 路由信息，并向提供 Topic 服务的 Master 建立长连接，且定时向 Master 发送心跳。Producer 完全无状态；</li><li><strong>Consumer</strong> 与 <strong>NameServer</strong> 集群中的其中一个节点建立长连接，定期从 NameServer 获取 Topic 路由信息，并向提供 Topic 服务的 Master、Slave 建立长连接，且定时向 Master、Slave发送心跳。Consumer 既可以从 Master 订阅消息，也可以 Slave 订阅消息；</li></ul><h3 id="producer" tabindex="-1"><a class="header-anchor" href="#producer" aria-hidden="true">#</a> Producer</h3><p>消息发布的角色，支持分布式集群方式部署。Producer 通过 MQ 的负载均衡模块选择相应的 Broker 集群队列进行消息投递，投递的过程支持快速失败并且低延迟；</p><h3 id="consumer" tabindex="-1"><a class="header-anchor" href="#consumer" aria-hidden="true">#</a> Consumer</h3><p>Consumer：消息消费的角色：</p><ol><li>支持分布式集群方式部署；</li><li>支持以 push 推，pull 拉两种模式对消息进行消费；</li><li>同时也支持集群方式和广播方式的消费；</li><li>它提供实时消息订阅机制，可以满足大多数用户的需求；</li></ol><h3 id="nameserver" tabindex="-1"><a class="header-anchor" href="#nameserver" aria-hidden="true">#</a> NameServer</h3><p>NameServer：NameServer 是一个非常简单的 Topic 路由注册中心，其角色类似 Dubbo 中的 zookeeper，支持 Topic、Broker 的动态注册与发现。</p><p>主要包括两个功能：</p><ol><li>Broker 管理，NameServer 接受 Broker 集群的注册信息并且保存下来作为路由信息的基本数据。然后提供心跳检测机制，检查 Broker 是否还存活；</li><li>路由信息管理，每个 NameServer 将保存关于 Broker 集群的整个路由信息和用于客户端查询的队列信息。然后 Producer 和 Consumer 通过 NameServer 就可以知道整个 Broker 集群的路由信息，从而进行消息的投递和消费；</li></ol><p>NameServer 几乎无状态节点，因此可集群部署，节点之间无任何信息同步。Broker 是向每一台 NameServer 注册自己的路由信息，所以每一个 NameServer 实例上面都保存一份完整的路由信息。当某个 NameServer 因某种原因下线了，Broker 仍然可以向其它 NameServer 同步其路由信息， Producer 和 Consumer 仍然可以动态感知 Broker 的路由的信息；</p><h3 id="brokerserver" tabindex="-1"><a class="header-anchor" href="#brokerserver" aria-hidden="true">#</a> BrokerServer</h3><p>BrokerServer：Broker 主要负责消息的存储、投递和查询以及服务高可用保证，为了实现这些功能，Broker 包含了以下几个重要子模块。</p><ol><li>Remoting Module：整个 Broker 的实体，负责处理来自 Client 端的请求；</li><li>Client Manager：负责管理客户端( Producer / Consumer )和维护 Consumer 的 Topic 订阅信息；</li><li>Store Service：提供方便简单的 API 接口处理消息存储到物理硬盘和查询功能；</li><li>HA Service：高可用服务，提供 Master Broker 和 Slave Broker 之间的数据同步功能；</li><li>Index Service：根据特定的 Message key 对投递到Broker的消息进行索引服务，以提供消息的快速查询；</li></ol><p>Broker 的部署：在 Master-Slave 架构中，Broker 分为 Master 与 Slave。一个 Master 可以对应多个 Slave，但是一个 Slave 只能对应一个 Master。Master 与 Slave 的对应关系通过指定相同的 BrokerName，不同的 BrokerId 来定义，BrokerId为 0 表示 Master，非 0 表示 Slave。Master 也可以部署多个。</p><h2 id="源码包" tabindex="-1"><a class="header-anchor" href="#源码包" aria-hidden="true">#</a> 源码包</h2><img src="/assets/image-20230605113442807-ad816cd4.png" alt="image-20230605113442807" style="zoom:50%;"><ul><li>acl：权限控制模块；</li><li>broker：broker模块（broker启动进程）；</li><li>client：消息客户端，包含消息生产者和消息消费者相关类；</li><li>common：公共包；</li><li>dev：开发者信息（非源码）；</li><li>distribution：打包分发目录（非源码）；</li><li>example：RocketMQ示例代码；</li><li>filter：消息过滤相关基础类；</li><li>logappender：日志实现相关类；</li><li>logging：自主实现日志相关类；</li><li>namesrv：NameServer实现相关类（NameServer启动进程）；</li><li>openmessaging：消息开放标准，已发布；</li><li>remoting：远程通信模块，基于Netty；</li><li>srvutil：服务器工具类；</li><li>store：消息存储实现相关类；</li><li>style：checkstyle相关实现；</li><li>test：测试相关类；</li><li>tools：工具类，监控命令相关实现类；</li></ul><h2 id="rocketmq-网络通信原理" tabindex="-1"><a class="header-anchor" href="#rocketmq-网络通信原理" aria-hidden="true">#</a> RocketMQ 网络通信原理</h2><h3 id="通信角色-来自官网" tabindex="-1"><a class="header-anchor" href="#通信角色-来自官网" aria-hidden="true">#</a> 通信角色（来自官网）</h3><p>RocketMQ 消息队列集群主要包括 NameServer、Broker(Master/Slave)、Producer、Consumer 4个角色，基本通讯流程如下：</p><ol><li>Broker 启动后需要完成一次将自己注册至 NameServer 的操作。随后每隔 30s 时间向 NameServer 上报 Topic 路由信息（心跳）；</li><li>消息生产者 Producer 作为客户端发送消息时候，需要根据消息的 Topic 从本地缓存的 TopicPublishInfoTable 获取路由信息。如果没有则更新路由信息会从 NameServer 上重新拉取，同时 Producer 会默认每隔 30s 向 NameServer 拉取一次路由信息；</li><li>消息生产者 Producer 根据第二条中获取的路由信息选择一个队列（MessageQueue）进行消息发送。Broker 作为消息的接收者接收消息并落盘存储；</li><li>消息消费者 Consumer 根据第二条中获取的路由信息，在完成客户端的负载均衡后，选择其中的某一个或者某几个消息队列来拉取消息并进行消费；</li></ol><h3 id="netty-服务端的设计" tabindex="-1"><a class="header-anchor" href="#netty-服务端的设计" aria-hidden="true">#</a> Netty 服务端的设计</h3><p><img src="/assets/Netty服务端通信原理-d421ddd0.png" alt="image-20230616143747972"></p><h3 id="协议设计" tabindex="-1"><a class="header-anchor" href="#协议设计" aria-hidden="true">#</a> 协议设计</h3><p>在 RocketMQ 中，RemotingCommand 这个类在消息传输过程中对所有数据内容的封装，不但包含了所有的数据结构，还包含了编码解码操作。</p><table><thead><tr><th>Header字段</th><th>类型</th><th>Request 说明</th><th>Response 说明</th></tr></thead><tbody><tr><td>code</td><td>int</td><td>请求操作码，应答方根据不同的请求码进行不同的业务处理</td><td>应答响应码。0表示成功，非0则表示各种错误</td></tr><tr><td>language</td><td>LanguageCode</td><td>请求方实现的语言</td><td>应答方实现的语言</td></tr><tr><td>version</td><td>int</td><td>请求方程序的版本</td><td>应答方程序的版本</td></tr><tr><td>opaque</td><td>int</td><td>相当于 requestId，在同一个连接上的不同请求标识码，与响应消息中的相对应</td><td>应答不做修改直接返回</td></tr><tr><td>flag</td><td>int</td><td>区分是普通 RPC 还是 oneway RPC 的标志</td><td>区分是普通 RPC 还是 onewayRPC 的标志</td></tr><tr><td>remark</td><td>String</td><td>传输自定义文本信息</td><td>传输自定义文本信息</td></tr><tr><td>extFields</td><td>HashMap&lt;String, String&gt;</td><td>请求自定义扩展信息</td><td>响应自定义扩展信息</td></tr></tbody></table><p><img src="/assets/RocketMQ通信协议设计-2a39b9ca.png" alt="RocketMQ通信协议设计"></p><p>可见传输内容主要可以分为以下 4 部分：</p><ol><li>消息长度：总长度，四个字节存储，占用一个 int 类型；</li><li>序列化类型 &amp; 消息头长度：同样占用一个 int 类型，第一个字节表示序列化类型，后面三个字节表示消息头长度；</li><li>消息头数据：经过序列化后的消息头数据；</li><li>消息主体数据：消息主体的二进制字节数据内容；</li></ol><h3 id="reactor-多线程设计" tabindex="-1"><a class="header-anchor" href="#reactor-多线程设计" aria-hidden="true">#</a> Reactor 多线程设计</h3><p>RocketMQ 基于 Netty 框架设计的 RPC 通信。</p><ul><li><strong>一个主 Reactor 线程</strong>（只监听一个端口）：负责监听 TCP 网络连接的请求，建立好连接后，创建客户端 SocketChannel，并且注册到 Selector 上，关注 ACCEPT 事件；</li><li><strong>多个子 Reactor 线程</strong>：当 Selector 上有准备好的网络 I/O 事件后，子 Reactor 处理网络数据后，将数据在处理器链中传播；</li><li><strong>处理器 ChannelHandler 的线程</strong>：在真正执行业务逻辑之前需要进行 SSL 验证、编解码、空闲检查、网络连接管理这些操作，这些处理器由特有的线程池的线程处理；</li><li><strong>真正处理业务逻辑的线程</strong>：处理业务的线程在特有的业务线程池中执行。每种类型的请求都有自己的 code，每个 code 都会有特定的 processor 去处理，会把请求逻辑封装成一个 Runnable 的任务，提交给业务线程池去处理。</li></ul><p><img src="/assets/RocketMQ的Reactor线程设计-1360d5d3.png" alt="RocketMQ的Reactor线程设计"></p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: guosgbin@163.com">Dylan Kwok</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a href="/RocketMQ_source/02-NameServer%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.html" class="nav-link next" aria-label="02-NameServer启动流程"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">02-NameServer启动流程<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-2cb45ef8.js" defer></script>
  </body>
</html>
